{
  "abstract": [
    {
      "type": "text",
      "text": "Ensure that your code correctly handles functions, function pointers, and Objective-C messages."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/uikit",
        "doc://com.apple.documentation/documentation/uikit/app_and_environment",
        "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 3087556,
  "kind": "article",
  "metadata": {
    "title": "Managing Functions and Function Pointers",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "UIKit"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/uikit": {
      "title": "UIKit",
      "identifier": "doc://com.apple.documentation/documentation/uikit",
      "url": "/documentation/uikit",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/uikit/app_and_environment": {
      "title": "App and Environment",
      "identifier": "doc://com.apple.documentation/documentation/uikit/app_and_environment",
      "url": "/documentation/uikit/app_and_environment",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture": {
      "title": "Updating Your App from 32-Bit to 64-Bit Architecture",
      "identifier": "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture",
      "url": "/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture",
      "type": "topic",
      "kind": "article",
      "role": "article"
    },
    "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers#3087540": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers#3087540",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers#3087540"
    },
    "doc://com.apple.documentation/documentation/objectivec/1456712-objc_msgsend": {
      "title": "objc_msgSend",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/objectivec/1456712-objc_msgsend",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/objectivec/1456712-objc_msgsend"
    },
    "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers#3087542": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers#3087542",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers#3087542"
    },
    "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/updating_data_structures": {
      "title": "Updating Data Structures",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/updating_data_structures",
      "kind": "article",
      "role": "article",
      "url": "/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/updating_data_structures",
      "abstract": [
        {
          "type": "text",
          "text": "Review your app's data design and update it to conform with 64-bit architecture."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/auditing_pointer_usage": {
      "title": "Auditing Pointer Usage",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/auditing_pointer_usage",
      "kind": "article",
      "role": "article",
      "url": "/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/auditing_pointer_usage",
      "abstract": [
        {
          "type": "text",
          "text": "Ensure that the pointers in your code are safe for the 64-bit runtime."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers": {
      "title": "Managing Functions and Function Pointers",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers",
      "kind": "article",
      "role": "article",
      "url": "/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/managing_functions_and_function_pointers",
      "abstract": [
        {
          "type": "text",
          "text": "Ensure that your code correctly handles functions, function pointers, and Objective-C messages."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/updating_data_structures",
        "doc://com.apple.documentation/documentation/uikit/app_and_environment/updating_your_app_from_32-bit_to_64-bit_architecture/auditing_pointer_usage"
      ],
      "title": "Memory and Pointer Access",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The 64-bit runtime brings a number of changes in the calling and handling of functions. These changes affect how functions that accept a variable number of arguments and Objective-C messages are called in your code. Ensure that your code complies with these changes by adopting the calling conventions prescribed below."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Always Define Function Prototypes",
          "anchor": "3087546"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When compiling using the updated project settings, the compiler generates errors if you attempt to make a function call to a function that doesn't have an explicit prototype. You must provide a function prototype so that the compiler can determine whether or not the function is variadic."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Ensure that Function Pointers Use the Correct Prototype",
          "anchor": "3087539"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If you pass a function pointer in your code, its calling conventions must take the same set of parameters everywhere in the code. Never cast a variadic function to a function that takes a fixed number of parameters (or vice versa)."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The following code shows an example of a problematic function call: "
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "int MyFunction(int a, int b, ...);",
            "",
            "int (*action)(int, int, int) = (int (*)(int, int, int)) MyFunction;",
            "action(1,2,3); // Incorrect."
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "3087540",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Because the function pointer in this example is cast to use a different set of calling conventions, the calling function places the parameters in an order that the called function doesn't expect. This behavior could cause your app to crash or to exhibit other unpredictable behaviors."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Call Variadic Functions with Consistent Types",
          "anchor": "3087541"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Variadic functions are functions that contain variable argument lists ("
            },
            {
              "type": "codeVoice",
              "code": "varargs"
            },
            {
              "type": "text",
              "text": "). Variable arguments don't provide type information. Furthermore, the arguments of variadic functions aren't automatically promoted to larger types. In the 64-bit runtime, it's important to understand this behavior if you pass in types of different sizes to variadic functions."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If you need to distinguish between different incoming data types, use a format string or other similar mechanism to provide that information to the "
            },
            {
              "type": "codeVoice",
              "code": "varargs"
            },
            {
              "type": "text",
              "text": " function. If the calling function doesn't provide the right information (or if the "
            },
            {
              "type": "codeVoice",
              "code": "varargs"
            },
            {
              "type": "text",
              "text": " function doesn't interpret it correctly), you get incorrect results."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "For example, if your "
            },
            {
              "type": "codeVoice",
              "code": "varargs"
            },
            {
              "type": "text",
              "text": " function requires a "
            },
            {
              "type": "codeVoice",
              "code": "long"
            },
            {
              "type": "text",
              "text": " integer and you pass in a 32-bit value, the function contains 32 bits of the data you passed and 32 bits of data from the next argument. Likewise, if your "
            },
            {
              "type": "codeVoice",
              "code": "varargs"
            },
            {
              "type": "text",
              "text": " function requires an "
            },
            {
              "type": "codeVoice",
              "code": "int"
            },
            {
              "type": "text",
              "text": " type and you pass in a "
            },
            {
              "type": "codeVoice",
              "code": "long"
            },
            {
              "type": "text",
              "text": " integer, you get only half of the data. The remaining 32 bits of the data you pass appears in the argument that follows."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Cast Objective-C Messages in Proper Form",
          "anchor": "3087535"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If your code calls the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/1456712-objc_msgsend"
            },
            {
              "type": "text",
              "text": " function, or any other similar functions in the Objective-C runtime that send messages, you need to cast properly. Although the prototype for the message functions has a variadic form, the method function that's called by the Objective-C runtime doesn't share the same prototype."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The Objective-C runtime directly calls the function that implements the method, so the calling conventions are mismatched. You must cast the "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/1456712-objc_msgsend"
            },
            {
              "type": "text",
              "text": " function to a prototype that matches the method function being called."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The following code shows proper form for dispatching a message to an object, using the low-level message functions:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "- (int) doSomething:(int) x {",
            "   return x + 2;",
            "}",
            "",
            "- (void) doSomethingElse {",
            "    int (*action)(id, SEL, int) = (int (*)(id, SEL, int)) objc_msgSend;",
            "    action(self, @selector(doSomething:), 0);",
            "}"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "3087542",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "In this example, the "
            },
            {
              "type": "codeVoice",
              "code": "doSomething:"
            },
            {
              "type": "text",
              "text": " method takes a single parameter, "
            },
            {
              "type": "codeVoice",
              "code": "x"
            },
            {
              "type": "text",
              "text": ", and doesn't have a variadic form. In "
            },
            {
              "type": "codeVoice",
              "code": "doSomethingElse"
            },
            {
              "type": "text",
              "text": ", it casts the "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/1456712-objc_msgsend"
            },
            {
              "type": "text",
              "text": " function using the prototype of the method function. Note that a method function always takes an "
            },
            {
              "type": "codeVoice",
              "code": "id"
            },
            {
              "type": "text",
              "text": " variable and a selector as its first two parameters. After the "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/1456712-objc_msgsend"
            },
            {
              "type": "text",
              "text": " function is cast to the function pointer named "
            },
            {
              "type": "codeVoice",
              "code": "action"
            },
            {
              "type": "text",
              "text": ", the call is dispatched through that same function pointer."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}