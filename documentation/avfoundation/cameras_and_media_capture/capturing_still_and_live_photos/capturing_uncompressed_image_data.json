{
  "abstract": [
    {
      "type": "text",
      "text": "Get processed image data without compression to use for filtering or lossless output."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/avfoundation",
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture",
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2958952,
  "kind": "article",
  "metadata": {
    "title": "Capturing Uncompressed Image Data",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "AVFoundation"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/avfoundation": {
      "title": "AVFoundation",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation",
      "url": "/documentation/avfoundation",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture": {
      "title": "Cameras and Media Capture",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture",
      "url": "/documentation/avfoundation/cameras_and_media_capture",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos": {
      "title": "Capturing Still and Live Photos",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotosettings/1648673-photosettingswithformat": {
      "title": "photoSettingsWithFormat:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotosettings/1648673-photosettingswithformat",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotosettings/1648673-photosettingswithformat",
      "fragments": [
        {
          "kind": "text",
          "text": "+ "
        },
        {
          "kind": "identifier",
          "text": "photoSettingsWithFormat:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/corevideo/kcvpixelbufferpixelformattypekey": {
      "title": "kCVPixelBufferPixelFormatTypeKey",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/corevideo/kcvpixelbufferpixelformattypekey",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/corevideo/kcvpixelbufferpixelformattypekey"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1778630-availablephotopixelformattypes": {
      "title": "availablePhotoPixelFormatTypes",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1778630-availablephotopixelformattypes",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput/1778630-availablephotopixelformattypes"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data#2958951": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data#2958951",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data#2958951"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput": {
      "title": "captureOutput:didFinishProcessingPhoto:error:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "captureOutput:didFinishProcessingPhoto:error:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto": {
      "title": "AVCapturePhoto",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873914-pixelbuffer": {
      "title": "pixelBuffer",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873914-pixelbuffer",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto/2873914-pixelbuffer"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data#2958955": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data#2958955",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data#2958955"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation": {
      "title": "fileDataRepresentation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "fileDataRepresentation"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_with_depth": {
      "title": "Capturing Photos with Depth",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_with_depth",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_photos_with_depth",
      "abstract": [
        {
          "type": "text",
          "text": "Get a depth map with a photo to create effects like the system camera’s Portrait mode (on compatible devices)."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_a_bracketed_photo_sequence": {
      "title": "Capturing a Bracketed Photo Sequence",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_a_bracketed_photo_sequence",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_a_bracketed_photo_sequence",
      "abstract": [
        {
          "type": "text",
          "text": "Capture several photos at once, varying parameters like exposure duration or light sensitivity."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data": {
      "title": "Capturing Uncompressed Image Data",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_uncompressed_image_data",
      "abstract": [
        {
          "type": "text",
          "text": "Get processed image data without compression to use for filtering or lossless output."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_thumbnail_and_preview_images": {
      "title": "Capturing Thumbnail and Preview Images",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_thumbnail_and_preview_images",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_thumbnail_and_preview_images",
      "abstract": [
        {
          "type": "text",
          "text": "Enable delivery of reduced-size images with the main image in a photo capture."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_with_depth",
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_a_bracketed_photo_sequence",
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/capturing_thumbnail_and_preview_images"
      ],
      "title": "More Capture Options",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Typical photography workflows save images in a compressed format such as HEIF/HEVC or JPEG. These formats use lossy compression to strike a balance between preserving noticeable details in the image and reducing its data storage requirements. However, sometimes it's more helpful to work with uncompressed image data—for example, some image processing and analysis algorithms can be confused by the visual artifacts introduced by lossy compression."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "Uncompressed image data is not to be confused with unprocessed, or RAW, image data. RAW data is minimally altered data direct from a camera's image sensor. Uncompressed image data has been processed to create a displayable image, but hasn't been compressed to create a small file."
                }
              ]
            }
          ],
          "style": "note",
          "name": "Note"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "In iOS, capturing uncompressed image data requires minor changes to the basic photography workflow covered in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Choose Uncompressed Format Settings",
          "anchor": "2958956"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To capture in an uncompressed format, create a photo settings object with "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotosettings/1648673-photosettingswithformat"
            },
            {
              "type": "text",
              "text": ". In the format dictionary, specify the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/corevideo/kcvpixelbufferpixelformattypekey"
            },
            {
              "type": "text",
              "text": " with one of the values listed in the photo output's "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1778630-availablephotopixelformattypes"
            },
            {
              "type": "text",
              "text": " array. The example below chooses a 32-bit BGRA pixel format, which is useful in some GPU processing workflows:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "// Choose a 32-bit BGRA pixel format and verify the camera supports it.",
            "let pixelFormatType = kCVPixelFormatType_32BGRA",
            "guard self.photoOutput.availablePhotoPixelFormatTypes.contains(pixelFormatType) else { return }",
            "let photoSettings = AVCapturePhotoSettings(format:",
            "    [ kCVPixelBufferPixelFormatTypeKey as String : pixelFormatType ])",
            "",
            "// Shoot the photo, using a custom class to handle capture delegate callbacks.",
            "let layerOrientation = previewView.videoPreviewLayer.connection!.videoOrientation",
            "let colorSpace = self.videoCaptureDevice.activeColorSpace",
            "let captureProcessor = UncompressedCaptureProcessor(orientation: layerOrientation,",
            "                                                    colorSpace: colorSpace)",
            "self.photoOutput.capturePhoto(with: photoSettings, delegate: captureProcessor)",
            ""
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2958951",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Handle Results",
          "anchor": "2958957"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "As with other formats, you receive uncompressed data capture results to your delegate's "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput"
            },
            {
              "type": "text",
              "text": " method as an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto"
            },
            {
              "type": "text",
              "text": " object. To access the uncompressed pixel data directly, use the photo's "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873914-pixelbuffer"
            },
            {
              "type": "text",
              "text": " property. "
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "For example, the following code applies a Core Image filter directly to the pixel buffer and writes the filtered image to a PNG file:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "class UncompressedCaptureProcessor: NSObject, AVCapturePhotoCaptureDelegate {",
            "    ",
            "    // Hold on to the separately delivered RAW and compressed photo data until capture is finished.",
            "    func photoOutput(_ output: AVCapturePhotoOutput, didFinishProcessingPhoto photo: AVCapturePhoto, error: Error?) {",
            "        guard error != nil else { print(\"Error capturing photo: \\(error!)\"); return }",
            "        ",
            "        // Create a CIImage from the pixel buffer and apply a filter",
            "        let image = CIImage(cvPixelBuffer: photo.pixelBuffer!)",
            "        let imageOrientation = self.imageOrientation(for: videoOrientation)",
            "        let filteredImage = image.oriented(imageOrientation)",
            "            .applyingFilter(\"CIPhotoEffectNoir\", parameters: [:])",
            "        ",
            "        let imageColorSpace = self.imageColorSpace(for: colorSpace)",
            "        guard let pngData = CIContext()",
            "            .pngRepresentation(of: filteredImage, format: kCIFormatBGRA8, colorSpace: imageColorSpace)",
            "            else { print(\"Error creating filtered PNG image\"); return }",
            "        self.exportToFile(pngData)",
            "    }",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2958955",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Alternatively, to get an uncompressed photo ready for writing to a file, use the photo's "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation"
            },
            {
              "type": "text",
              "text": " method to get the data formatted as a TIFF file."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}