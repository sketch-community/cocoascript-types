{
  "abstract": [
    {
      "type": "text",
      "text": "Support professional photography workflows by enabling minimally processed image capture in your camera app."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/avfoundation",
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 3701427,
  "kind": "article",
  "metadata": {
    "title": "Capturing Photos in RAW and Apple ProRAW Formats",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "AVFoundation"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/avfoundation": {
      "title": "AVFoundation",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation",
      "url": "/documentation/avfoundation",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture": {
      "title": "Cameras and Media Capture",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture",
      "url": "/documentation/avfoundation/cameras_and_media_capture",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697089-appleprorawsupported": {
      "title": "appleProRAWSupported",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697089-appleprorawsupported",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput/3697089-appleprorawsupported"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697088-appleprorawenabled": {
      "title": "appleProRAWEnabled",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697088-appleprorawenabled",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput/3697088-appleprorawenabled"
    },
    "doc://com.apple.documentation/documentation/objectivec/yes": {
      "title": "YES",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/objectivec/yes",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/objectivec/yes"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701423": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701423",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701423"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1778628-availablerawphotopixelformattype": {
      "title": "availableRawPhotoPixelFormatTypes",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1778628-availablerawphotopixelformattype",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput/1778628-availablerawphotopixelformattype"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697090-isappleprorawpixelformat": {
      "title": "isAppleProRAWPixelFormat:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697090-isappleprorawpixelformat",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput/3697090-isappleprorawpixelformat",
      "fragments": [
        {
          "kind": "text",
          "text": "+ "
        },
        {
          "kind": "identifier",
          "text": "isAppleProRAWPixelFormat:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697091-isbayerrawpixelformat": {
      "title": "isBayerRAWPixelFormat:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697091-isbayerrawpixelformat",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput/3697091-isbayerrawpixelformat",
      "fragments": [
        {
          "kind": "text",
          "text": "+ "
        },
        {
          "kind": "identifier",
          "text": "isBayerRAWPixelFormat:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos": {
      "title": "Capturing Still and Live Photos",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos",
      "abstract": [
        {
          "type": "text",
          "text": "Configure and capture single or multiple still images, Live Photos, and other forms of photography."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotosettings": {
      "title": "AVCapturePhotoSettings",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotosettings",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotosettings"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1648765-capturephotowithsettings": {
      "title": "capturePhotoWithSettings:delegate:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1648765-capturephotowithsettings",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput/1648765-capturephotowithsettings",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "capturePhotoWithSettings:delegate:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701425": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701425",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701425"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput": {
      "title": "captureOutput:didFinishProcessingPhoto:error:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "captureOutput:didFinishProcessingPhoto:error:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation": {
      "title": "fileDataRepresentation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "fileDataRepresentation"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701421": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701421",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701421"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom": {
      "title": "fileDataRepresentationWithCustomizer:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "fileDataRepresentationWithCustomizer:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotofiledatarepresentationcustomizer": {
      "title": "AVCapturePhotoFileDataRepresentationCustomizer",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotofiledatarepresentationcustomizer",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotofiledatarepresentationcustomizer"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701621": {
      "title": "Listing 4",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701621",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701621"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701618": {
      "title": "Listing 5",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701618",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701618"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/1778618-captureoutput": {
      "title": "captureOutput:didFinishCaptureForResolvedSettings:error:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/1778618-captureoutput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotocapturedelegate/1778618-captureoutput",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "captureOutput:didFinishCaptureForResolvedSettings:error:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/saving_captured_photos": {
      "title": "Saving Captured Photos",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/saving_captured_photos",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/saving_captured_photos"
    },
    "doc://com.apple.documentation/documentation/photokit/phassetcreationrequest": {
      "title": "PHAssetCreationRequest",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/photokit/phassetcreationrequest",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/photokit/phassetcreationrequest"
    },
    "doc://com.apple.documentation/documentation/photokit/phassetresourcetype/phassetresourcetypephoto": {
      "title": "PHAssetResourceTypePhoto",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/photokit/phassetresourcetype/phassetresourcetypephoto",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/photokit/phassetresourcetype/phassetresourcetypephoto"
    },
    "doc://com.apple.documentation/documentation/photokit/phassetresourcetype/phassetresourcetypealternatephoto": {
      "title": "PHAssetResourceTypeAlternatePhoto",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/photokit/phassetresourcetype/phassetresourcetypealternatephoto",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/photokit/phassetresourcetype/phassetresourcetypealternatephoto"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701429": {
      "title": "Listing 6",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701429",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats#3701429"
    },
    "doc://com.apple.documentation/documentation/coreimage/cifilter": {
      "title": "CIFilter",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/cifilter",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/coreimage/cifilter"
    },
    "doc://com.apple.documentation/documentation/coreimage/cifilter/1438096-filterwithimageurl": {
      "title": "filterWithImageURL:options:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/cifilter/1438096-filterwithimageurl",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/coreimage/cifilter/1438096-filterwithimageurl",
      "fragments": [
        {
          "kind": "text",
          "text": "+ "
        },
        {
          "kind": "identifier",
          "text": "filterWithImageURL:options:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats": {
      "title": "Capturing Photos in RAW and Apple ProRAW Formats",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/cameras_and_media_capture/capturing_photos_in_raw_and_apple_proraw_formats",
      "abstract": [
        {
          "type": "text",
          "text": "Support professional photography workflows by enabling minimally processed image capture in your camera app."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/appkit/supporting_continuity_camera_in_your_mac_app": {
      "title": "Supporting Continuity Camera in Your Mac App",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/appkit/supporting_continuity_camera_in_your_mac_app",
      "kind": "article",
      "role": "article",
      "url": "/documentation/appkit/supporting_continuity_camera_in_your_mac_app",
      "abstract": [
        {
          "type": "text",
          "text": "Incorporate scanned documents and pictures from a user's iPhone, iPad, or iPod touch into your Mac app using Continuity Camera."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto": {
      "title": "AVCapturePhoto",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto",
      "abstract": [
        {
          "type": "text",
          "text": "A container for image data from a photo capture output."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput": {
      "title": "AVCapturePhotoOutput",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput",
      "abstract": [
        {
          "type": "text",
          "text": "A capture output for still image, Live Photos, and other photography workflows."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate": {
      "title": "AVCapturePhotoCaptureDelegate",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotocapturedelegate",
      "abstract": [
        {
          "type": "text",
          "text": "Methods for monitoring progress and receiving results from a photo capture output."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos",
        "doc://com.apple.documentation/documentation/appkit/supporting_continuity_camera_in_your_mac_app",
        "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto",
        "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput",
        "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate"
      ],
      "title": "Photo Capture",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "By default, the image-capture pipeline uses advanced computational photography techniques to achieve the highest quality images, and delivers the processed result to your app in a compressed format for efficient storage and display. Processed formats are a great choice in many cases, but RAW formats contain minimally processed image data from the camera sensor, which gives your app users more creative control."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Capturing images in RAW format results in much larger files than compressed formats, but greatly expands editing capabilities in post-production. But, one drawback to shooting in standard RAW format is that it bypasses the advanced processing that the image-capture pipeline provides. "
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Beginning in iOS 14.3, and available on iPhone 12 Pro and Pro Max, you can use the Apple ProRAW format. Apple ProRAW provides the benefits of RAW capture, and applies many of the multi-image fusion techniques previously unavailable to RAW workflows."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "You can use Core Image to display and edit RAW and Apple ProRAW files. See the "
                },
                {
                  "type": "reference",
                  "isActive": false,
                  "identifier": "doc://com.apple.documentation/documentation/coreimage/cifilter"
                },
                {
                  "type": "text",
                  "text": " class’s "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/coreimage/cifilter/1438096-filterwithimageurl"
                },
                {
                  "type": "text",
                  "text": " initializer for more information."
                }
              ]
            }
          ],
          "style": "tip"
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Enable Apple ProRAW Support",
          "anchor": "3701430"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To determine whether your app’s photo output supports Apple ProRAW formats in the current environment, add the output to a capture session that has a connected video source, and query its "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697089-appleprorawsupported"
            },
            {
              "type": "text",
              "text": " property. If the current environment supports Apple ProRAW formats, you can enable the photo output to use them by setting its "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697088-appleprorawenabled"
            },
            {
              "type": "text",
              "text": " property to "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/yes"
            },
            {
              "type": "text",
              "text": " as the example below shows:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "private let captureSession = AVCaptureSession()",
            "private let photoOutput = AVCapturePhotoOutput()",
            "",
            "private func setupSession() throws {",
            "    ",
            "    // Start capture session configuration.",
            "    captureSession.beginConfiguration()",
            "    ",
            "    // Configure the session for photo capture.",
            "    captureSession.sessionPreset = .photo",
            "    ",
            "    // Connect the default video device.",
            "    let videoInput = try AVCaptureDeviceInput(device: defaultVideoDevice)",
            "    if captureSession.canAddInput(videoInput) {",
            "        captureSession.addInput(videoInput)",
            "        currentVideoInput = videoInput",
            "    } else {",
            "        throw CameraError.setupFailed",
            "    }",
            "    ",
            "    // Connect and configure capture output.",
            "    if captureSession.canAddOutput(photoOutput) {",
            "        captureSession.addOutput(photoOutput)",
            "        ",
            "        // Use Apple ProRAW when supported.",
            "        photoOutput.isAppleProRAWEnabled = photoOutput.isAppleProRAWSupported",
            "    } else {",
            "        throw CameraError.setupFailed",
            "    }",
            "    ",
            "    // Session configured. Commit configuration.",
            "    captureSession.commitConfiguration()",
            "}",
            ""
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3701423",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Enabling the use of Apple ProRAW formats adds an entry to the photo output’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1778628-availablerawphotopixelformattype"
            },
            {
              "type": "text",
              "text": " array. You can determine whether a particular format in the array is an Apple ProRAW or Bayer RAW format by querying the output’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697090-isappleprorawpixelformat"
            },
            {
              "type": "text",
              "text": " or "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/3697091-isbayerrawpixelformat"
            },
            {
              "type": "text",
              "text": " methods."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "To avoid a lengthy reconfiguration of the capture pipeline, enable Apple ProRAW capture before starting the capture session."
                }
              ]
            }
          ],
          "style": "important"
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Capture RAW Photos",
          "anchor": "3701426"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Capturing photos in RAW and Apple ProRAW format requires only minor changes to the basic photography workflow in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos"
            },
            {
              "type": "text",
              "text": ". Begin by creating an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotosettings"
            },
            {
              "type": "text",
              "text": " object that specifies the RAW format to capture, and optionally, a processed format to capture if your app supports creating RAW+JPEG files. The capture pipeline only supports the RAW formats in the photo output’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1778628-availablerawphotopixelformattype"
            },
            {
              "type": "text",
              "text": " array. "
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The example below finds the appropriate RAW format, choosing Apple ProRAW when it’s in an enabled state, and Bayer RAW when it’s not. It creates a photo settings object that specifies the RAW and processed formats, and a delegate object to monitor the capture progress. Finally, it calls the photo output’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput/1648765-capturephotowithsettings"
            },
            {
              "type": "text",
              "text": " method, passing it the photo settings and delegate objects."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let query = photoOutput.isAppleProRAWEnabled ?",
            "    { AVCapturePhotoOutput.isAppleProRAWPixelFormat($0) } :",
            "    { AVCapturePhotoOutput.isBayerRAWPixelFormat($0) }",
            "",
            "// Retrieve the RAW format, favoring Apple ProRAW when it's in an enabled state.",
            "guard let rawFormat =",
            "        photoOutput.availableRawPhotoPixelFormatTypes.first(where: query) else {",
            "    fatalError(\"No RAW format found.\")",
            "}",
            "",
            "// Capture a RAW format photo, along with a processed format photo.",
            "let processedFormat = [AVVideoCodecKey: AVVideoCodecType.hevc]",
            "let photoSettings = AVCapturePhotoSettings(rawPixelFormatType: rawFormat,",
            "                                           processedFormat: processedFormat)",
            "",
            "// Create a delegate to monitor the capture process.",
            "let delegate = RAWCaptureDelegate()",
            "captureDelegates[photoSettings.uniqueID] = delegate",
            "",
            "// Remove the delegate reference when it finishes its processing.",
            "delegate.didFinish = {",
            "    self.captureDelegates[photoSettings.uniqueID] = nil",
            "}",
            "",
            "// Tell the output to capture the photo.",
            "photoOutput.capturePhoto(with: photoSettings, delegate: delegate)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3701425",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Handle the Captured Photos",
          "anchor": "3701424"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The photo output calls its delegate’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput"
            },
            {
              "type": "text",
              "text": " method at least once for each format you request, and possibly additional times, depending on your capture settings. Using the capture settings in the previous section results in the photo output calling this delegate method twice: once for the RAW image, and again for the processed image. In each invocation, get the photo’s file data by calling its "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation"
            },
            {
              "type": "text",
              "text": " method and store it as necessary. If you call this method on a RAW photo, it returns the data in the industry-standard DNG file format. If you call it on processed images, it returns the compressed bitmap image data. "
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The following code shows an example implementation of the "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/2873949-captureoutput"
            },
            {
              "type": "text",
              "text": " method. It writes the RAW file to disk and stores a reference to the processed photo’s compressed bitmap data for later use."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "class RAWCaptureDelegate: NSObject, AVCapturePhotoCaptureDelegate {",
            "    ",
            "    private var rawFileURL: URL?",
            "    private var compressedData: Data?",
            "    ",
            "    var didFinish: (() -> Void)?",
            "    ",
            "    // Store the RAW file and compressed photo data until the capture finishes.",
            "    func photoOutput(_ output: AVCapturePhotoOutput,",
            "                     didFinishProcessingPhoto photo: AVCapturePhoto,",
            "                     error: Error?) {",
            "        ",
            "        guard error == nil else {",
            "            print(\"Error capturing photo: \\(error!)\")",
            "            return",
            "        }",
            "        ",
            "        // Access the file data representation of this photo.",
            "        guard let photoData = photo.fileDataRepresentation() else {",
            "            print(\"No photo data to write.\")",
            "            return",
            "        }",
            "        ",
            "        if photo.isRawPhoto {",
            "            // Generate a unique URL to write the RAW file.",
            "            rawFileURL = makeUniqueDNGFileURL()",
            "            do {",
            "                // Write the RAW (DNG) file data to a URL.",
            "                try photoData.write(to: rawFileURL!)",
            "            } catch {",
            "                fatalError(\"Couldn't write DNG file to the URL.\")",
            "            }",
            "        } else {",
            "            // Store compressed bitmap data.",
            "            compressedData = photoData",
            "        }",
            "    }",
            "    ",
            "    private func makeUniqueDNGFileURL() -> URL {",
            "        let tempDir = FileManager.default.temporaryDirectory",
            "        let fileName = ProcessInfo.processInfo.globallyUniqueString",
            "        return tempDir.appendingPathComponent(fileName).appendingPathExtension(\"dng\")",
            "    }",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3701421",
            "title": "Listing 3"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Customize the Apple ProRAW Output",
          "anchor": "3701619"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "By default, when you ask for the file data representation of an Apple ProRAW photo, you get the data in full lossless quality. If you’re willing to accept some lossy compression to achieve smaller file sizes, you can customize the compression settings by calling "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom"
            },
            {
              "type": "text",
              "text": " and passing it a custom object that conforms to the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotofiledatarepresentationcustomizer"
            },
            {
              "type": "text",
              "text": " protocol. The following code shows an example implementation of this protocol that applies minimal compression to the output image:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "class AppleProRAWCustomizer: NSObject, AVCapturePhotoFileDataRepresentationCustomizer {",
            "    ",
            "    // Customize the compression settings.",
            "    func replacementAppleProRAWCompressionSettings(for photo: AVCapturePhoto, ",
            "                                                   defaultSettings: [String : Any], ",
            "                                                   maximumBitDepth: Int) -> [String : Any] {",
            "        ",
            "        // Reduce the bit depth and quality of the final file.",
            "        return [AVVideoAppleProRAWBitDepthKey: maximumBitDepth - 2, ",
            "                AVVideoQualityKey: 0.95]",
            "    }",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3701621",
            "title": "Listing 4"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To use this customizer when retrieving the file data representation of a ProRAW photo, create a new instance of your customizer and pass it to the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom"
            },
            {
              "type": "text",
              "text": " method as the example below shows:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "// Get a minimally compressed representation of the file data.",
            "let customizer = AppleProRAWCustomizer()",
            "let photoData = photo.fileDataRepresentation(with: customizer)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3701618",
            "title": "Listing 5"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Save the Photos to the Photos Library",
          "anchor": "3701422"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The photo output indicates when it finishes the capture request by calling the delegate’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate/1778618-captureoutput"
            },
            {
              "type": "text",
              "text": " method. This callback provides an opportunity to save the captured photos to the user’s Photos library. For more information about configuring your app to access the user’s Photos library, see "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture/capturing_still_and_live_photos/saving_captured_photos"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To save the captured photos to the user’s Photos library, create a single Photos asset that associates the RAW and processed data. Create an instance of "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/photokit/phassetcreationrequest"
            },
            {
              "type": "text",
              "text": ", then specify the DNG version as the asset’s main "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/photokit/phassetresourcetype/phassetresourcetypephoto"
            },
            {
              "type": "text",
              "text": " resource, and the processed image as an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/photokit/phassetresourcetype/phassetresourcetypealternatephoto"
            },
            {
              "type": "text",
              "text": " resource. Perform the request inside a change block as the example below shows:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "// After both RAW and compressed versions are complete, add them to the Photos library.",
            "func photoOutput(_ output: AVCapturePhotoOutput,",
            "                 didFinishCaptureFor resolvedSettings: AVCaptureResolvedPhotoSettings,",
            "                 error: Error?) {",
            "    ",
            "    // Call the \"finished\" closure, if set.",
            "    defer { didFinish?() }",
            "    ",
            "    guard error == nil else {",
            "        print(\"Error capturing photo: \\(error!)\")",
            "        return",
            "    }",
            "    ",
            "    // Ensure the RAW and processed photo data exists.",
            "    guard let rawFileURL = rawFileURL,",
            "          let compressedData = compressedData else {",
            "        print(\"The expected photo data isn't available.\")",
            "        return",
            "    }",
            "    ",
            "    // Request add-only access to the user's Photos library (if not already granted).",
            "    PHPhotoLibrary.requestAuthorization(for: .addOnly) { status in",
            "        ",
            "        // Don't continue if not authorized.",
            "        guard status == .authorized else { return }",
            "        ",
            "        PHPhotoLibrary.shared().performChanges {",
            "     ",
            "            // Save the RAW (DNG) file as the main resource for the Photos asset.",
            "            let options = PHAssetResourceCreationOptions()",
            "            options.shouldMoveFile = true",
            "            creationRequest.addResource(with: .photo, ",
            "                                        fileURL: rawFileURL, ",
            "                                        options: options)",
            "",
            "            // Add the compressed (HEIF) data as an alternative resource. ",
            "            let creationRequest = PHAssetCreationRequest.forAsset()",
            "            creationRequest.addResource(with: .alternatePhoto, ",
            "                                        data: compressedData, ",
            "                                        options: nil)",
            "            ",
            "        } completionHandler: { success, error in",
            "            // Process the Photos library error.",
            "        }",
            "    }",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3701429",
            "title": "Listing 6"
          }
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}