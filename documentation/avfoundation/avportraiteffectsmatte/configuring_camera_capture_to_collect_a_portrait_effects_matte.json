{
  "abstract": [
    {
      "type": "text",
      "text": "Prepare your app to capture a portrait effects matte when taking photos."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/avfoundation",
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture",
        "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 3025452,
  "kind": "article",
  "metadata": {
    "title": "Configuring Camera Capture to Collect a Portrait Effects Matte",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "AVFoundation"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/avfoundation": {
      "title": "AVFoundation",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation",
      "url": "/documentation/avfoundation",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture": {
      "title": "Cameras and Media Capture",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture",
      "url": "/documentation/avfoundation/cameras_and_media_capture",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte": {
      "title": "AVPortraitEffectsMatte",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte",
      "url": "/documentation/avfoundation/avportraiteffectsmatte",
      "type": "topic",
      "kind": "symbol",
      "role": "symbol"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto": {
      "title": "AVCapturePhoto",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation": {
      "title": "fileDataRepresentation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "fileDataRepresentation"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsdata": {
      "title": "NSData",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsdata",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsdata"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom": {
      "title": "fileDataRepresentationWithCustomizer:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "fileDataRepresentationWithCustomizer:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput": {
      "title": "AVCapturePhotoOutput",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotooutput"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte#3027157": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte#3027157",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte#3027157"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcaptureresolvedphotosettings": {
      "title": "AVCaptureResolvedPhotoSettings",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcaptureresolvedphotosettings",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcaptureresolvedphotosettings"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate": {
      "title": "AVCapturePhotoCaptureDelegate",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephotocapturedelegate"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcaptureresolvedphotosettings/2977533-portraiteffectsmattedimensions": {
      "title": "portraitEffectsMatteDimensions",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcaptureresolvedphotosettings/2977533-portraiteffectsmattedimensions",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcaptureresolvedphotosettings/2977533-portraiteffectsmattedimensions"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977523-portraiteffectsmatte": {
      "title": "portraitEffectsMatte",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977523-portraiteffectsmatte",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturephoto/2977523-portraiteffectsmatte"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avmetadatafaceobject": {
      "title": "AVMetadataFaceObject",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avmetadatafaceobject",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avmetadatafaceobject"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte": {
      "title": "Configuring Camera Capture to Collect a Portrait Effects Matte",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/configuring_camera_capture_to_collect_a_portrait_effects_matte",
      "abstract": [
        {
          "type": "text",
          "text": "Prepare your app to capture a portrait effects matte when taking photos."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976125-portraiteffectsmattefromdictiona": {
      "title": "portraitEffectsMatteFromDictionaryRepresentation:error:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976125-portraiteffectsmattefromdictiona",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/2976125-portraiteffectsmattefromdictiona",
      "abstract": [
        {
          "type": "text",
          "text": "Initializes a portrait effects matte instance from auxiliary image information in an image file."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "+ "
        },
        {
          "kind": "identifier",
          "text": "portraitEffectsMatteFromDictionaryRepresentation:error:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976123-portraiteffectsmattebyapplyingex": {
      "title": "portraitEffectsMatteByApplyingExifOrientation:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976123-portraiteffectsmattebyapplyingex",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/2976123-portraiteffectsmattebyapplyingex",
      "abstract": [
        {
          "type": "text",
          "text": "Returns a derivative portrait effects matte after applying the specified EXIF orientation."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "portraitEffectsMatteByApplyingExifOrientation:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976124-portraiteffectsmattebyreplacingp": {
      "title": "portraitEffectsMatteByReplacingPortraitEffectsMatteWithPixelBuffer:error:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976124-portraiteffectsmattebyreplacingp",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/2976124-portraiteffectsmattebyreplacingp",
      "abstract": [
        {
          "type": "text",
          "text": "Returns a portrait effects matte by wrapping the replacement pixel buffer."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "portraitEffectsMatteByReplacingPortraitEffectsMatteWithPixelBuffer:error:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976125-portraiteffectsmattefromdictiona",
        "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976123-portraiteffectsmattebyapplyingex",
        "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976124-portraiteffectsmattebyreplacingp"
      ],
      "title": "Creating a Portrait Effects Matte",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When capturing a photo in the iOS Camera app, you can cause the portrait effects matte to be generated by entering Portrait mode and detecting a face. You can tell whether the camera found a face by checking for four yellow brackets in the viewfinder; photographing a detected face in Portrait mode doesn't guarantee the generation of a matte, but it is a prerequisite."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Like the iOS Camera app, your app can also opt in for creating and embedding portrait effects matte into captured photos, eventually saving them as HEIC and JPEG images. Using AVFoundation’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput"
            },
            {
              "type": "text",
              "text": ", your app can find out whether a particular camera configuration supports the delivery of a portrait effect mattes to still images, and opt in to have them delivered on a per-photo request basis. "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput"
            },
            {
              "type": "text",
              "text": " delivers photo results using an in-memory wrapper object called "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "// AVCapturePhotoOutput* photoOutput;",
            "...",
            "// Check that portrait effects matte delivery is supported on this particular device:",
            "if (self.photoOutput.portraitEffectsMatteDeliverySupported) {",
            "    self.photoOutput.portraitEffectsMatteDeliveryEnabled = YES;",
            "}"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "3027157",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If you’ve opted in for portrait effects matte delivery, you can inspect the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcaptureresolvedphotosettings"
            },
            {
              "type": "text",
              "text": " passed to you in your "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotocapturedelegate"
            },
            {
              "type": "text",
              "text": ", and read the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcaptureresolvedphotosettings/2977533-portraiteffectsmattedimensions"
            },
            {
              "type": "text",
              "text": " property to see what size matting image will be delivered, instead of hard-coding assumptions about the size."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Even if your app opts in to matte delivery, you're not guaranteed delivery of a matting image in the resulting "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto"
            },
            {
              "type": "text",
              "text": ". The neural network responsible for generating portrait effects mattes is trained to detect and segment people. If there are no people in the image scene, the image won't benefit from a portrait effects matte, so none is delivered. The "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto"
            },
            {
              "type": "text",
              "text": " object has a new read-only accessor property in iOS 12 for accessing the image’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977523-portraiteffectsmatte"
            },
            {
              "type": "text",
              "text": ". If you read this property and its return value is "
            },
            {
              "type": "codeVoice",
              "code": "nil"
            },
            {
              "type": "text",
              "text": ", no portrait effects matte was generated for the image (because none was needed). The camera generates the matte image as a post-processing step, so you can't check whether a matte will be generated before capturing the photo. The best you can do is check for detected faces by using "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avmetadatafaceobject"
            },
            {
              "type": "text",
              "text": " and enabling depth and portrait effects matte."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The portrait effects matte algorithm uses a combination of person segmentation and depth as a refinement, so matte delivery is only supported for cameras and camera formats that support depth. Portrait effects matte images shouldn't be embedded in image files that contain no depth image; the two should travel together. This rule is enforced at the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput"
            },
            {
              "type": "text",
              "text": " level. If you opt in for portrait effects matte delivery and ask for it to be embedded in the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephotooutput"
            },
            {
              "type": "text",
              "text": " container, you must also opt in for embedded depth data delivery."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Write a Captured Portrait Effects Matte to Disk",
          "anchor": "3027382"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto"
            },
            {
              "type": "text",
              "text": " offers clients access to the underlying in-memory file container using "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2873919-filedatarepresentation"
            },
            {
              "type": "text",
              "text": ". The resulting "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsdata"
            },
            {
              "type": "text",
              "text": " is suitable for writing to disk as a HEIC or JPEG file. To replace or strip the portrait effects matte in the image file, call "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturephoto/2977522-filedatarepresentationwithcustom"
            },
            {
              "type": "text",
              "text": ", which invokes a customizer object to modify, replace, or strip various pieces of the image before packaging it into a container suitable for writing to disk."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Both JPEG and HEIC files can store embedded portrait effects matte data. When stored in JFIF/JPEG, the matte is compressed using JPEG. When stored in HEIC files, it's compressed using the HEVC codec. The matting images tend to contain large areas of flat black or white, so they compress to a file size smaller than iOS 11 photos. "
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}