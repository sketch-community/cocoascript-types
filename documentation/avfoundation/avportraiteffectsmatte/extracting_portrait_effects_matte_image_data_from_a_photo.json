{
  "abstract": [
    {
      "type": "text",
      "text": "Check for portrait effects matte metadata in existing images."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/avfoundation",
        "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture",
        "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 3026013,
  "kind": "article",
  "metadata": {
    "title": "Extracting Portrait Effects Matte Image Data from a Photo",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "AVFoundation"
      }
    ]
  },
  "schemaVersion": {
    "major": 1,
    "minor": 0,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/avfoundation": {
      "title": "AVFoundation",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation",
      "url": "/documentation/avfoundation",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture": {
      "title": "Cameras and Media Capture",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/cameras_and_media_capture",
      "url": "/documentation/avfoundation/cameras_and_media_capture",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte": {
      "title": "AVPortraitEffectsMatte",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avportraiteffectsmatte"
    },
    "devLink-1746840": {
      "identifier": "devLink-1746840",
      "type": "link",
      "title": "Image IO Framework",
      "url": "https://developer.apple.com/library/archive/releasenotes/General/WhatsNewIniOS/Articles/iOS6.html#//apple_ref/doc/uid/TP40011812-SW15"
    },
    "doc://com.apple.documentation/documentation/imageio/kcgimageauxiliarydatatypeportraiteffectsmatte": {
      "title": "kCGImageAuxiliaryDataTypePortraitEffectsMatte",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/imageio/kcgimageauxiliarydatatypeportraiteffectsmatte",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/imageio/kcgimageauxiliarydatatypeportraiteffectsmatte"
    },
    "doc://com.apple.documentation/documentation/imageio/cgimagemetadataref": {
      "title": "CGImageMetadataRef",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/imageio/cgimagemetadataref",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/imageio/cgimagemetadataref"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976125-portraiteffectsmattefromdictiona": {
      "title": "portraitEffectsMatteFromDictionaryRepresentation:error:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976125-portraiteffectsmattefromdictiona",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/2976125-portraiteffectsmattefromdictiona",
      "fragments": [
        {
          "kind": "text",
          "text": "+ "
        },
        {
          "kind": "identifier",
          "text": "portraitEffectsMatteFromDictionaryRepresentation:error:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/coreimage/ciimage": {
      "title": "CIImage",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/ciimage",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/coreimage/ciimage"
    },
    "doc://com.apple.documentation/documentation/uikit/uiimage": {
      "title": "UIImage",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/uiimage",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/uikit/uiimage"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo#3030077": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo#3030077",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo#3030077"
    },
    "doc://com.apple.documentation/documentation/imageio/cgimagedestinationref": {
      "title": "CGImageDestinationRef",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/imageio/cgimagedestinationref",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/imageio/cgimagedestinationref"
    },
    "doc://com.apple.documentation/documentation/corevideo/1563591-pixel_format_identifiers/kcvpixelformattype_onecomponent8": {
      "title": "kCVPixelFormatType_OneComponent8",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/corevideo/1563591-pixel_format_identifiers/kcvpixelformattype_onecomponent8",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/corevideo/1563591-pixel_format_identifiers/kcvpixelformattype_onecomponent8"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avdepthdata": {
      "title": "AVDepthData",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avdepthdata",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avdepthdata"
    },
    "link-media-3030225": {
      "identifier": "link-media-3030225",
      "type": "link",
      "title": "Figure 1",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo#3030225"
    },
    "media-3030225": {
      "identifier": "media-3030225",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 652,
            "height": 296
          },
          "url": "https://docs-assets.developer.apple.com/published/487779e026/145508c9-530b-4244-9473-0f12a1d676fd.png"
        }
      ],
      "alt": "Juxtaposition of the depth map and portrait effects matte of a photo showing a girl holding a flower.",
      "title": "Figure 1"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo": {
      "title": "Extracting Portrait Effects Matte Image Data from a Photo",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo",
      "kind": "article",
      "role": "article",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/extracting_portrait_effects_matte_image_data_from_a_photo",
      "abstract": [
        {
          "type": "text",
          "text": "Check for portrait effects matte metadata in existing images."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976121-mattingimage": {
      "title": "mattingImage",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976121-mattingimage",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/2976121-mattingimage",
      "abstract": [
        {
          "type": "text",
          "text": "The portrait effects matte's internal image, formatted as a pixel buffer."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976122-pixelformattype": {
      "title": "pixelFormatType",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976122-pixelformattype",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/2976122-pixelformattype",
      "abstract": [
        {
          "type": "text",
          "text": "The pixel format type of this portrait effects matte's internal image."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976120-dictionaryrepresentationforauxil": {
      "title": "dictionaryRepresentationForAuxiliaryDataType:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976120-dictionaryrepresentationforauxil",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avportraiteffectsmatte/2976120-dictionaryrepresentationforauxil",
      "abstract": [
        {
          "type": "text",
          "text": "A dictionary of primitive map information used for writing an image file with a portrait effects matte."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "dictionaryRepresentationForAuxiliaryDataType:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976121-mattingimage",
        "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976122-pixelformattype",
        "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976120-dictionaryrepresentationforauxil"
      ],
      "title": "Examining a Portrait Effects Matte",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The portrait effects matte is stored in the image file alongside the depth data auxiliary image. You can load, view, and edit the portrait effects matte as a high-level object called an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte"
            },
            {
              "type": "text",
              "text": ", analogous to "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avdepthdata"
            },
            {
              "type": "text",
              "text": ". This mirrors traditional depth map access using "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avdepthdata"
            },
            {
              "type": "text",
              "text": " in its technique to get the elementary auxiliary image bits out of the file."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-3030225",
              "metadata": {
                "anchor": "3030225",
                "title": "Figure 1"
              }
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Load and View a Matting Image from File",
          "anchor": "3030076"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Load the portrait effects matte by using the "
            },
            {
              "type": "link",
              "title": "Image IO Framework",
              "destination": "https://developer.apple.com/library/archive/releasenotes/General/WhatsNewIniOS/Articles/iOS6.html#//apple_ref/doc/uid/TP40011812-SW15"
            },
            {
              "type": "text",
              "text": " to extract an auxiliary image of type "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/imageio/kcgimageauxiliarydatatypeportraiteffectsmatte"
            },
            {
              "type": "text",
              "text": ". Convert this auxiliary image to an auxiliary information dictionary, which contains the matte as metadata of class "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/imageio/cgimagemetadataref"
            },
            {
              "type": "text",
              "text": ". Generate the portrait effects matte object, "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte"
            },
            {
              "type": "text",
              "text": ", by passing the dictionary to "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avportraiteffectsmatte/2976125-portraiteffectsmattefromdictiona"
            },
            {
              "type": "text",
              "text": ". From this object, you can generate a "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/coreimage/ciimage"
            },
            {
              "type": "text",
              "text": " object to bring the image into viewable forms, like "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/uikit/uiimage"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "- (UIImage*) portraitEffectsMatteImageAtPath: (NSString*)path",
            "{",
            "    // Convert image path to a file URL:",
            "    NSString* bundlePath = [NSBundle mainBundle].bundlePath;",
            "    NSString* filePath = [bundlePath stringByAppendingPathComponent:path];",
            "    CFURLRef urlRef = CFBridgingRetain([NSURL fileURLWithPath:filePath]);",
            "    ",
            "    // Get reference to the image data:",
            "    CGImageSourceRef source = CGImageSourceCreateWithURL(urlRef, nil);",
            "    ",
            "    // Query for auxiliary data of specific type:",
            "    CFDictionaryRef auxiliaryInfoDict = CGImageSourceCopyAuxiliaryDataInfoAtIndex(source, 0, kCGImageAuxiliaryDataTypePortraitEffectsMatte);",
            "    ",
            "    NSDictionary* auxDataDictionary = (__bridge NSDictionary*)auxiliaryInfoDict;",
            "    if (auxDataDictionary) {",
            "        AVPortraitEffectsMatte* matteData = [AVPortraitEffectsMatte portraitEffectsMatteFromDictionaryRepresentation:auxDataDictionary error:nil];",
            "        ",
            "        // Load matte data into Core Image for conversion to UIImage:",
            "        CIImage* matteCIImage = [CIImage imageWithPortaitEffectsMatte:matteData];",
            "        return [UIImage imageWithCIImage:matteCIImage];",
            "    }",
            "    else {",
            "        return nil;",
            "    }",
            "}"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "3030077",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "With this matte image, your app can: "
            }
          ]
        },
        {
          "type": "unorderedList",
          "items": [
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Access the uncompressed pixels of the portrait effects matte in memory."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Create rotated or flipped derivative copies of the mask."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Replace a pixel of the matte with one of your own, reflecting an effect you're applying to the main image."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Create a dictionary of elementary PEM parts suitable for writing to a file using Image I/O’s "
                    },
                    {
                      "type": "reference",
                      "isActive": true,
                      "identifier": "doc://com.apple.documentation/documentation/imageio/cgimagedestinationref"
                    },
                    {
                      "type": "text",
                      "text": "."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When decompressed, the matte images are natively L008 ("
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/corevideo/1563591-pixel_format_identifiers/kcvpixelformattype_onecomponent8"
            },
            {
              "type": "text",
              "text": "), which is an 8-bit one-component format where black is zero. Portrait effects matte images are not gamma corrected. They're tagged with a linear transfer function, indicating that no color correction should be applied when working with them."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2020 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}