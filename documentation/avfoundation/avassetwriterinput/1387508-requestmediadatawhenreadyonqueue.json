{
  "abstract": [
    {
      "type": "text",
      "text": "Instructs the receiver to invoke a block repeatedly, at its convenience, to gather media data for writing to the output."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/avfoundation",
        "doc://com.apple.documentation/documentation/avfoundation/media_assets_and_metadata",
        "doc://com.apple.documentation/documentation/avfoundation/media_assets_and_metadata/sample-level_reading_and_writing",
        "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenreadyonqueue",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 1387508,
  "kind": "symbol",
  "metadata": {
    "title": "requestMediaDataWhenReadyOnQueue:usingBlock:",
    "role": "symbol",
    "roleHeading": "Instance Method",
    "modules": [
      {
        "name": "AVFoundation"
      }
    ],
    "platforms": [
      {
        "name": "iOS",
        "introducedAt": "4.1",
        "current": "14.3"
      },
      {
        "name": "macOS",
        "introducedAt": "10.7",
        "current": "11.1"
      },
      {
        "name": "Mac Catalyst",
        "introducedAt": "13.0",
        "current": "14.3"
      },
      {
        "name": "tvOS",
        "introducedAt": "9.0",
        "current": "14.3"
      }
    ],
    "externalID": "c:objc(cs)AVAssetWriterInput(im)requestMediaDataWhenReadyOnQueue:usingBlock:",
    "symbolKind": "instm"
  },
  "schemaVersion": {
    "major": 1,
    "minor": 0,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenreadyonqueue"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenready"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/avfoundation": {
      "title": "AVFoundation",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation",
      "url": "/documentation/avfoundation",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/avfoundation/media_assets_and_metadata": {
      "title": "Media Assets and Metadata",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/media_assets_and_metadata",
      "url": "/documentation/avfoundation/media_assets_and_metadata",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/avfoundation/media_assets_and_metadata/sample-level_reading_and_writing": {
      "title": "Sample-level Reading and Writing",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/media_assets_and_metadata/sample-level_reading_and_writing",
      "url": "/documentation/avfoundation/media_assets_and_metadata/sample-level_reading_and_writing",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput": {
      "title": "AVAssetWriterInput",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avassetwriterinput",
      "abstract": [
        {
          "type": "text",
          "text": "A writer used to append media samples to a single track of an asset writer's output file."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389084-readyformoremediadata": {
      "title": "readyForMoreMediaData",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389084-readyformoremediadata",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avassetwriterinput/1389084-readyformoremediadata",
      "abstract": [
        {
          "type": "text",
          "text": "A Boolean value that indicates the readiness of the input to accept more media data."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/objectivec/no": {
      "title": "NO",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/objectivec/no",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/objectivec/no"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1390122-markasfinished": {
      "title": "markAsFinished",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1390122-markasfinished",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avassetwriterinput/1390122-markasfinished",
      "abstract": [
        {
          "type": "text",
          "text": "Tells the writer it can't append more buffers to this input."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "markAsFinished"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenreadyonqueue#2555994": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenreadyonqueue#2555994",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenreadyonqueue#2555994"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcaptureaudiodataoutput": {
      "title": "AVCaptureAudioDataOutput",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcaptureaudiodataoutput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcaptureaudiodataoutput"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avcapturevideodataoutput": {
      "title": "AVCaptureVideoDataOutput",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturevideodataoutput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avcapturevideodataoutput"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avassetreaderoutput": {
      "title": "AVAssetReaderOutput",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetreaderoutput",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avassetreaderoutput"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389566-appendsamplebuffer": {
      "title": "appendSampleBuffer:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389566-appendsamplebuffer",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avassetwriterinput/1389566-appendsamplebuffer",
      "abstract": [
        {
          "type": "text",
          "text": "Appends samples to the receiver."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "appendSampleBuffer:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1387827-expectsmediadatainrealtime": {
      "title": "expectsMediaDataInRealTime",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1387827-expectsmediadatainrealtime",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avassetwriterinput/1387827-expectsmediadatainrealtime"
    },
    "doc://com.apple.documentation/documentation/objectivec/yes": {
      "title": "YES",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/objectivec/yes",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/objectivec/yes"
    },
    "doc://com.apple.documentation/documentation/dispatch/dispatch_queue_t": {
      "title": "dispatch_queue_t",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/dispatch/dispatch_queue_t",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/dispatch/dispatch_queue_t"
    },
    "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenreadyonqueue": {
      "title": "requestMediaDataWhenReadyOnQueue:usingBlock:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenreadyonqueue",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/avfoundation/avassetwriterinput/1387508-requestmediadatawhenreadyonqueue",
      "abstract": [
        {
          "type": "text",
          "text": "Instructs the receiver to invoke a block repeatedly, at its convenience, to gather media data for writing to the output."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "requestMediaDataWhenReadyOnQueue:usingBlock:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389566-appendsamplebuffer",
        "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389084-readyformoremediadata",
        "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1390122-markasfinished"
      ],
      "title": "Adding Media Samples",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "declarations",
      "declarations": [
        {
          "languages": [
            "occ"
          ],
          "tokens": [
            {
              "kind": "text",
              "text": "- ("
            },
            {
              "kind": "keyword",
              "text": "void"
            },
            {
              "kind": "text",
              "text": ")"
            },
            {
              "kind": "identifier",
              "text": "requestMediaDataWhenReadyOnQueue:"
            },
            {
              "kind": "text",
              "text": "("
            },
            {
              "kind": "typeIdentifier",
              "preciseIdentifier": "c:@T@dispatch_queue_t",
              "identifier": "doc://com.apple.documentation/documentation/dispatch/dispatch_queue_t",
              "text": "dispatch_queue_t"
            },
            {
              "kind": "text",
              "text": ")"
            },
            {
              "kind": "internalParam",
              "text": "queue"
            },
            {
              "kind": "text",
              "text": " "
            },
            {
              "kind": "identifier",
              "text": "usingBlock:"
            },
            {
              "kind": "text",
              "text": "("
            },
            {
              "kind": "keyword",
              "text": "void"
            },
            {
              "kind": "text",
              "text": " (^)("
            },
            {
              "kind": "keyword",
              "text": "void"
            },
            {
              "kind": "text",
              "text": ")"
            },
            {
              "kind": "text",
              "text": ")"
            },
            {
              "kind": "internalParam",
              "text": "block"
            },
            {
              "kind": "text",
              "text": ";"
            }
          ],
          "platforms": [
            "iOS",
            "macOS",
            "Mac Catalyst",
            "tvOS"
          ]
        }
      ]
    },
    {
      "kind": "parameters",
      "languages": [
        "occ"
      ],
      "parameters": [
        {
          "name": "queue",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "The queue on which "
                },
                {
                  "type": "codeVoice",
                  "code": "block"
                },
                {
                  "type": "text",
                  "text": " should be invoked."
                }
              ]
            }
          ]
        },
        {
          "name": "block",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "The block the input should invoke to obtain media data."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "kind": "content",
      "content": [
        {
          "anchor": "discussion",
          "level": 2,
          "text": "Discussion",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The block should append media data to the input either until the input’s "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389084-readyformoremediadata"
            },
            {
              "type": "text",
              "text": " property becomes "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/no"
            },
            {
              "type": "text",
              "text": " or until there is no more media data to supply (at which point it may choose to mark the input as finished using "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1390122-markasfinished"
            },
            {
              "type": "text",
              "text": "). The block should then exit. After the block exits, if the input has not been marked as finished, once the input has processed the media data it has received and becomes ready for more media data again, it will invoke the block again in order to obtain more."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "A typical use of this method, with a block that supplies media data to an input while respecting the input’s "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389084-readyformoremediadata"
            },
            {
              "type": "text",
              "text": " property, might look like this:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "[myAVAssetWriterInput requestMediaDataWhenReadyOnQueue:myInputSerialQueue usingBlock:^{",
            "        while ([myAVAssetWriterInput isReadyForMoreMediaData])",
            "        {",
            "            CMSampleBufferRef nextSampleBuffer = [self copyNextSampleBufferToWrite];",
            "            if (nextSampleBuffer)",
            "            {",
            "                [myAVAssetWriterInput appendSampleBuffer:nextSampleBuffer];",
            "                CFRelease(nextSampleBuffer);",
            "            }",
            "            else",
            "            {",
            "                [myAVAssetWriterInput markAsFinished];",
            "                break;",
            "            }",
            "        }",
            "    }];"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "2555994",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "You should not use this method with a push-style buffer source, such as "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcaptureaudiodataoutput"
            },
            {
              "type": "text",
              "text": " or "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avcapturevideodataoutput"
            },
            {
              "type": "text",
              "text": ", because such a combination will typically require intermediate queueing of buffers. Instead, this method is better suited to a pull-style buffer source such as an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetreaderoutput"
            },
            {
              "type": "text",
              "text": " object."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When using a push-style buffer source, it is generally better to immediately append each buffer to the asset writer input, directly as it is received using "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1389566-appendsamplebuffer"
            },
            {
              "type": "text",
              "text": ". Using this strategy, it is often possible to avoid having to queue up buffers in between the buffer source and the asset writer input. Note that many of these push-style buffer sources also produce buffers in real-time, in which case you should set "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/avfoundation/avassetwriterinput/1387827-expectsmediadatainrealtime"
            },
            {
              "type": "text",
              "text": " to "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/yes"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2020 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}