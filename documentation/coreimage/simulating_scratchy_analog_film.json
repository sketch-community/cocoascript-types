{
  "abstract": [
    {
      "type": "text",
      "text": "Degrade the quality of an image to make it look like dated, scratchy analog film."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/coreimage"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2953439,
  "kind": "article",
  "metadata": {
    "title": "Simulating Scratchy Analog Film",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "Core Image"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/coreimage/simulating_scratchy_analog_film"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/coreimage/simulating_scratchy_analog_film"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/coreimage": {
      "title": "Core Image",
      "identifier": "doc://com.apple.documentation/documentation/coreimage",
      "url": "/documentation/coreimage",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953582": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953582",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953582"
    },
    "doc://com.apple.documentation/documentation/gameplaykit": {
      "title": "GameplayKit",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/gameplaykit",
      "kind": "article",
      "role": "collection",
      "url": "/documentation/gameplaykit"
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953585": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953585",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953585"
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953583": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953583",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953583"
    },
    "link-media-2960179": {
      "identifier": "link-media-2960179",
      "type": "link",
      "title": "Figure 2",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2960179"
    },
    "media-2960179": {
      "identifier": "media-2960179",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 200,
            "height": 200
          },
          "url": "https://docs-assets.developer.apple.com/published/1f02fba474/2960179@2x.png"
        },
        {
          "traits": [
            "dark",
            "2x"
          ],
          "size": {
            "width": 200,
            "height": 200
          },
          "url": "https://docs-assets.developer.apple.com/published/ba500c44cd/2960179~dark@2x.png"
        }
      ],
      "alt": "Image of white dots on a transaprent background, used to simulate grain on an old photo",
      "title": "Figure 2",
      "abstract": [
        {
          "type": "text",
          "text": "White speckle grain created from a whitening "
        },
        {
          "type": "codeVoice",
          "code": "CIColorMatrix"
        },
        {
          "type": "text",
          "text": " applied to "
        },
        {
          "type": "codeVoice",
          "code": "CIRandomGenerator"
        },
        {
          "type": "text",
          "text": " noise"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953584": {
      "title": "Listing 4",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953584",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953584"
    },
    "doc://com.apple.documentation/documentation/coregraphics/cgaffinetransform": {
      "title": "CGAffineTransform",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/coregraphics/cgaffinetransform",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/coregraphics/cgaffinetransform"
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953588": {
      "title": "Listing 5",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953588",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953588"
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953586": {
      "title": "Listing 6",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953586",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953586"
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953587": {
      "title": "Listing 7",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953587",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953587"
    },
    "link-media-2960180": {
      "identifier": "link-media-2960180",
      "type": "link",
      "title": "Figure 3",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2960180"
    },
    "media-2960180": {
      "identifier": "media-2960180",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 200,
            "height": 200
          },
          "url": "https://docs-assets.developer.apple.com/published/bff31900ad/2960180@2x.png"
        },
        {
          "traits": [
            "dark",
            "2x"
          ],
          "size": {
            "width": 200,
            "height": 200
          },
          "url": "https://docs-assets.developer.apple.com/published/83b97798d9/2960180~dark@2x.png"
        }
      ],
      "alt": "Image of black lines on a white background, used to simulate scratches on an old photo",
      "title": "Figure 3",
      "abstract": [
        {
          "type": "text",
          "text": "Dark scratches created from a darkening "
        },
        {
          "type": "codeVoice",
          "code": "CIColorMatrix"
        },
        {
          "type": "text",
          "text": " applied to "
        },
        {
          "type": "codeVoice",
          "code": "CIRandomGenerator"
        },
        {
          "type": "text",
          "text": " noise"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953590": {
      "title": "Listing 8",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953590",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953590"
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953589": {
      "title": "Listing 9",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film#2953589",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2953589"
    },
    "link-media-2959656": {
      "identifier": "link-media-2959656",
      "type": "link",
      "title": "Figure 4",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2959656"
    },
    "media-2959656": {
      "identifier": "media-2959656",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 551,
            "height": 413
          },
          "url": "https://docs-assets.developer.apple.com/published/7732402b70/2959656@2x.png"
        },
        {
          "traits": [
            "dark",
            "2x"
          ],
          "size": {
            "width": 551,
            "height": 413
          },
          "url": "https://docs-assets.developer.apple.com/published/3bc2e8581a/2959656~dark@2x.png"
        }
      ],
      "alt": "Sepia-toned image of fruit augmented with speckle grain and dark scratches.",
      "title": "Figure 4",
      "abstract": [
        {
          "type": "text",
          "text": "Final result of "
        },
        {
          "type": "codeVoice",
          "code": "CIMultiplyCompositing"
        },
        {
          "type": "text",
          "text": " the source image with grain and scratches."
        }
      ]
    },
    "link-media-2959650": {
      "identifier": "link-media-2959650",
      "type": "link",
      "title": "Figure 1",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film#2959650"
    },
    "media-2959650": {
      "identifier": "media-2959650",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 645,
            "height": 656
          },
          "url": "https://docs-assets.developer.apple.com/published/1fe35365cb/687b0540-b9c6-43ea-a3b4-56e5d5467090.png"
        },
        {
          "traits": [
            "1x"
          ],
          "size": {
            "width": 645,
            "height": 656
          },
          "url": "https://docs-assets.developer.apple.com/published/ff3a7d4dd8/6b723dd2-af59-4a0c-a87a-5bb486d55441.png"
        }
      ],
      "alt": "Compositing scratchy analog film by compositing results from CIFilter objects",
      "title": "Figure 1",
      "abstract": [
        {
          "type": "text",
          "text": "Combine filtered white noise with dark scratches to the "
        },
        {
          "type": "codeVoice",
          "code": "CISepiaTone"
        },
        {
          "type": "text",
          "text": " filter to create an old analog film effect"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/coreimage/applying_a_chroma_key_effect": {
      "title": "Applying a Chroma Key Effect",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/applying_a_chroma_key_effect",
      "kind": "article",
      "role": "article",
      "url": "/documentation/coreimage/applying_a_chroma_key_effect",
      "abstract": [
        {
          "type": "text",
          "text": "Replace a color in one image with the background from another."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/coreimage/selectively_focusing_on_an_image": {
      "title": "Selectively Focusing on an Image",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/selectively_focusing_on_an_image",
      "kind": "article",
      "role": "article",
      "url": "/documentation/coreimage/selectively_focusing_on_an_image",
      "abstract": [
        {
          "type": "text",
          "text": "Focus on a part of an image by applying Gaussian blur and gradient masks."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/coreimage/customizing_image_transitions": {
      "title": "Customizing Image Transitions",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/customizing_image_transitions",
      "kind": "article",
      "role": "article",
      "url": "/documentation/coreimage/customizing_image_transitions",
      "abstract": [
        {
          "type": "text",
          "text": "Transition between images in creative ways using Core Image filters."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film": {
      "title": "Simulating Scratchy Analog Film",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/coreimage/simulating_scratchy_analog_film",
      "kind": "article",
      "role": "article",
      "url": "/documentation/coreimage/simulating_scratchy_analog_film",
      "abstract": [
        {
          "type": "text",
          "text": "Degrade the quality of an image to make it look like dated, scratchy analog film."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/coreimage/applying_a_chroma_key_effect",
        "doc://com.apple.documentation/documentation/coreimage/selectively_focusing_on_an_image",
        "doc://com.apple.documentation/documentation/coreimage/customizing_image_transitions"
      ],
      "title": "Filter Recipes",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The "
            },
            {
              "type": "codeVoice",
              "code": "CISepiaTone"
            },
            {
              "type": "text",
              "text": " filter changes the tint of an image to a reddish-brownish hue resembling old analog photographs.  You can enhance the effect by applying random specks and scratches."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-2959650",
              "metadata": {
                "anchor": "2959650",
                "title": "Figure 1",
                "abstract": [
                  {
                    "type": "text",
                    "text": "Combine filtered white noise with dark scratches to the "
                  },
                  {
                    "type": "codeVoice",
                    "code": "CISepiaTone"
                  },
                  {
                    "type": "text",
                    "text": " filter to create an old analog film effect"
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The following steps leverage built-in Core Image filters to tint and texture an image to look as if it were analog film:"
            }
          ]
        },
        {
          "type": "orderedList",
          "items": [
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Apply the "
                    },
                    {
                      "type": "codeVoice",
                      "code": "CISepiaTone"
                    },
                    {
                      "type": "text",
                      "text": " filter."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Create randomly varying white specks to simulate grain. "
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Create randomly varying dark scratches to simulate scratchy film. "
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Composite the speckle image and scratches onto the sepia-toned image."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Apply the Sepia Tone Filter to the Original Image",
          "anchor": "2953506"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Tint the original image by applying the "
            },
            {
              "type": "codeVoice",
              "code": "CISepiaTone"
            },
            {
              "type": "text",
              "text": " filter."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CIFilter* sepiaFilter = [CIFilter filterWithName:@\"CISepiaTone\"];",
            "[sepiaFilter setValue:inputImage forKey:kCIInputImageKey];",
            "[sepiaFilter setValue:@(1.0) forKey:kCIInputIntensityKey];",
            "CIImage* sepiaCIImage = sepiaFilter.outputImage;"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953582",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The output of this filter will become the background for compositing the grain image."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Simulate Grain by Creating Randomly Varying Speckle",
          "anchor": "2953505"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "You can use the output of the "
            },
            {
              "type": "codeVoice",
              "code": "CIRandomGenerator"
            },
            {
              "type": "text",
              "text": " filter as a basis for random noise images. Even though the noise pattern is not customizable in size, it can be extended and cropped to fit the image."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "The image output from "
                },
                {
                  "type": "codeVoice",
                  "code": "CIRandomGenerator"
                },
                {
                  "type": "text",
                  "text": " is always the same; even if you reseed your random number generator, the image output from this filter is always the same 512x512 pattern.  However, it is suitable for giving the appearance of randomness.  For truly random noise generation, see "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/gameplaykit"
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ],
          "style": "note",
          "name": "Note"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The filter takes no inputs."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CIFilter* colorNoise = [CIFilter filterWithName:@\"CIRandomGenerator\"];",
            "CIImage* noiseImage = colorNoise.outputImage;"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953585",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Next, apply a whitening effect by chaining the noise output to a "
            },
            {
              "type": "codeVoice",
              "code": "CIColorMatrix"
            },
            {
              "type": "text",
              "text": " filter.  This built-in filter multiplies the noise color values individually and applies a bias to each component.  For white grain, apply whitening to the y-component of RGB and no bias. "
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CIFilter* whiteningFilter = [CIFilter filterWithName:@\"CIColorMatrix\"];",
            "CIVector* whitenVector = [CIVector vectorWithX:0 Y:1 Z:0 W:0];",
            "CIVector* fineGrain = [CIVector vectorWithX:0 Y:0.005 Z:0 W:0];",
            "CIVector* zeroVector = [CIVector vectorWithX:0 Y:0 Z:0 W:0];",
            "[whiteningFilter setValue:noiseImage forKey:kCIInputImageKey];",
            "[whiteningFilter setValue:whitenVector forKey:@\"inputRVector\"];",
            "[whiteningFilter setValue:whitenVector forKey:@\"inputGVector\"];",
            "[whiteningFilter setValue:whitenVector forKey:@\"inputBVector\"];",
            "[whiteningFilter setValue:fineGrain forKey:@\"inputAVector\"];",
            "[whiteningFilter setValue:zeroVector forKey:@\"inputBiasVector\"];",
            "CIImage* whiteSpecks = whiteningFilter.outputImage;"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953583",
            "title": "Listing 3"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The "
            },
            {
              "type": "codeVoice",
              "code": "whiteSpecks"
            },
            {
              "type": "text",
              "text": " resulting from this filter have the appearance of spotty grain when viewed as an image."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-2960179",
              "metadata": {
                "anchor": "2960179",
                "title": "Figure 2",
                "abstract": [
                  {
                    "type": "text",
                    "text": "White speckle grain created from a whitening "
                  },
                  {
                    "type": "codeVoice",
                    "code": "CIColorMatrix"
                  },
                  {
                    "type": "text",
                    "text": " applied to "
                  },
                  {
                    "type": "codeVoice",
                    "code": "CIRandomGenerator"
                  },
                  {
                    "type": "text",
                    "text": " noise"
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create the grainy image by compositing the whitened noise as input over the sepia-toned source image using the "
            },
            {
              "type": "codeVoice",
              "code": "CISourceOverCompositing"
            },
            {
              "type": "text",
              "text": " filter."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CIFilter* speckCompositor = [CIFilter filterWithName:@\"CISourceOverCompositing\"];",
            "[speckCompositor setValue:whiteSpecks forKey:kCIInputImageKey];",
            "[speckCompositor setValue:sepiaCIImage forKey:kCIInputBackgroundImageKey];",
            "CIImage* speckledImage = speckCompositor.outputImage;"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953584",
            "title": "Listing 4"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Simulate Scratch by Scaling Randomly Varying Noise",
          "anchor": "2953507"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The process for applying random-looking scratches is the same as the technique used in the white grain: color the output of the "
            },
            {
              "type": "codeVoice",
              "code": "CIRandomGenerator"
            },
            {
              "type": "text",
              "text": " filter."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To make the speckle resemble scratches, scale the random noise output vertically by applying a scaling "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/coregraphics/cgaffinetransform"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CGAffineTransform verticalScale = CGAffineTransformMakeScale(1.5, 25);",
            "CIImage* transformedNoise = [noiseImage imageByApplyingTransform:verticalScale];"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953588",
            "title": "Listing 5"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Previously, you whitened the speckle image by applying the "
            },
            {
              "type": "codeVoice",
              "code": "CIColorMatrix"
            },
            {
              "type": "text",
              "text": " filter evenly across all color components.  For the dark scratches, instead focus on only the red component, setting the other vector inputs to zero.  This time, instead of multiplying the green, blue, and alpha channels, add bias "
            },
            {
              "type": "codeVoice",
              "code": "(0, 1, 1, 1)"
            },
            {
              "type": "text",
              "text": ". "
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CIFilter* darkeningFilter = [CIFilter filterWithName:@\"CIColorMatrix\"];",
            "CIVector* darkenVector = [CIVector vectorWithX:4 Y:0 Z:0 W:0];",
            "CIVector* darkenBias = [CIVector vectorWithX:0 Y:1 Z:1 W:1];",
            "[darkeningFilter setValue:transformedNoise forKey:kCIInputImageKey];",
            "[darkeningFilter setValue:darkenVector forKey:@\"inputRVector\"];",
            "[darkeningFilter setValue:zeroVector forKey:@\"inputGVector\"];",
            "[darkeningFilter setValue:zeroVector forKey:@\"inputBVector\"];",
            "[darkeningFilter setValue:zeroVector forKey:@\"inputAVector\"];",
            "[darkeningFilter setValue:darkenBias forKey:@\"inputBiasVector\"];",
            "CIImage* randomScratches = darkeningFilter.outputImage;"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953586",
            "title": "Listing 6"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The resulting scratches are cyan, so grayscale them using the "
            },
            {
              "type": "codeVoice",
              "code": "CIMinimumComponentFilter"
            },
            {
              "type": "text",
              "text": ", which takes the minimum of the RGB values to produce a grayscale image."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CIFilter* grayscaleFilter = [CIFilter filterWithName:@\"CIMinimumComponent\"];",
            "[grayscaleFilter setValue:randomScratches forKey:kCIInputImageKey];",
            "CIImage* darkScratches = grayscaleFilter.outputImage;"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953587",
            "title": "Listing 7"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The grayscale filter produces random lines that resemble dark scratches."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-2960180",
              "metadata": {
                "anchor": "2960180",
                "title": "Figure 3",
                "abstract": [
                  {
                    "type": "text",
                    "text": "Dark scratches created from a darkening "
                  },
                  {
                    "type": "codeVoice",
                    "code": "CIColorMatrix"
                  },
                  {
                    "type": "text",
                    "text": " applied to "
                  },
                  {
                    "type": "codeVoice",
                    "code": "CIRandomGenerator"
                  },
                  {
                    "type": "text",
                    "text": " noise"
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Composite the Specks and Scratches to the Sepia Image",
          "anchor": "2953504"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Now that the components are set, you can add the scratches to the grainy sepia image produced earlier.  However, unlike the grainy texture, the scratches impact the image multiplicatively.  Instead of the "
            },
            {
              "type": "codeVoice",
              "code": "CISourceOverCompositing"
            },
            {
              "type": "text",
              "text": " filter, which composites source over background, use the "
            },
            {
              "type": "codeVoice",
              "code": "CIMultiplyCompositing"
            },
            {
              "type": "text",
              "text": " filter to compose the scratches multiplicatively.  Set the scratched image as the filter’s input image, and tab the speckle-composited sepia image as the input background image."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CIFilter* oldFilmCompositor = [CIFilter filterWithName:@\"CIMultiplyCompositing\"];",
            "[oldFilmCompositor setValue:darkScratches forKey:kCIInputImageKey];",
            "[oldFilmCompositor setValue:speckledImage forKey:kCIInputBackgroundImageKey];",
            "CIImage* oldFilmImage = oldFilmCompositor.outputImage;"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953590",
            "title": "Listing 8"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Since the noise images had different dimensions than the source image, crop the composited result to the original image size to remove excess beyond the original extent."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "CIImage* finalImage = [oldFilmImage imageByCroppingToRect:inputImage.extent];"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2953589",
            "title": "Listing 9"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The cropped image represents the final result: a sepia-toned image with simulated grain and scratches composited to give it an analog film appearance."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-2959656",
              "metadata": {
                "anchor": "2959656",
                "title": "Figure 4",
                "abstract": [
                  {
                    "type": "text",
                    "text": "Final result of "
                  },
                  {
                    "type": "codeVoice",
                    "code": "CIMultiplyCompositing"
                  },
                  {
                    "type": "text",
                    "text": " the source image with grain and scratches."
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": []
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}