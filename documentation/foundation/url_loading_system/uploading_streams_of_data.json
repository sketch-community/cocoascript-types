{
  "abstract": [
    {
      "type": "text",
      "text": "Send a stream of data to a server."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/foundation",
        "doc://com.apple.documentation/documentation/foundation/url_loading_system"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 3037350,
  "kind": "article",
  "metadata": {
    "title": "Uploading Streams of Data",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "Foundation"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/foundation/url_loading_system/uploading_streams_of_data"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/foundation/url_loading_system/uploading_streams_of_data"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/foundation": {
      "title": "Foundation",
      "identifier": "doc://com.apple.documentation/documentation/foundation",
      "url": "/documentation/foundation",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system": {
      "title": "URL Loading System",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system",
      "url": "/documentation/foundation/url_loading_system",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlsessionconfiguration": {
      "title": "NSURLSessionConfiguration",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessionconfiguration",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlsessionconfiguration"
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlsessiontaskdelegate": {
      "title": "NSURLSessionTaskDelegate",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontaskdelegate",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlsessiontaskdelegate"
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037344": {
      "title": "Provide the Stream to the Upload Task",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037344",
      "kind": "article",
      "role": "subsection",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3037344"
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3081173": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3081173",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3081173",
      "abstract": [
        {
          "type": "text",
          "text": "Creating a URLSession with a delegate"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlsession": {
      "title": "NSURLSession",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsession",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlsession"
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlsession/1410934-uploadtaskwithstreamedrequest": {
      "title": "uploadTaskWithStreamedRequest:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsession/1410934-uploadtaskwithstreamedrequest",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlsession/1410934-uploadtaskwithstreamedrequest",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "uploadTaskWithStreamedRequest:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlrequest": {
      "title": "NSURLRequest",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlrequest",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlrequest"
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlsessiontask/1411121-resume": {
      "title": "resume",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontask/1411121-resume",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlsessiontask/1411121-resume",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "resume"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037347": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037347",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3037347",
      "abstract": [
        {
          "type": "text",
          "text": "Creating an upload task"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsinputstream": {
      "title": "NSInputStream",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsinputstream",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsinputstream"
    },
    "doc://com.apple.documentation/documentation/foundation/nsoutputstream": {
      "title": "NSOutputStream",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsoutputstream",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsoutputstream"
    },
    "link-media-3037791": {
      "identifier": "link-media-3037791",
      "type": "link",
      "title": "Figure 1",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3037791"
    },
    "media-3037791": {
      "identifier": "media-3037791",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 613,
            "height": 164
          },
          "url": "https://docs-assets.developer.apple.com/published/da31e34bc2/a29fb2be-5f7f-4c56-9ef6-4090ecfbae82.png"
        }
      ],
      "alt": "Flow diagram showing how data written by an app to the output stream of a bound pair goes into a buffer, then to the bound pair's input stream, then to the upload task, which sends it to the destination.",
      "title": "Figure 1",
      "abstract": [
        {
          "type": "text",
          "text": "Providing data to an upload task with a bound pair of streams"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsstream/1412683-getboundstreamswithbuffersize": {
      "title": "getBoundStreamsWithBufferSize:inputStream:outputStream:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsstream/1412683-getboundstreamswithbuffersize",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsstream/1412683-getboundstreamswithbuffersize",
      "fragments": [
        {
          "kind": "text",
          "text": "+ "
        },
        {
          "kind": "identifier",
          "text": "getBoundStreamsWithBufferSize:inputStream:outputStream:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsstream": {
      "title": "NSStream",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsstream",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsstream"
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037346": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037346",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3037346",
      "abstract": [
        {
          "type": "text",
          "text": "Creating a bound pair of input and output streams"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate": {
      "title": "NSStreamDelegate",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsstreamdelegate"
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037342": {
      "title": "Write Data to the Stream When It’s Ready",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037342",
      "kind": "article",
      "role": "subsection",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3037342"
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlsessiontaskdelegate/1410001-urlsession": {
      "title": "URLSession:task:needNewBodyStream:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontaskdelegate/1410001-urlsession",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlsessiontaskdelegate/1410001-urlsession",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "URLSession:task:needNewBodyStream:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037340": {
      "title": "Listing 4",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037340",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3037340",
      "abstract": [
        {
          "type": "text",
          "text": "Providing the input stream to the upload task in the delegate callback"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate/1410079-stream": {
      "title": "stream:handleEvent:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate/1410079-stream",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsstreamdelegate/1410079-stream",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "stream:handleEvent:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventhasspaceavailable": {
      "title": "NSStreamEventHasSpaceAvailable",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventhasspaceavailable",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsstreamevent/nsstreameventhasspaceavailable"
    },
    "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventerroroccurred": {
      "title": "NSStreamEventErrorOccurred",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventerroroccurred",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsstreamevent/nsstreameventerroroccurred"
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037351": {
      "title": "Listing 5",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037351",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3037351",
      "abstract": [
        {
          "type": "text",
          "text": "Handling StreamDelegate events"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsoutputstream/1410720-write": {
      "title": "write:maxLength:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsoutputstream/1410720-write",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsoutputstream/1410720-write",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "write:maxLength:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037345": {
      "title": "Listing 6",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037345",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data#3037345",
      "abstract": [
        {
          "type": "text",
          "text": "Creating a timer to write to the output stream when the stream has space available"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlsessionuploadtask": {
      "title": "NSURLSessionUploadTask",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessionuploadtask",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlsessionuploadtask"
    },
    "doc://com.apple.documentation/documentation/foundation/nsurlsessiontask": {
      "title": "NSURLSessionTask",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontask",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsurlsessiontask"
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_data_to_a_website": {
      "title": "Uploading Data to a Website",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_data_to_a_website",
      "kind": "article",
      "role": "article",
      "url": "/documentation/foundation/url_loading_system/uploading_data_to_a_website",
      "abstract": [
        {
          "type": "text",
          "text": "Post data from your app to servers."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data": {
      "title": "Uploading Streams of Data",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data",
      "kind": "article",
      "role": "article",
      "url": "/documentation/foundation/url_loading_system/uploading_streams_of_data",
      "abstract": [
        {
          "type": "text",
          "text": "Send a stream of data to a server."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_data_to_a_website"
      ],
      "title": "Uploading",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Streaming media apps and long-running apps that send continual updates use an ongoing stream to upload data, rather than sending a single block of data or a flat file. You can configure an instance of "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessionuploadtask"
            },
            {
              "type": "text",
              "text": " (a subclass of "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontask"
            },
            {
              "type": "text",
              "text": ") to work with a stream that you provide, and then fill this stream with data indefinitely."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The task gets the stream by calling your session’s delegate, so you need to create a session and set your own code as its delegate."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Create a URL Session",
          "anchor": "3081174"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Begin by creating a URLSession and providing it with a delegate. "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3081173"
            },
            {
              "type": "text",
              "text": " creates a URL session with the default "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessionconfiguration"
            },
            {
              "type": "text",
              "text": " and sets "
            },
            {
              "type": "codeVoice",
              "code": "self"
            },
            {
              "type": "text",
              "text": " as the delegate. You’ll implement "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontaskdelegate"
            },
            {
              "type": "text",
              "text": " later, in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037344"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "lazy var session: URLSession = URLSession(configuration: .default,",
            "                                          delegate: self,",
            "                                          delegateQueue: .main)",
            ""
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3081173",
            "title": "Listing 1",
            "abstract": [
              {
                "type": "text",
                "text": "Creating a URLSession with a delegate"
              }
            ]
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Create a Streaming Upload Task",
          "anchor": "3037348"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create the upload task with the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsession"
            },
            {
              "type": "text",
              "text": " method "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsession/1410934-uploadtaskwithstreamedrequest"
            },
            {
              "type": "text",
              "text": ". This takes an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlrequest"
            },
            {
              "type": "text",
              "text": " specifying the URL you want to upload to, along with other parameters. You start the task by calling "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontask/1411121-resume"
            },
            {
              "type": "text",
              "text": ". "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037347"
            },
            {
              "type": "text",
              "text": " shows how to create and start an upload task, connecting to a server on the local machine ("
            },
            {
              "type": "codeVoice",
              "code": "127.0.0.1"
            },
            {
              "type": "text",
              "text": ") listening on port "
            },
            {
              "type": "codeVoice",
              "code": "12345"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let url = URL(string: \"http://127.0.0.1:12345\")!",
            "var request = URLRequest(url: url,",
            "                         cachePolicy: .reloadIgnoringLocalCacheData,",
            "                         timeoutInterval: 10)",
            "request.httpMethod = \"POST\"",
            "let uploadTask = session.uploadTask(withStreamedRequest: request)",
            "uploadTask.resume()"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3037347",
            "title": "Listing 2",
            "abstract": [
              {
                "type": "text",
                "text": "Creating an upload task"
              }
            ]
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Use a Bound Pair of Streams to Provide an Input Stream",
          "anchor": "3037352"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "You provide the streaming data to the upload task as an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsinputstream"
            },
            {
              "type": "text",
              "text": ". The task reads data from this stream and uploads it to the destination."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "A good way to provide data to the input stream is to use a "
            },
            {
              "type": "emphasis",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "bound pair"
                }
              ]
            },
            {
              "type": "text",
              "text": " of streams. The bound pair contains an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsoutputstream"
            },
            {
              "type": "text",
              "text": " that you write data to. Thanks to the binding of the streams, the data you write to the output stream is made available to the input stream, which the task can then read from. "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "link-media-3037791"
            },
            {
              "type": "text",
              "text": " shows this arrangement."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-3037791",
              "metadata": {
                "anchor": "3037791",
                "title": "Figure 1",
                "abstract": [
                  {
                    "type": "text",
                    "text": "Providing data to an upload task with a bound pair of streams"
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037346"
            },
            {
              "type": "text",
              "text": " shows a structure called "
            },
            {
              "type": "codeVoice",
              "code": "Streams"
            },
            {
              "type": "text",
              "text": " that consists of an "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsinputstream"
            },
            {
              "type": "text",
              "text": " and an "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsoutputstream"
            },
            {
              "type": "text",
              "text": ". The listing creates a property of this type, called "
            },
            {
              "type": "codeVoice",
              "code": "boundStreams"
            },
            {
              "type": "text",
              "text": ", by calling the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstream/1412683-getboundstreamswithbuffersize"
            },
            {
              "type": "text",
              "text": " method of the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstream"
            },
            {
              "type": "text",
              "text": " class, passing in in-out references for the input and output streams."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "struct Streams {",
            "    let input: InputStream",
            "    let output: OutputStream",
            "}",
            "lazy var boundStreams: Streams = {",
            "    var inputOrNil: InputStream? = nil",
            "    var outputOrNil: OutputStream? = nil",
            "    Stream.getBoundStreams(withBufferSize: 4096,",
            "                           inputStream: &inputOrNil,",
            "                           outputStream: &outputOrNil)",
            "    guard let input = inputOrNil, let output = outputOrNil else {",
            "        fatalError(\"On return of `getBoundStreams`, both `inputStream` and `outputStream` will contain non-nil streams.\")",
            "    }",
            "    // configure and open output stream",
            "    output.delegate = self",
            "    output.schedule(in: .current, forMode: .default)",
            "    output.open()",
            "    return Streams(input: input, output: output)",
            "}()",
            ""
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3037346",
            "title": "Listing 3",
            "abstract": [
              {
                "type": "text",
                "text": "Creating a bound pair of input and output streams"
              }
            ]
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When you create the bound pair, make sure you specify a buffer size large enough to hold any data you write to the output stream, prior to the data being read from the input stream. "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037346"
            },
            {
              "type": "text",
              "text": " uses a 4096-byte buffer."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The listing also sets "
            },
            {
              "type": "codeVoice",
              "code": "self"
            },
            {
              "type": "text",
              "text": " as the output stream’s delegate. Declare that your class implements the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate"
            },
            {
              "type": "text",
              "text": " protocol in order to receive events that indicate when the output stream is ready to receive new data. You’ll provide the implementation of "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate"
            },
            {
              "type": "text",
              "text": " later, in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037342"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "Your implementations of "
                },
                {
                  "type": "reference",
                  "isActive": false,
                  "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate"
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "reference",
                  "isActive": false,
                  "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontaskdelegate"
                },
                {
                  "type": "text",
                  "text": " may be in the same class or in different classes, whichever makes more sense for your app’s architecture."
                }
              ]
            }
          ],
          "style": "tip"
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Provide the Stream to the Upload Task",
          "anchor": "3037344"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "You provide the input stream to the upload task in your implementation of the "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontaskdelegate"
            },
            {
              "type": "text",
              "text": " method "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontaskdelegate/1410001-urlsession"
            },
            {
              "type": "text",
              "text": ", which is called after you start the upload task by calling "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsurlsessiontask/1411121-resume"
            },
            {
              "type": "text",
              "text": ". The callback passes in a completion handler, which you call directly, passing in the "
            },
            {
              "type": "codeVoice",
              "code": "boundStreams.input"
            },
            {
              "type": "text",
              "text": " stream you created earlier. "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037340"
            },
            {
              "type": "text",
              "text": " shows an implementation of this method."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "func urlSession(_ session: URLSession, task: URLSessionTask,",
            "                needNewBodyStream completionHandler: @escaping (InputStream?) -> Void) {",
            "    completionHandler(boundStreams.input)",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3037340",
            "title": "Listing 4",
            "abstract": [
              {
                "type": "text",
                "text": "Providing the input stream to the upload task in the delegate callback"
              }
            ]
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Write Data to the Stream When It’s Ready",
          "anchor": "3037342"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Write data to an output stream only when the stream is ready for it. You get notified of the stream’s readiness in the "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate"
            },
            {
              "type": "text",
              "text": " method "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate/1410079-stream"
            },
            {
              "type": "text",
              "text": ". When this callback sends "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventhasspaceavailable"
            },
            {
              "type": "text",
              "text": " as its "
            },
            {
              "type": "codeVoice",
              "code": "eventCode"
            },
            {
              "type": "text",
              "text": " parameter, the stream is ready to accept more data."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If you’re not ready to write while handling the event, and would prefer to write on your own schedule, you can set a flag variable and check it later to determine whether it’s is safe to write to the stream. "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037351"
            },
            {
              "type": "text",
              "text": " illustrates this technique. It handles the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventhasspaceavailable"
            },
            {
              "type": "text",
              "text": " event by just setting a private "
            },
            {
              "type": "codeVoice",
              "code": "canWrite"
            },
            {
              "type": "text",
              "text": " property to"
            },
            {
              "type": "codeVoice",
              "code": " true."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "While handling stream events, also check whether "
            },
            {
              "type": "codeVoice",
              "code": "eventCode"
            },
            {
              "type": "text",
              "text": " is "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventerroroccurred"
            },
            {
              "type": "text",
              "text": ". This means that the stream has failed. When this happens, close the streams and abandon the upload."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "func stream(_ aStream: Stream, handle eventCode: Stream.Event) {",
            "    guard aStream == boundStreams.output else {",
            "        return",
            "    }",
            "    if eventCode.contains(.hasSpaceAvailable) {",
            "        canWrite = true",
            "    }",
            "    if eventCode.contains(.errorOccurred) {",
            "        // Close the streams and alert the user that the upload failed.",
            "    }",
            "}",
            ""
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3037351",
            "title": "Listing 5",
            "abstract": [
              {
                "type": "text",
                "text": "Handling StreamDelegate events"
              }
            ]
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Once you’re handling the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventhasspaceavailable"
            },
            {
              "type": "text",
              "text": " event, you can write to the stream whenever you know it’s ready to receive more data. You write to the stream by calling its "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsoutputstream/1410720-write"
            },
            {
              "type": "text",
              "text": " method, providing a reference to the raw bytes to be written, and the maximum number of bytes to write."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037345"
            },
            {
              "type": "text",
              "text": " uses a timer to wait for the private "
            },
            {
              "type": "codeVoice",
              "code": "canWrite"
            },
            {
              "type": "text",
              "text": " property to become true. Once this is the case, the code creates a string representing the current date and converts it to raw bytes. The listing then calls "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsoutputstream/1410720-write"
            },
            {
              "type": "text",
              "text": " to send these bytes to the output stream. Because this output stream is bound to an input stream, the upload task can then automatically read these bytes from the input stream and send them to the destination URL."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) {",
            "    [weak self] timer in",
            "    guard let self = self else { return }",
            "",
            "    if self.canWrite {",
            "        let message = \"*** \\(Date())\\r\\n\"",
            "        guard let messageData = message.data(using: .utf8) else { return }",
            "        let messageCount = messageData.count",
            "        let bytesWritten: Int = messageData.withUnsafeBytes() { (buffer: UnsafePointer<UInt8>) in",
            "            self.canWrite = false",
            "            return self.boundStreams.output.write(buffer, maxLength: messageCount)",
            "        }",
            "        if bytesWritten < messageCount {",
            "            // Handle writing less data than expected.",
            "        }",
            "    }",
            "}",
            ""
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3037345",
            "title": "Listing 6",
            "abstract": [
              {
                "type": "text",
                "text": "Creating a timer to write to the output stream when the stream has space available"
              }
            ]
          }
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "If the data you want to stream is coming from an asynchronous process, like callbacks from a media capture device, you still have to wait for the output stream to be ready before you write to it. In these situations, you can use a circular buffer to hold your data until the stream is ready to accept it."
                }
              ]
            }
          ],
          "style": "tip"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Once you write to the output stream, you can’t write again until your "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamdelegate"
            },
            {
              "type": "text",
              "text": " receives a new "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventhasspaceavailable"
            },
            {
              "type": "text",
              "text": " event. This example enforces this constraint by setting the class’ "
            },
            {
              "type": "codeVoice",
              "code": "canWrite"
            },
            {
              "type": "text",
              "text": " property to "
            },
            {
              "type": "codeVoice",
              "code": "false"
            },
            {
              "type": "text",
              "text": ". It will be reset to "
            },
            {
              "type": "codeVoice",
              "code": "true"
            },
            {
              "type": "text",
              "text": " when a new "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsstreamevent/nsstreameventhasspaceavailable"
            },
            {
              "type": "text",
              "text": " event is received by the output stream's delegate, as shown earlier in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/url_loading_system/uploading_streams_of_data#3037351"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}