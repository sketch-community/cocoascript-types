{
  "abstract": [
    {
      "type": "text",
      "text": "Provide users with a glanceable look at your app’s data."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/notificationcenter"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2994162,
  "kind": "article",
  "metadata": {
    "title": "Building a Simple Widget for the Today View",
    "role": "sampleCode",
    "roleHeading": "Sample Code",
    "modules": [
      {
        "name": "Notification Center"
      }
    ],
    "platforms": [
      {
        "name": "iOS",
        "introducedAt": "11.3",
        "current": "15.2"
      },
      {
        "name": "iPadOS",
        "introducedAt": "11.3",
        "current": "15.2"
      },
      {
        "name": "Xcode",
        "introducedAt": "10.2",
        "current": "13.2"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/notificationcenter/building_a_simple_widget_for_the_today_view"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/notificationcenter/building_a_simple_widget_for_the_today_view"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/notificationcenter": {
      "title": "Notification Center",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter",
      "url": "/documentation/notificationcenter",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199643": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199643",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199643"
    },
    "link-3021912": {
      "title": "Technical Note TN2435",
      "type": "topic",
      "identifier": "link-3021912",
      "kind": "article",
      "role": "link",
      "url": "https://developer.apple.com/library/content/technotes/tn2435/_index.html"
    },
    "doc://com.apple.documentation/documentation/uikit/uiimage/1624154-imagenamed": {
      "title": "imageNamed:inBundle:compatibleWithTraitCollection:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/uiimage/1624154-imagenamed",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/uikit/uiimage/1624154-imagenamed",
      "fragments": [
        {
          "kind": "text",
          "text": "+ "
        },
        {
          "kind": "identifier",
          "text": "imageNamed:inBundle:compatibleWithTraitCollection:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/uikit/uiimage": {
      "title": "UIImage",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/uiimage",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/uikit/uiimage"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199645": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199645",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199645"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodecompact": {
      "title": "NCWidgetDisplayModeCompact",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodecompact",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodecompact"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodeexpanded": {
      "title": "NCWidgetDisplayModeExpanded",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodeexpanded",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodeexpanded"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding/1649132-widgetactivedisplaymodedidchange": {
      "title": "widgetActiveDisplayModeDidChange:withMaximumSize:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding/1649132-widgetactivedisplaymodedidchange",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/notificationcenter/ncwidgetproviding/1649132-widgetactivedisplaymodedidchange",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "widgetActiveDisplayModeDidChange:withMaximumSize:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding": {
      "title": "NCWidgetProviding",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/notificationcenter/ncwidgetproviding",
      "abstract": [
        {
          "type": "text",
          "text": "The interface for customizing the appearance and behavior of a Today widget."
        }
      ],
      "deprecated": true
    },
    "doc://com.apple.documentation/documentation/uikit/uiviewcontroller/1621476-preferredcontentsize": {
      "title": "preferredContentSize",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/uiviewcontroller/1621476-preferredcontentsize",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/uikit/uiviewcontroller/1621476-preferredcontentsize"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199647": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199647",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199647"
    },
    "doc://com.apple.documentation/documentation/uikit/uicontentcontainer/1621466-viewwilltransitiontosize": {
      "title": "viewWillTransitionToSize:withTransitionCoordinator:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/uicontentcontainer/1621466-viewwilltransitiontosize",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/uikit/uicontentcontainer/1621466-viewwilltransitiontosize",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "viewWillTransitionToSize:withTransitionCoordinator:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/uikit/uitableview/2887515-performbatchupdates": {
      "title": "performBatchUpdates:completion:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/uitableview/2887515-performbatchupdates",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/uikit/uitableview/2887515-performbatchupdates",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "performBatchUpdates:completion:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199648": {
      "title": "Listing 4",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199648",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199648"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199650": {
      "title": "Listing 5",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199650",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199650"
    },
    "doc://com.apple.documentation/documentation/foundation/nsextensioncontext/1416791-openurl": {
      "title": "openURL:completionHandler:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsextensioncontext/1416791-openurl",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsextensioncontext/1416791-openurl",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "openURL:completionHandler:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/uikit/uiviewcontroller/1621411-extensioncontext": {
      "title": "extensionContext",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/uiviewcontroller/1621411-extensioncontext",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/uikit/uiviewcontroller/1621411-extensioncontext"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199651": {
      "title": "Listing 6",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199651",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199651"
    },
    "doc://com.apple.documentation/documentation/uikit/uiapplicationdelegate/1623112-application": {
      "title": "application:openURL:options:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/uikit/uiapplicationdelegate/1623112-application",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/uikit/uiapplicationdelegate/1623112-application",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "application:openURL:options:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199652": {
      "title": "Listing 7",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199652",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199652"
    },
    "link-3021913": {
      "title": "Implementing Custom URL Schemes",
      "type": "section",
      "identifier": "link-3021913",
      "kind": "article",
      "role": "link",
      "url": "https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW10"
    },
    "doc://com.apple.documentation/documentation/foundation/nsfilemanager/1412643-containerurlforsecurityapplicati": {
      "title": "containerURLForSecurityApplicationGroupIdentifier:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsfilemanager/1412643-containerurlforsecurityapplicati",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsfilemanager/1412643-containerurlforsecurityapplicati",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "containerURLForSecurityApplicationGroupIdentifier:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/foundation/nsfilemanager": {
      "title": "NSFileManager",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsfilemanager",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsfilemanager"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199654": {
      "title": "Listing 8",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199654",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199654"
    },
    "link-3023105": {
      "title": "Adding an App to an App Group",
      "type": "section",
      "identifier": "link-3023105",
      "kind": "article",
      "role": "link",
      "url": "https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/EnablingAppSandbox.html#//apple_ref/doc/uid/TP40011195-CH4-SW19"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding/1490262-widgetperformupdatewithcompletio": {
      "title": "widgetPerformUpdateWithCompletionHandler:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding/1490262-widgetperformupdatewithcompletio",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/notificationcenter/ncwidgetproviding/1490262-widgetperformupdatewithcompletio",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "widgetPerformUpdateWithCompletionHandler:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199656": {
      "title": "Listing 9",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199656",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view#3199656"
    },
    "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view": {
      "title": "Building a Simple Widget for the Today View",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/building_a_simple_widget_for_the_today_view",
      "kind": "article",
      "role": "sampleCode",
      "url": "/documentation/notificationcenter/building_a_simple_widget_for_the_today_view",
      "abstract": [
        {
          "type": "text",
          "text": "Provide users with a glanceable look at your app’s data."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetcontroller": {
      "title": "NCWidgetController",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetcontroller",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/notificationcenter/ncwidgetcontroller",
      "abstract": [
        {
          "type": "text",
          "text": "An object used to specify whether a Today widget has content to display."
        }
      ],
      "deprecated": true
    },
    "https://docs-assets.developer.apple.com/published/5e3463f7bc/BuildingASimpleWidgetForTheTodayView.zip": {
      "type": "download",
      "identifier": "https://docs-assets.developer.apple.com/published/5e3463f7bc/BuildingASimpleWidgetForTheTodayView.zip",
      "checksum": "132e0728d877d98538f11236e53ce9ddd3d00a4ba071f2512334397815f4ab84046748fd6760882202f63f8ecb28792e701526a441cc26795d3fa9f4c7c61422",
      "url": "https://docs-assets.developer.apple.com/published/5e3463f7bc/BuildingASimpleWidgetForTheTodayView.zip"
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "sampleCodeDownload": {
    "action": {
      "overridingTitle": "Download",
      "type": "reference",
      "isActive": true,
      "identifier": "https://docs-assets.developer.apple.com/published/5e3463f7bc/BuildingASimpleWidgetForTheTodayView.zip"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding",
        "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetcontroller"
      ],
      "title": "Core Widget",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "This sample code builds a weather app that displays a simple five-day weather forecast using a horizontally paging collection view. Each collection view cell contains a label showing the day the forecast applies to, an icon representing the forecast, and a label describing it. In this example, the Today extension provides a more compact, glanceable view of the app’s data."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "This sample project consists of three targets:"
            }
          ]
        },
        {
          "type": "unorderedList",
          "items": [
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The main app — WeatherApp"
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "A Today extension containing the widget — WeatherTodayExtension"
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "An embedded framework for shared code — WeatherFramework"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Place Shared Code in an Embedded Framework",
          "anchor": "3199659"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If both the main app and the Today extension require access to the same classes, those classes must be extracted into an embedded framework. In this sample project, the model code is located in WeatherFramework."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Any classes or other entities in WeatherFramework must be made explicitly "
            },
            {
              "type": "codeVoice",
              "code": "public"
            },
            {
              "type": "text",
              "text": " so they’re available from the other targets. The initializer of the WeatherForecast "
            },
            {
              "type": "codeVoice",
              "code": "struct"
            },
            {
              "type": "text",
              "text": "—which is "
            },
            {
              "type": "codeVoice",
              "code": "private"
            },
            {
              "type": "text",
              "text": " in the implicit implementation—must also be reimplemented and made "
            },
            {
              "type": "codeVoice",
              "code": "public"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "public init(daysFromNow: Int, forecast: Weather) {",
            "    self.daysFromNow = daysFromNow",
            "    self.forecast = forecast",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199643",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "For information about creating an embedded framework, see "
            },
            {
              "type": "link",
              "title": "Technical Note TN2435",
              "destination": "https://developer.apple.com/library/content/technotes/tn2435/_index.html"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Place Shared Assets in the Embedded Framework",
          "anchor": "3199660"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If both the main app and the Today extension use images or other assets, as in this sample, include them in an asset catalog contained within the embedded framework. Load image assets from the embedded framework by using the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/uikit/uiimage/1624154-imagenamed"
            },
            {
              "type": "text",
              "text": " method of "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/uikit/uiimage"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let assetName = self.imageAssetName",
            "let assetBundle = Bundle(identifier: \"com.example.apple-samplecode.WeatherFramework\")",
            "guard let image = UIImage(named: assetName, in: assetBundle, compatibleWith: nil)",
            "    else { preconditionFailure(\"Expected an image named \\(assetName)\") }"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199645",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Support Multiple Widget Sizes",
          "anchor": "3199661"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When the user taps the Show More or the Show Less button in the top-right corner of a Today widget, the display mode switches between "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodecompact"
            },
            {
              "type": "text",
              "text": " and "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodeexpanded"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "This switch triggers the system to call the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding/1649132-widgetactivedisplaymodedidchange"
            },
            {
              "type": "text",
              "text": " method of the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding"
            },
            {
              "type": "text",
              "text": " protocol, which is implemented by the "
            },
            {
              "type": "codeVoice",
              "code": "ForecastExtensionViewController"
            },
            {
              "type": "text",
              "text": ". The sample code uses this method to set the value of "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/uikit/uiviewcontroller/1621476-preferredcontentsize"
            },
            {
              "type": "text",
              "text": " for the view controller. In this sample, it’s set to either the maximum size of the compact display mode, for "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodecompact"
            },
            {
              "type": "text",
              "text": ", or the size of all cells, for "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetdisplaymode/ncwidgetdisplaymodeexpanded"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "func widgetActiveDisplayModeDidChange(_ activeDisplayMode: NCWidgetDisplayMode, withMaximumSize maxSize: CGSize) {",
            "    switch activeDisplayMode {",
            "    case .compact:",
            "        // The compact view is a fixed size.",
            "        preferredContentSize = maxSize",
            "    case .expanded:",
            "        // Dynamically calculate the height of the cells for the extended height.",
            "        var height: CGFloat = 0",
            "        for index in weatherForecastData.indices {",
            "            switch index {",
            "            case 0: height += ForecastTableViewCell.todayCellHeight",
            "            default: height += ForecastTableViewCell.standardCellHeight",
            "            }",
            "        }",
            "        preferredContentSize = CGSize(width: maxSize.width, height: min(height, maxSize.height))",
            "    @unknown default:",
            "        preconditionFailure(\"Unexpected value for activeDisplayMode.\")",
            "    }",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199647",
            "title": "Listing 3"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When the display mode changes, you can also override the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/uikit/uicontentcontainer/1621466-viewwilltransitiontosize"
            },
            {
              "type": "text",
              "text": " method to animate smoothly between the two states. In this sample code, cells that are being inserted or deleted are animated using "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/uikit/uitableview/2887515-performbatchupdates"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "override func viewWillTransition(to size: CGSize, with coordinator: UIViewControllerTransitionCoordinator) {",
            "    super.viewWillTransition(to: size, with: coordinator)",
            "",
            "    let updatedVisibleCellCount = numberOfTableRowsToDisplay()",
            "    let currentVisibleCellCount = self.tableView.visibleCells.count",
            "    let cellCountDifference = updatedVisibleCellCount - currentVisibleCellCount",
            "",
            "    // If the number of visible cells has changed, animate them in/out along with the resize animation.",
            "    if cellCountDifference != 0 {",
            "        coordinator.animate(alongsideTransition: { [unowned self] (UIViewControllerTransitionCoordinatorContext) in",
            "            self.tableView.performBatchUpdates({ [unowned self] in",
            "                // Build an array of IndexPath objects representing the rows to be inserted or deleted.",
            "                let range = (1...abs(cellCountDifference))",
            "                let indexPaths = range.map({ (index) -> IndexPath in",
            "                    return IndexPath(row: index, section: 0)",
            "                })",
            "",
            "                // Animate the insertion or deletion of the rows.",
            "                if cellCountDifference > 0 {",
            "                    self.tableView.insertRows(at: indexPaths, with: .fade)",
            "                } else {",
            "                    self.tableView.deleteRows(at: indexPaths, with: .fade)",
            "                }",
            "            }, completion: nil)",
            "        }, completion: nil)",
            "    }",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199648",
            "title": "Listing 4"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Move from the Today Extension to the Main App",
          "anchor": "3199662"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When the user taps any of the weather forecast cells in the Today extension, the main app is activated, and it scrolls the collection view to bring the appropriate day into view."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To make this behavior possible, the "
            },
            {
              "type": "codeVoice",
              "code": "weatherwidget:"
            },
            {
              "type": "text",
              "text": " URL scheme is registered with the main app, and the Today extension then constructs a URL with the tapped day encoded as a parameter:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "weatherwidget://?daysFromNow=2"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199650",
            "title": "Listing 5"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsextensioncontext/1416791-openurl"
            },
            {
              "type": "text",
              "text": " method of the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/uikit/uiviewcontroller/1621411-extensioncontext"
            },
            {
              "type": "text",
              "text": " is then called, opening the app."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {",
            "    // Open the main app at the correct page for the day tapped in the widget.",
            "    let weatherForecast = weatherForecastData[indexPath.row]",
            "    if let appURL = URL(string: \"weatherwidget://?daysFromNow=\\(weatherForecast.daysFromNow)\") {",
            "        extensionContext?.open(appURL, completionHandler: nil)",
            "    }",
            "",
            "    // Don't leave the today extension with a selected row.",
            "    tableView.deselectRow(at: indexPath, animated: true)",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199651",
            "title": "Listing 6"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The main app processes the URL in the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/uikit/uiapplicationdelegate/1623112-application"
            },
            {
              "type": "text",
              "text": " delegate method, where it parses the parameters before scrolling the collection view in the "
            },
            {
              "type": "codeVoice",
              "code": "ForecastViewController"
            },
            {
              "type": "text",
              "text": " to the correct cell."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "// Extract the daysFromNow query string parameter from the incoming URL.",
            "let components = URLComponents(url: url, resolvingAgainstBaseURL: false)",
            "guard let daysFromNowQueryItem = components?.queryItems?.first(where: { queryItem -> Bool in",
            "    return queryItem.name == \"daysFromNow\"",
            "}) else { preconditionFailure(\"Expected a daysFromNow parameter\") }",
            "guard let daysFromNowValue = daysFromNowQueryItem.value",
            "    else { preconditionFailure(\"Expected daysFromNow parameter to have a value\") }",
            "guard let daysFromNow = Int(daysFromNowValue)",
            "    else { preconditionFailure(\"Expected daysFromNow to be an integer\") }",
            "",
            "// Scroll the initial view controller to the correct index.",
            "initialViewController.scrollToForecast(index: daysFromNow)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199652",
            "title": "Listing 7"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "For information about allowing your app to respond to custom URL schemes, see "
            },
            {
              "type": "link",
              "title": "Implementing Custom URL Schemes",
              "destination": "https://developer.apple.com/library/content/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html#//apple_ref/doc/uid/TP40007072-CH6-SW10"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Share Data Between the App and the Extension",
          "anchor": "3199663"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Weather forecast data in this sample is generated randomly and stored on disk in a property list ("
            },
            {
              "type": "codeVoice",
              "code": ".plist"
            },
            {
              "type": "text",
              "text": ") file. To allow both targets to access the same area of the file system, you add the App Group entitlement to each target that requires access. Once the entitlement is added and an App Group has been created, you can use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsfilemanager/1412643-containerurlforsecurityapplicati"
            },
            {
              "type": "text",
              "text": " method of "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsfilemanager"
            },
            {
              "type": "text",
              "text": " to get the URL to the shared directory."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "static var sharedDataFileURL: URL {",
            "    let appGroupIdentifier = \"group.com.example.apple-samplecode.WeatherWidget\"",
            "    guard let url = FileManager.default.containerURL(forSecurityApplicationGroupIdentifier: appGroupIdentifier)",
            "        else { preconditionFailure(\"Expected a valid app group container\") }",
            "    return url.appendingPathComponent(\"Data.plist\")",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199654",
            "title": "Listing 8"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "For more information about app groups, see "
            },
            {
              "type": "link",
              "title": "Adding an App to an App Group",
              "destination": "https://developer.apple.com/library/archive/documentation/Miscellaneous/Reference/EntitlementKeyReference/Chapters/EnablingAppSandbox.html#//apple_ref/doc/uid/TP40011195-CH4-SW19"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Respond to Data Updates",
          "anchor": "3199664"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Tapping the refresh button on the navigation bar of the main app generates a new random weather forecast and writes it to the shared app group’s container. To ensure that the Today extension always shows the latest data, use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding/1490262-widgetperformupdatewithcompletio"
            },
            {
              "type": "text",
              "text": " method of the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/notificationcenter/ncwidgetproviding"
            },
            {
              "type": "text",
              "text": " protocol to update your data."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "func widgetPerformUpdate(completionHandler: (@escaping (NCUpdateResult) -> Void)) {",
            "    // Reload the data from disk.",
            "    weatherForecastData = WeatherForecast.loadSharedData()",
            "",
            "    completionHandler(NCUpdateResult.newData)",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3199656",
            "title": "Listing 9"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}