{
  "abstract": [
    {
      "type": "text",
      "text": "Enhance the readability of a map by replacing overlapping annotations with a clustering annotation view."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/mapkit",
        "doc://com.apple.documentation/documentation/mapkit/mapkit_annotations"
      ],
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/mapkit",
        "doc://com.apple.documentation/documentation/mapkit/mkannotationview"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2943006,
  "kind": "article",
  "metadata": {
    "title": "Decluttering a Map with MapKit Annotation Clustering",
    "role": "sampleCode",
    "roleHeading": "Sample Code",
    "modules": [
      {
        "name": "MapKit"
      }
    ],
    "platforms": [
      {
        "name": "iOS",
        "introducedAt": "11.0",
        "current": "14.3"
      },
      {
        "name": "Xcode",
        "introducedAt": "11.3",
        "current": "12.3"
      }
    ]
  },
  "schemaVersion": {
    "major": 1,
    "minor": 0,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering",
        "documentation/mapkit/mapkit_annotations/decluttering_a_map_with_mapkit_annotation_clustering"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering",
        "documentation/mapkit/mapkit_annotations/decluttering_a_map_with_mapkit_annotation_clustering"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/mapkit": {
      "title": "MapKit",
      "identifier": "doc://com.apple.documentation/documentation/mapkit",
      "url": "/documentation/mapkit",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/mapkit/mapkit_annotations": {
      "title": "MapKit Annotations",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mapkit_annotations",
      "url": "/documentation/mapkit/mapkit_annotations",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkannotationview": {
      "title": "MKAnnotationView",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/mapkit/mkannotationview"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkannotationview/2867297-clusteringidentifier": {
      "title": "clusteringIdentifier",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/2867297-clusteringidentifier",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/mapkit/mkannotationview/2867297-clusteringidentifier"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539994": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539994",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539994"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkannotationview/2867298-displaypriority": {
      "title": "displayPriority",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/2867298-displaypriority",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/mapkit/mkannotationview/2867298-displaypriority"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkfeaturedisplayprioritydefaultlow": {
      "title": "MKFeatureDisplayPriorityDefaultLow",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkfeaturedisplayprioritydefaultlow",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/mapkit/mkfeaturedisplayprioritydefaultlow"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkfeaturedisplayprioritydefaulthigh": {
      "title": "MKFeatureDisplayPriorityDefaultHigh",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkfeaturedisplayprioritydefaulthigh",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/mapkit/mkfeaturedisplayprioritydefaulthigh"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539996": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539996",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539996"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539998": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539998",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering#3539998"
    },
    "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering": {
      "title": "Decluttering a Map with MapKit Annotation Clustering",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering",
      "kind": "article",
      "role": "sampleCode",
      "url": "/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering",
      "abstract": [
        {
          "type": "text",
          "text": "Enhance the readability of a map by replacing overlapping annotations with a clustering annotation view."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/mapkit/mkclusterannotation": {
      "title": "MKClusterAnnotation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/mapkit/mkclusterannotation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/mapkit/mkclusterannotation",
      "abstract": [
        {
          "type": "text",
          "text": "An annotation that groups two or more distinct annotations into a single entity.  "
        }
      ]
    },
    "https://docs-assets.developer.apple.com/published/3d21942401/DeclutteringAMapWithMapKitAnnotationClustering.zip": {
      "type": "download",
      "identifier": "https://docs-assets.developer.apple.com/published/3d21942401/DeclutteringAMapWithMapKitAnnotationClustering.zip",
      "checksum": "b7e1f41b9f6a1fc5d5f51e6d7124c25652f511b5fa13c2947b60aacfd4b837ac1e6e92a34efbef32aee8b3ddffd8394af5008e054ad993ed8fe6906ce34638a3",
      "url": "https://docs-assets.developer.apple.com/published/3d21942401/DeclutteringAMapWithMapKitAnnotationClustering.zip"
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "sampleCodeDownload": {
    "action": {
      "overridingTitle": "Download",
      "type": "reference",
      "isActive": true,
      "identifier": "https://docs-assets.developer.apple.com/published/3d21942401/DeclutteringAMapWithMapKitAnnotationClustering.zip"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/mapkit/mkclusterannotation"
      ],
      "title": "Grouped Annotations",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "TANDm is a fictional bike sharing app that uses annotation clustering to provide an uncluttered map. The app shows how MapKit automatically groups two or more annotations into a single annotation when spacing on the map doesn’t permit each annotation to be visible without overlapping. This enhances the readability of the map by replacing overlapping annotations with a clustering annotation view."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Annotation Clustering",
          "anchor": "3540001"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To group annotations into a cluster, set the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/2867297-clusteringidentifier"
            },
            {
              "type": "text",
              "text": " property to the same value on each annotation view in the group. For example, to show overlapping unicycle annotations in a clustering annotation view, TANDm sets "
            },
            {
              "type": "codeVoice",
              "code": "clusteringIdentifier"
            },
            {
              "type": "text",
              "text": " on each instance of "
            },
            {
              "type": "codeVoice",
              "code": "UnicycleAnnotationView"
            },
            {
              "type": "text",
              "text": " to "
            },
            {
              "type": "codeVoice",
              "code": "\"unicycle\""
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "override init(annotation: MKAnnotation?, reuseIdentifier: String?) {",
            "    super.init(annotation: annotation, reuseIdentifier: reuseIdentifier)",
            "    clusteringIdentifier = \"unicycle\"",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3539994",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Display Priority",
          "anchor": "3540002"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To determine how an annotation view behaves when it overlaps another annotation view, set its "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview/2867298-displaypriority"
            },
            {
              "type": "text",
              "text": " property. In the sample app, the map view is likely to hide the unicycle annotation if it overlaps with another annotation because the unicycle annotation view has a display priority of "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/mapkit/mkfeaturedisplayprioritydefaultlow"
            },
            {
              "type": "text",
              "text": ", while the display priorities for bicycle and tricycle are set to "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/mapkit/mkfeaturedisplayprioritydefaulthigh"
            },
            {
              "type": "text",
              "text": ". Here’s an example of setting the display priority while preparing an instance of "
            },
            {
              "type": "codeVoice",
              "code": "BicycleAnnotationView"
            },
            {
              "type": "text",
              "text": " for reuse:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "override func prepareForDisplay() {",
            "    super.prepareForDisplay()",
            "    displayPriority = .defaultHigh",
            "    markerTintColor = UIColor.bicycleColor",
            "    glyphImage = #imageLiteral(resourceName: \"bicycle\")",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3539996",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Custom Clustering Annotation Views",
          "anchor": "3540003"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Customize the behavior and appearance of a clustering annotation view by subclassing "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/mapkit/mkannotationview"
            },
            {
              "type": "text",
              "text": "; for instance, to display hints about the annotations within the cluster. TANDm, for example, uses the custom clustering annotation view "
            },
            {
              "type": "codeVoice",
              "code": "ClusterAnnotationView"
            },
            {
              "type": "text",
              "text": " to show the ratio between bicycles and tricycles at a location."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "override func prepareForDisplay() {",
            "    super.prepareForDisplay()",
            "    ",
            "    if let cluster = annotation as? MKClusterAnnotation {",
            "        let totalBikes = cluster.memberAnnotations.count",
            "        ",
            "        if count(cycleType: .unicycle) > 0 {",
            "            image = drawUnicycleCount(count: totalBikes)",
            "        } else {",
            "            let tricycleCount = count(cycleType: .tricycle)",
            "            image = drawRatioBicycleToTricycle(tricycleCount, to: totalBikes)",
            "        }",
            "        ",
            "        if count(cycleType: .unicycle) > 0 {",
            "            displayPriority = .defaultLow",
            "        } else {",
            "            displayPriority = .defaultHigh",
            "        }",
            "    }",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3539998",
            "title": "Listing 3"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2020 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}