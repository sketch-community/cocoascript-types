{
  "abstract": [
    {
      "type": "text",
      "text": "The abstract base class for all operations that execute in a database."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/cloudkit",
        "doc://com.apple.documentation/documentation/cloudkit/shared_records"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/cloudkit/ckoperation",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 1452360,
  "kind": "symbol",
  "metadata": {
    "title": "CKOperation",
    "role": "symbol",
    "roleHeading": "Class",
    "modules": [
      {
        "name": "CloudKit"
      }
    ],
    "platforms": [
      {
        "name": "iOS",
        "introducedAt": "8.0",
        "current": "15.2"
      },
      {
        "name": "iPadOS",
        "introducedAt": "8.0",
        "current": "15.2"
      },
      {
        "name": "macOS",
        "introducedAt": "10.10",
        "current": "12.1"
      },
      {
        "name": "Mac Catalyst",
        "introducedAt": "13.0",
        "current": "15.2"
      },
      {
        "name": "tvOS",
        "introducedAt": "9.0",
        "current": "15.2"
      },
      {
        "name": "watchOS",
        "introducedAt": "3.0",
        "current": "8.3"
      }
    ],
    "externalID": "c:objc(cs)CKOperation",
    "symbolKind": "cl"
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/cloudkit/ckoperation"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/cloudkit/ckoperation"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/cloudkit": {
      "title": "CloudKit",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit",
      "url": "/documentation/cloudkit",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/cloudkit/shared_records": {
      "title": "Shared Records",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/shared_records",
      "url": "/documentation/cloudkit/shared_records",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452374-longlived": {
      "title": "longLived",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452374-longlived",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperation/1452374-longlived"
    },
    "doc://com.apple.documentation/documentation/objectivec/yes": {
      "title": "YES",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/objectivec/yes",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/objectivec/yes"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckcontainer/1399160-fetchalllonglivedoperationidswit": {
      "title": "fetchAllLongLivedOperationIDsWithCompletionHandler:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckcontainer/1399160-fetchalllonglivedoperationidswit",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckcontainer/1399160-fetchalllonglivedoperationidswit",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "fetchAllLongLivedOperationIDsWithCompletionHandler:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckcontainer": {
      "title": "CKContainer",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckcontainer",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckcontainer"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckcontainer/1399164-fetchlonglivedoperationwithid": {
      "title": "fetchLongLivedOperationWithID:completionHandler:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckcontainer/1399164-fetchlonglivedoperationwithid",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckcontainer/1399164-fetchlonglivedoperationwithid",
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "fetchLongLivedOperationWithID:completionHandler:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation#2826096": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation#2826096",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/cloudkit/ckoperation#2826096"
    },
    "doc://com.apple.documentation/documentation/foundation/nsqualityofservice/nsqualityofservicedefault": {
      "title": "NSQualityOfServiceDefault",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsqualityofservice/nsqualityofservicedefault",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsqualityofservice/nsqualityofservicedefault"
    },
    "doc://com.apple.documentation/documentation/foundation/nsoperation/1413553-qualityofservice": {
      "title": "qualityOfService",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsoperation/1413553-qualityofservice",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsoperation/1413553-qualityofservice"
    },
    "devLink-1758214": {
      "identifier": "devLink-1758214",
      "type": "link",
      "title": "Prioritize Work with Quality of Service Classes",
      "url": "https://developer.apple.com/library/archive/documentation/Performance/Conceptual/EnergyGuide-iOS/PrioritizeWorkWithQoS.html#//apple_ref/doc/uid/TP40015243-CH39"
    },
    "devLink-1758034": {
      "identifier": "devLink-1758034",
      "type": "link",
      "title": "Energy Efficiency Guide for iOS Apps",
      "url": "https://developer.apple.com/library/archive/documentation/Performance/Conceptual/EnergyGuide-iOS/index.html#//apple_ref/doc/uid/TP40015243"
    },
    "devLink-1750695": {
      "identifier": "devLink-1750695",
      "type": "link",
      "title": "Prioritize Work at the Task Level",
      "url": "https://developer.apple.com/library/archive/documentation/Performance/Conceptual/power_efficiency_guidelines_osx/PrioritizeWorkAtTheTaskLevel.html#//apple_ref/doc/uid/TP40013929-CH35"
    },
    "devLink-1750536": {
      "identifier": "devLink-1750536",
      "type": "link",
      "title": "Energy Efficiency Guide for Mac Apps",
      "url": "https://developer.apple.com/library/archive/documentation/Performance/Conceptual/power_efficiency_guidelines_osx/index.html#//apple_ref/doc/uid/TP40013929"
    },
    "doc://com.apple.documentation/documentation/foundation/nsoperation": {
      "title": "NSOperation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nsoperation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nsoperation"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452370-init": {
      "title": "init",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452370-init",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperation/1452370-init",
      "abstract": [
        {
          "type": "text",
          "text": "Creates an operation."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "init"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452362-operationid": {
      "title": "operationID",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452362-operationid",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperation/1452362-operationid",
      "abstract": [
        {
          "type": "text",
          "text": "A unique identifier for a long-lived operation."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperationid": {
      "title": "CKOperationID",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperationid",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperationid",
      "abstract": [
        {
          "type": "text",
          "text": "A type that represents the ID of an operation."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation/2866213-configuration": {
      "title": "configuration",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation/2866213-configuration",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperation/2866213-configuration",
      "abstract": [
        {
          "type": "text",
          "text": "The operation’s configuration."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperationconfiguration": {
      "title": "CKOperationConfiguration",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperationconfiguration",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperationconfiguration",
      "abstract": [
        {
          "type": "text",
          "text": "An object that describes how a CloudKit operation behaves."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation/2866228-group": {
      "title": "group",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation/2866228-group",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperation/2866228-group",
      "abstract": [
        {
          "type": "text",
          "text": "The operation’s group."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452366-longlivedoperationwaspersistedbl": {
      "title": "longLivedOperationWasPersistedBlock",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452366-longlivedoperationwaspersistedbl",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperation/1452366-longlivedoperationwaspersistedbl",
      "abstract": [
        {
          "type": "text",
          "text": "The block to execute when the server begins to store callbacks for the long-lived operation."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation/deprecated_symbols": {
      "title": "Deprecated Symbols",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation/deprecated_symbols",
      "kind": "article",
      "role": "collectionGroup",
      "url": "/documentation/cloudkit/ckoperation/deprecated_symbols",
      "abstract": [
        {
          "type": "text",
          "text": "Review unsupported symbols and their replacements."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckoperation": {
      "title": "CKOperation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckoperation",
      "abstract": [
        {
          "type": "text",
          "text": "The abstract base class for all operations that execute in a database."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "relationshipsSections": [
    {
      "kind": "relationships",
      "title": "Inherits From",
      "type": "inheritsFrom",
      "identifiers": [
        "doc://com.apple.documentation/documentation/foundation/nsoperation"
      ]
    }
  ],
  "topicSections": [
    {
      "kind": "taskGroup",
      "title": "Creating an Operation",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452370-init"
      ],
      "anchor": "2558329"
    },
    {
      "kind": "taskGroup",
      "title": "Identifying the Operation",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452362-operationid",
        "doc://com.apple.documentation/documentation/cloudkit/ckoperationid"
      ],
      "anchor": "3654695"
    },
    {
      "kind": "taskGroup",
      "title": "Managing the Operation's Configuration",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckoperation/2866213-configuration",
        "doc://com.apple.documentation/documentation/cloudkit/ckoperationconfiguration",
        "doc://com.apple.documentation/documentation/cloudkit/ckoperation/2866228-group",
        "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452366-longlivedoperationwaspersistedbl"
      ],
      "anchor": "1666049"
    },
    {
      "kind": "taskGroup",
      "title": "Deprecated",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckoperation/deprecated_symbols"
      ],
      "anchor": "3694770"
    }
  ],
  "primaryContentSections": [
    {
      "kind": "declarations",
      "declarations": [
        {
          "languages": [
            "occ"
          ],
          "tokens": [
            {
              "kind": "keyword",
              "text": "@interface"
            },
            {
              "kind": "text",
              "text": " "
            },
            {
              "kind": "identifier",
              "text": "CKOperation"
            },
            {
              "kind": "text",
              "text": " : "
            },
            {
              "kind": "typeIdentifier",
              "preciseIdentifier": "c:objc(cs)NSOperation",
              "identifier": "doc://com.apple.documentation/documentation/foundation/nsoperation",
              "text": "NSOperation"
            }
          ],
          "platforms": [
            "iOS",
            "iPadOS",
            "macOS",
            "Mac Catalyst",
            "tvOS",
            "watchOS"
          ]
        }
      ]
    },
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "All CloudKit operations descend from "
            },
            {
              "type": "codeVoice",
              "code": "CKOperation"
            },
            {
              "type": "text",
              "text": ", which provides the infrastructure for executing tasks in one of your app’s containers. Don’t subclass or create instances of this class directly. Instead, create instances of one of its concrete subclasses."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Use the properties of this class to configure the behavior of the operation before submitting it to a queue or executing it directly. CloudKit operations involve communicating with the iCloud servers to send and receive data. You can use the properties of this class to configure the behavior of those network requests to ensure the best performance for your app."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "codeVoice",
                  "code": "CKOperation"
                },
                {
                  "type": "text",
                  "text": " objects have a default quality of service level of "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/foundation/nsqualityofservice/nsqualityofservicedefault"
                },
                {
                  "type": "text",
                  "text": " (see "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/foundation/nsoperation/1413553-qualityofservice"
                },
                {
                  "type": "text",
                  "text": "). Operations with this service level are discretionary, and the system schedules them for an optimal time according to battery level and other factors. On iPhone, discretionary activities pause when the device is in Low Power Mode. For information about quality of service levels, see "
                },
                {
                  "type": "link",
                  "title": "Prioritize Work with Quality of Service Classes",
                  "destination": "https://developer.apple.com/library/archive/documentation/Performance/Conceptual/EnergyGuide-iOS/PrioritizeWorkWithQoS.html#//apple_ref/doc/uid/TP40015243-CH39"
                },
                {
                  "type": "text",
                  "text": " in "
                },
                {
                  "type": "link",
                  "title": "Energy Efficiency Guide for iOS Apps",
                  "destination": "https://developer.apple.com/library/archive/documentation/Performance/Conceptual/EnergyGuide-iOS/index.html#//apple_ref/doc/uid/TP40015243"
                },
                {
                  "type": "text",
                  "text": " and "
                },
                {
                  "type": "link",
                  "title": "Prioritize Work at the Task Level",
                  "destination": "https://developer.apple.com/library/archive/documentation/Performance/Conceptual/power_efficiency_guidelines_osx/PrioritizeWorkAtTheTaskLevel.html#//apple_ref/doc/uid/TP40013929-CH35"
                },
                {
                  "type": "text",
                  "text": " in "
                },
                {
                  "type": "link",
                  "title": "Energy Efficiency Guide for Mac Apps",
                  "destination": "https://developer.apple.com/library/archive/documentation/Performance/Conceptual/power_efficiency_guidelines_osx/index.html#//apple_ref/doc/uid/TP40013929"
                },
                {
                  "type": "text",
                  "text": "."
                }
              ]
            }
          ],
          "style": "important"
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Long-Lived Operations",
          "anchor": "1666033"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "A "
            },
            {
              "type": "newTerm",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "long-lived operation"
                }
              ]
            },
            {
              "type": "text",
              "text": " is an operation that continues to run after the user closes the app. To specify a long-lived operation, set "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckoperation/1452374-longlived"
            },
            {
              "type": "text",
              "text": " to "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/yes"
            },
            {
              "type": "text",
              "text": ", provide a completion handler, and execute the operation. To get the identifiers of all running long-lived operations, use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckcontainer/1399160-fetchalllonglivedoperationidswit"
            },
            {
              "type": "text",
              "text": " method that "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckcontainer"
            },
            {
              "type": "text",
              "text": " provides. To get a specific long-lived operation, use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckcontainer/1399164-fetchlonglivedoperationwithid"
            },
            {
              "type": "text",
              "text": " method. Make sure you set the completion handler of a long-lived operation before you execute it so that the system can notify you when it completes and you can process the results. Do not execute an operation, change it to long-lived, and execute it again as a long-lived operation."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "[container fetchAllLongLivedOperationIDsWithCompletionHandler:^(NSArray<NSString *> *_Nullable operationIDs, NSError *_Nullable error) {",
            "    if (error) {",
            "        // Handle error",
            "        return",
            "    }",
            "    for (NSString *operationID in operationIDs) {",
            "        [container fetchLongLivedOperationWithID:operationID completionHandler:^(CKOperation *_Nullable operation, NSError *_Nullable error) {",
            "            if (error) {",
            "                // Handle error",
            "                return",
            "            }",
            "            // Add callback handlers to operation",
            "            [container addOperation:operation];",
            "        }];",
            "    }",
            "}];"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "2826096",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The following is the typical life cycle of a long-lived operation:"
            }
          ]
        },
        {
          "type": "orderedList",
          "items": [
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The app creates a long-lived operation and executes it."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The daemon starts saving and sending the callbacks to the running app."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The app exits."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The daemon continues running the long-lived operation and saves the callbacks."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The app launches and fetches the long-lived operation."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "If the operation is running or if it completed within the previous 24 hours, the daemon returns a proxy for the long-lived operation. If the operation completed more than 24 hours previously, the daemon may stop returning it in fetch requests."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The app runs the long-lived operation again."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The daemon sends the app all the saved callbacks (it doesn’t actually rerun the operation), and continues saving the callbacks and sending them to the running app."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The app receives the completion callback or the app cancels the operation."
                    }
                  ]
                },
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "The daemon stops including the operation in future fetch results."
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}