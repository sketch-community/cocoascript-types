{
  "abstract": [
    {
      "type": "text",
      "text": "An operation that fetches record zone changes."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/cloudkit",
        "doc://com.apple.documentation/documentation/cloudkit/remote_records"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 1640474,
  "kind": "symbol",
  "metadata": {
    "title": "CKFetchRecordZoneChangesOperation",
    "role": "symbol",
    "roleHeading": "Class",
    "modules": [
      {
        "name": "CloudKit"
      }
    ],
    "platforms": [
      {
        "name": "iOS",
        "introducedAt": "10.0",
        "current": "15.2"
      },
      {
        "name": "iPadOS",
        "introducedAt": "10.0",
        "current": "15.2"
      },
      {
        "name": "macOS",
        "introducedAt": "10.12",
        "current": "12.1"
      },
      {
        "name": "Mac Catalyst",
        "introducedAt": "13.0",
        "current": "15.2"
      },
      {
        "name": "tvOS",
        "introducedAt": "10.0",
        "current": "15.2"
      },
      {
        "name": "watchOS",
        "introducedAt": "3.0",
        "current": "8.3"
      }
    ],
    "externalID": "c:objc(cs)CKFetchRecordZoneChangesOperation",
    "symbolKind": "cl"
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/cloudkit/ckfetchrecordzonechangesoperation"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/cloudkit/ckfetchrecordzonechangesoperation"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/cloudkit": {
      "title": "CloudKit",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit",
      "url": "/documentation/cloudkit",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/cloudkit/remote_records": {
      "title": "Remote Records",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/remote_records",
      "url": "/documentation/cloudkit/remote_records",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/objectivec/nil-2gl": {
      "title": "nil",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/objectivec/nil-2gl",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/objectivec/nil-2gl"
    },
    "doc://com.apple.documentation/documentation/foundation/nssecurecoding": {
      "title": "NSSecureCoding",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/nssecurecoding",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/nssecurecoding"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchdatabasechangesoperation": {
      "title": "CKFetchDatabaseChangesOperation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchdatabasechangesoperation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchdatabasechangesoperation"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckrecordzonesubscription": {
      "title": "CKRecordZoneSubscription",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckrecordzonesubscription",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckrecordzonesubscription",
      "abstract": [
        {
          "type": "text",
          "text": "A subscription that generates push notifications when CloudKit modifies records in a specific record zone."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckdatabasesubscription": {
      "title": "CKDatabaseSubscription",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckdatabasesubscription",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckdatabasesubscription"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation#3735872": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation#3735872",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation#3735872"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckdatabaseoperation": {
      "title": "CKDatabaseOperation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckdatabaseoperation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckdatabaseoperation"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2980665-initwithrecordzoneids": {
      "title": "initWithRecordZoneIDs:configurationsByRecordZoneID:",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2980665-initwithrecordzoneids",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/2980665-initwithrecordzoneids",
      "abstract": [
        {
          "type": "text",
          "text": "Creates an operation for fetching record zone changes."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "initWithRecordZoneIDs:configurationsByRecordZoneID:"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2715840-init": {
      "title": "init",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2715840-init",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/2715840-init",
      "abstract": [
        {
          "type": "text",
          "text": "Creates an empty fetch record zone changes operation."
        }
      ],
      "fragments": [
        {
          "kind": "text",
          "text": "- "
        },
        {
          "kind": "identifier",
          "text": "init"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2980664-configurationsbyrecordzoneid": {
      "title": "configurationsByRecordZoneID",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2980664-configurationsbyrecordzoneid",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/2980664-configurationsbyrecordzoneid",
      "abstract": [
        {
          "type": "text",
          "text": "A dictionary of configurations for fetching change operations by zone identifier."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesconfiguration": {
      "title": "CKFetchRecordZoneChangesConfiguration",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesconfiguration",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesconfiguration",
      "abstract": [
        {
          "type": "text",
          "text": "A configuration object that describes the information to fetch from a record zone."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640386-fetchallchanges": {
      "title": "fetchAllChanges",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640386-fetchallchanges",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640386-fetchallchanges",
      "abstract": [
        {
          "type": "text",
          "text": "A Boolean value that indicates whether to send repeated requests to the server."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640463-recordzoneids": {
      "title": "recordZoneIDs",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640463-recordzoneids",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640463-recordzoneids",
      "abstract": [
        {
          "type": "text",
          "text": "The IDs of the record zones that contain the records to fetch."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640417-recordchangedblock": {
      "title": "recordChangedBlock",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640417-recordchangedblock",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640417-recordchangedblock",
      "abstract": [
        {
          "type": "text",
          "text": "The block to execute with the contents of a changed record."
        }
      ],
      "deprecated": true
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640470-recordwithidwasdeletedblock": {
      "title": "recordWithIDWasDeletedBlock",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640470-recordwithidwasdeletedblock",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640470-recordwithidwasdeletedblock",
      "abstract": [
        {
          "type": "text",
          "text": "The block to execute when a record no longer exists."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640422-recordzonechangetokensupdatedblo": {
      "title": "recordZoneChangeTokensUpdatedBlock",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640422-recordzonechangetokensupdatedblo",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640422-recordzonechangetokensupdatedblo",
      "abstract": [
        {
          "type": "text",
          "text": "The block to execute when the change token updates."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640411-recordzonefetchcompletionblock": {
      "title": "recordZoneFetchCompletionBlock",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640411-recordzonefetchcompletionblock",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640411-recordzonefetchcompletionblock",
      "abstract": [
        {
          "type": "text",
          "text": "The block to execute when a record zone’s fetch finishes."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640409-fetchrecordzonechangescompletion": {
      "title": "fetchRecordZoneChangesCompletionBlock",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640409-fetchrecordzonechangescompletion",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640409-fetchrecordzonechangescompletion",
      "abstract": [
        {
          "type": "text",
          "text": "The block to execute when the operation finishes."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/deprecated_symbols": {
      "title": "Deprecated Symbols",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/deprecated_symbols",
      "kind": "article",
      "role": "collectionGroup",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/deprecated_symbols",
      "abstract": [
        {
          "type": "text",
          "text": "Review unsupported symbols and their replacements."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/3793698-recordwaschangedblock": {
      "title": "recordWasChangedBlock",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/3793698-recordwaschangedblock",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation/3793698-recordwaschangedblock"
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckrecordzonenotification": {
      "title": "CKRecordZoneNotification",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckrecordzonenotification",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckrecordzonenotification",
      "abstract": [
        {
          "type": "text",
          "text": "A notification that triggers when the contents of a record zone change."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation": {
      "title": "CKFetchRecordZoneChangesOperation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/cloudkit/ckfetchrecordzonechangesoperation",
      "abstract": [
        {
          "type": "text",
          "text": "An operation that fetches record zone changes."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "relationshipsSections": [
    {
      "kind": "relationships",
      "title": "Inherits From",
      "type": "inheritsFrom",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckdatabaseoperation"
      ]
    }
  ],
  "topicSections": [
    {
      "kind": "taskGroup",
      "title": "Creating a Zone Change Operation",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2980665-initwithrecordzoneids",
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2715840-init"
      ],
      "anchor": "2530659"
    },
    {
      "kind": "taskGroup",
      "title": "Configuring the Zone Change Operation",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/2980664-configurationsbyrecordzoneid",
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesconfiguration",
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640386-fetchallchanges",
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640463-recordzoneids"
      ],
      "anchor": "2530644"
    },
    {
      "kind": "taskGroup",
      "title": "Processing the Zone Change Operation Results",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640417-recordchangedblock",
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640470-recordwithidwasdeletedblock",
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640422-recordzonechangetokensupdatedblo",
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640411-recordzonefetchcompletionblock",
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/1640409-fetchrecordzonechangescompletion"
      ],
      "anchor": "2530650"
    },
    {
      "kind": "taskGroup",
      "title": "Deprecated",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/deprecated_symbols"
      ],
      "anchor": "3735875"
    },
    {
      "kind": "taskGroup",
      "title": "Instance Properties",
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckfetchrecordzonechangesoperation/3793698-recordwaschangedblock"
      ],
      "anchor": "3796753"
    }
  ],
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/cloudkit/ckrecordzonesubscription",
        "doc://com.apple.documentation/documentation/cloudkit/ckrecordzonenotification"
      ],
      "title": "Record Zone Changes",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "declarations",
      "declarations": [
        {
          "languages": [
            "occ"
          ],
          "tokens": [
            {
              "kind": "keyword",
              "text": "@interface"
            },
            {
              "kind": "text",
              "text": " "
            },
            {
              "kind": "identifier",
              "text": "CKFetchRecordZoneChangesOperation"
            },
            {
              "kind": "text",
              "text": " : "
            },
            {
              "kind": "typeIdentifier",
              "preciseIdentifier": "c:objc(cs)CKDatabaseOperation",
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckdatabaseoperation",
              "text": "CKDatabaseOperation"
            }
          ],
          "platforms": [
            "iOS",
            "iPadOS",
            "macOS",
            "Mac Catalyst",
            "tvOS",
            "watchOS"
          ]
        }
      ]
    },
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Use this operation to fetch record changes in one or more record zones, such as those that occur during record creation, modification, and deletion. You provide a configuration object for each record zone to query for changes. The configuration contains a server change token, which is an opaque pointer to a specific change in the zone’s history. CloudKit returns only the changes that occur after that point. For the first time you fetch a record zone’s changes, or to refetch all changes in a zone’s history, use "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/objectivec/nil-2gl"
            },
            {
              "type": "text",
              "text": " instead."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "Only private and shared databases support this operation. If you attempt to execute this operation in the public database, CloudKit returns an error."
                }
              ]
            }
          ],
          "style": "note",
          "name": "Note"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "CloudKit processes the record zones in succession, and returns the changes for each zone in batches. Each batch yields a new change token. If all batches return without error, the operation issues a final change token for that zone. The change tokens conform to "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/nssecurecoding"
            },
            {
              "type": "text",
              "text": " and are safe to cache on-disk. This operation’s tokens aren’t compatible with "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchdatabasechangesoperation"
            },
            {
              "type": "text",
              "text": " so you should segregate them in your app’s cache. Don’t infer behavior or order from the tokens’ contents."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If you create record zones in the private database, fetch all changes the first time the app launches. Cache the results on-device and use "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckrecordzonesubscription"
            },
            {
              "type": "text",
              "text": " to subscribe to future changes. Fetch those changes on receipt of the push notifications the subscription generates. If you use the shared database, subscribe to changes with "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckdatabasesubscription"
            },
            {
              "type": "text",
              "text": " instead. When a user participates in sharing, CloudKit adds and removes record zones. This means you don’t know in advance which zones exist in the shared database. Use "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/cloudkit/ckfetchdatabasechangesoperation"
            },
            {
              "type": "text",
              "text": " to fetch shared record zones on receipt of the subscription’s push notifications. Then fetch the changes in those zones using this operation. Regardless of which database you use, it’s not necessary to perform fetches each time your app launches, or to schedule fetches at regular intervals."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To run the operation, add it to the corresponding database’s operation queue. The operation executes its callbacks on a private serial queue."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The following example demonstrates how to create the operation, configure its callbacks, and execute it. For brevity, it omits the delete and operation completion callbacks."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "// Create a dictionary that maps a record zone ID to its",
            "// corresponding zone configuration. The configuration",
            "// contains the server change token from the most recent ",
            "// fetch of that record zone.",
            "NSMutableDictionary *configurations = [NSMutableDictionary new];",
            "for (CKRecordZoneID *recordZoneID in recordZoneIDs) {",
            "    CKFetchRecordZoneChangesConfiguration *config = ",
            "        [CKFetchRecordZoneChangesConfiguration new];",
            "    config.previousServerChangeToken = [tokenCache objectForKey:recordZoneID];",
            "    [configurations setObject:config forKey:recordZoneID];",
            "}",
            "",
            "// Create a fetch operation with an array of record zone IDs",
            "// and the zone configuration mapping dictionary. ",
            "CKFetchRecordZoneChangesOperation *operation = ",
            "    [[CKFetchRecordZoneChangesOperation alloc] ",
            "     initWithRecordZoneIDs:recordZoneIDs ",
            "     configurationsByRecordZoneID:configurations];",
            "",
            "// Process each changed record as CloudKit returns it.   ",
            "operation.recordChangedBlock = ^(CKRecord *record) {",
            "    recordHandler(record);",
            "};",
            "",
            "// Cache the change tokens that CloudKit provides as",
            "// the operation runs.",
            "operation.recordZoneChangeTokensUpdatedBlock = ^(CKRecordZoneID *recordZoneID, ",
            "                                                 CKServerChangeToken *token, ",
            "                                                 NSData *data) {",
            "    [tokenCache setObject:token forKey:recordZoneID];",
            "};",
            "",
            "// If the fetch for the current record zone completes",
            "// successfully, cache the final change token.    ",
            "operation.recordZoneFetchCompletionBlock = ^(CKRecordZoneID *recordZoneID, ",
            "                                             CKServerChangeToken *token, ",
            "                                             NSData *data, BOOL more, ",
            "                                             NSError *error) {",
            "    if (error) {",
            "        // Handle the error.",
            "    } else {",
            "        [tokenCache setObject:token forKey:recordZoneID];",
            "    }",
            "};",
            "",
            "// Set an appropriate QoS and add the operation to the shared",
            "// database's operation queue to execute it.",
            "operation.qualityOfService = NSQualityOfServiceUtility;",
            "[CKContainer.defaultContainer.sharedCloudDatabase addOperation:operation];"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3735872",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}