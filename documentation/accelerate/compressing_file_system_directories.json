{
  "abstract": [
    {
      "type": "text",
      "text": "Compress the contents of an entire directory and store the result on the file system."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/applearchive"
      ],
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/accelerate"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 3627045,
  "kind": "article",
  "metadata": {
    "title": "Compressing File System Directories",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "Apple Archive"
      }
    ]
  },
  "schemaVersion": {
    "major": 1,
    "minor": 0,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/accelerate/compressing_file_system_directories",
        "documentation/applearchive/compressing_file_system_directories"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/accelerate/compressing_file_system_directories",
        "documentation/applearchive/compressing_file_system_directories"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/applearchive": {
      "title": "Apple Archive",
      "identifier": "doc://com.apple.documentation/documentation/applearchive",
      "url": "/documentation/applearchive",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/accelerate": {
      "title": "Accelerate",
      "identifier": "doc://com.apple.documentation/documentation/accelerate",
      "url": "/documentation/accelerate",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/applearchive/archivebytestream/3588505-filestream": {
      "title": "fileStream(path:mode:options:permissions:)",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/applearchive/archivebytestream/3588505-filestream",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/applearchive/archivebytestream/3588505-filestream"
    },
    "doc://com.apple.documentation/documentation/system/filedescriptor/accessmode/writeonly": {
      "title": "writeOnly",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/system/filedescriptor/accessmode/writeonly",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/system/filedescriptor/accessmode/writeonly"
    },
    "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627228": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627228",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/compressing_file_system_directories#3627228"
    },
    "doc://com.apple.documentation/documentation/applearchive/archivecompression/3588541-lzfse": {
      "title": "lzfse",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/applearchive/archivecompression/3588541-lzfse",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/applearchive/archivecompression/3588541-lzfse"
    },
    "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627231": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627231",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/compressing_file_system_directories#3627231"
    },
    "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627223": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627223",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/compressing_file_system_directories#3627223"
    },
    "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627226": {
      "title": "Listing 4",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627226",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/compressing_file_system_directories#3627226"
    },
    "doc://com.apple.documentation/documentation/applearchive/archivestream/3589318-writedirectorycontents": {
      "title": "writeDirectoryContents(archiveFrom:path:keySet:selectUsing:flags:threadCount:)",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/applearchive/archivestream/3589318-writedirectorycontents",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/applearchive/archivestream/3589318-writedirectorycontents"
    },
    "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627225": {
      "title": "Listing 5",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories#3627225",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/compressing_file_system_directories#3627225"
    },
    "doc://com.apple.documentation/documentation/foundation/1409211-nstemporarydirectory": {
      "title": "NSTemporaryDirectory",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/1409211-nstemporarydirectory",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/1409211-nstemporarydirectory"
    },
    "doc://com.apple.documentation/documentation/compression/algorithm/lzfse": {
      "title": "Algorithm.lzfse",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/compression/algorithm/lzfse",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/compression/algorithm/lzfse"
    },
    "doc://com.apple.documentation/documentation/accelerate/compressing_single_files": {
      "title": "Compressing Single Files",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/compressing_single_files",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/compressing_single_files",
      "abstract": [
        {
          "type": "text",
          "text": "Compress a single file and store the result on the file system."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/decompressing_single_files": {
      "title": "Decompressing Single Files",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/decompressing_single_files",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/decompressing_single_files",
      "abstract": [
        {
          "type": "text",
          "text": "Recreate a single file from a compressed file."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories": {
      "title": "Compressing File System Directories",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/compressing_file_system_directories",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/compressing_file_system_directories",
      "abstract": [
        {
          "type": "text",
          "text": "Compress the contents of an entire directory and store the result on the file system."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/decompressing_and_extracting_an_archived_directory": {
      "title": "Decompressing and Extracting an Archived Directory",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/decompressing_and_extracting_an_archived_directory",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/decompressing_and_extracting_an_archived_directory",
      "abstract": [
        {
          "type": "text",
          "text": "Recreate an entire file system directory from an archive file."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/compressing_and_saving_a_string_to_the_file_system": {
      "title": "Compressing and Saving a String to the File System",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/compressing_and_saving_a_string_to_the_file_system",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/compressing_and_saving_a_string_to_the_file_system",
      "abstract": [
        {
          "type": "text",
          "text": "Compress the contents of a Unicode string and store the result on the file system."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/decompressing_and_parsing_an_archived_string": {
      "title": "Decompressing and Parsing an Archived String",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/decompressing_and_parsing_an_archived_string",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/decompressing_and_parsing_an_archived_string",
      "abstract": [
        {
          "type": "text",
          "text": "Recreate a string from an archive file."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/accelerate/compressing_single_files",
        "doc://com.apple.documentation/documentation/accelerate/decompressing_single_files",
        "doc://com.apple.documentation/documentation/accelerate/decompressing_and_extracting_an_archived_directory",
        "doc://com.apple.documentation/documentation/accelerate/compressing_and_saving_a_string_to_the_file_system",
        "doc://com.apple.documentation/documentation/accelerate/decompressing_and_parsing_an_archived_string"
      ],
      "title": "AppleArchive Essentials",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "In this article, youâ€™ll learn how to use AppleArchive to compress the contents of an entire directory to a single archive file."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The code below compresses the contents of a directory name "
            },
            {
              "type": "codeVoice",
              "code": "src"
            },
            {
              "type": "text",
              "text": " using the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/compression/algorithm/lzfse"
            },
            {
              "type": "text",
              "text": " algorithm, and stores the result in a file named "
            },
            {
              "type": "codeVoice",
              "code": "directory.aar"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Create the File Stream to Write the Compressed File",
          "anchor": "3627232"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Use "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/applearchive/archivebytestream/3588505-filestream"
            },
            {
              "type": "text",
              "text": " to create the file stream that writes the compressed file to the file system. In this case, use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/system/filedescriptor/accessmode/writeonly"
            },
            {
              "type": "text",
              "text": " mode:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let archiveDestination = NSTemporaryDirectory() + \"directory.aar\"",
            "let archiveFilePath = FilePath(archiveDestination)",
            "",
            "guard let writeFileStream = ArchiveByteStream.fileStream(",
            "        path: archiveFilePath,",
            "        mode: .writeOnly,",
            "        options: [ .create ],",
            "        permissions: FilePermissions(rawValue: 0o644)) else {",
            "    return",
            "}",
            "defer {",
            "    try? writeFileStream.close()",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3627228",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Create the Compression Stream",
          "anchor": "3627230"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create the compression stream, and specify the compression algorithm as "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/applearchive/archivecompression/3588541-lzfse"
            },
            {
              "type": "text",
              "text": ". Specify the file-writing stream as the stream that receives the compressed data:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "guard let compressStream = ArchiveByteStream.compressionStream(",
            "        using: .lzfse,",
            "        writingTo: writeFileStream) else {",
            "    return",
            "}",
            "defer {",
            "    try? compressStream.close()",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3627231",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Create the Encoding Stream",
          "anchor": "3627229"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create the encoding stream. The encoding stream encodes its data as a byte stream, and sends the encoded data to the compression stream:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "guard let encodeStream = ArchiveStream.encodeStream(writingTo: compressStream) else {",
            "    return",
            "}",
            "defer {",
            "    try? encodeStream.close()",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3627223",
            "title": "Listing 3"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Define the Header Keys",
          "anchor": "3627227"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create a field key set that defines the fields in the archive header:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "guard let keySet = ArchiveHeader.FieldKeySet(\"TYP,PAT,LNK,DEV,DAT,UID,GID,MOD,FLG,MTM,BTM,CTM\") else {",
            "    return",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3627226",
            "title": "Listing 4"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Compress the Directory Contents",
          "anchor": "3627224"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Use "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/applearchive/archivestream/3589318-writedirectorycontents"
            },
            {
              "type": "text",
              "text": " to write the directory contents to the encode stream. In turn, the encode stream writes to the compression stream and then, the compression stream writes to the file stream. Finally, the file stream writes the archive file to the file system:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let sourcePath = NSTemporaryDirectory() + \"src/\"",
            "let source = FilePath(sourcePath)",
            "",
            "do {",
            "    try encodeStream.writeDirectoryContents(",
            "        archiveFrom: source,",
            "        keySet: keySet)",
            "} catch {",
            "    fatalError(\"Write directory contents failed.\")",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3627225",
            "title": "Listing 5"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "On return, "
            },
            {
              "type": "codeVoice",
              "code": "directory.aar"
            },
            {
              "type": "text",
              "text": " exists in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/1409211-nstemporarydirectory"
            },
            {
              "type": "text",
              "text": " and contains the compressed contents of "
            },
            {
              "type": "codeVoice",
              "code": "src/"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": []
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2020 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}