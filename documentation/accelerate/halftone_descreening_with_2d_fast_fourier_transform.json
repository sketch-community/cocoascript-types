{
  "abstract": [
    {
      "type": "text",
      "text": "Reduce or remove periodic artifacts from images."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/accelerate"
      ],
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/accelerate",
        "doc://com.apple.documentation/documentation/accelerate/fast_fourier_transforms"
      ],
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/accelerate",
        "doc://com.apple.documentation/documentation/accelerate/vdsp",
        "doc://com.apple.documentation/documentation/accelerate/fast_fourier_transforms"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2983559,
  "kind": "article",
  "metadata": {
    "title": "Halftone Descreening with 2D Fast Fourier Transform",
    "role": "sampleCode",
    "roleHeading": "Sample Code",
    "modules": [
      {
        "name": "Accelerate"
      }
    ],
    "platforms": [
      {
        "name": "iOS",
        "introducedAt": "13.0",
        "current": "14.3"
      },
      {
        "name": "Xcode",
        "introducedAt": "11.2",
        "current": "12.3"
      }
    ]
  },
  "schemaVersion": {
    "major": 1,
    "minor": 0,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform",
        "documentation/accelerate/fast_fourier_transforms/halftone_descreening_with_2d_fast_fourier_transform",
        "documentation/accelerate/vdsp/fast_fourier_transforms/halftone_descreening_with_2d_fast_fourier_transform"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform",
        "documentation/accelerate/fast_fourier_transforms/halftone_descreening_with_2d_fast_fourier_transform",
        "documentation/accelerate/vdsp/fast_fourier_transforms/halftone_descreening_with_2d_fast_fourier_transform"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/accelerate": {
      "title": "Accelerate",
      "identifier": "doc://com.apple.documentation/documentation/accelerate",
      "url": "/documentation/accelerate",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/accelerate/fast_fourier_transforms": {
      "title": "Fast Fourier Transforms",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/fast_fourier_transforms",
      "kind": "article",
      "role": "collectionGroup",
      "url": "/documentation/accelerate/fast_fourier_transforms",
      "abstract": [
        {
          "type": "text",
          "text": "Transform vectors and matrices of temporal and spatial domain complex values to the frequency domain, and vice versa."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/vdsp": {
      "title": "vDSP",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp",
      "url": "/documentation/accelerate/vdsp",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421510": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421510",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421510"
    },
    "doc://com.apple.documentation/documentation/accelerate/vdsp/3240870-convert": {
      "title": "convert(interleavedComplexVector:toSplitComplexVector:)",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3240870-convert",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/accelerate/vdsp/3240870-convert"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421511": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421511",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421511"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421513": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421513",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421513"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421515": {
      "title": "Listing 4",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421515",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421515"
    },
    "doc://com.apple.documentation/documentation/accelerate/vdsp/fft2d/3240742-transform": {
      "title": "transform(input:output:direction:)",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/fft2d/3240742-transform",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/accelerate/vdsp/fft2d/3240742-transform"
    },
    "doc://com.apple.documentation/documentation/accelerate/vdsp/3241114-squaremagnitudes": {
      "title": "squareMagnitudes(_:result:)",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3241114-squaremagnitudes",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/accelerate/vdsp/3241114-squaremagnitudes"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421517": {
      "title": "Listing 5",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421517",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421517"
    },
    "doc://com.apple.documentation/documentation/accelerate/vdsp/3241145-threshold": {
      "title": "threshold(_:to:with:)",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3241145-threshold",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/accelerate/vdsp/3241145-threshold"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421519": {
      "title": "Listing 6",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421519",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421519"
    },
    "doc://com.apple.documentation/documentation/accelerate/vdsp/3240865-clip": {
      "title": "clip(_:to:result:)",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3240865-clip",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/accelerate/vdsp/3240865-clip"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421520": {
      "title": "Listing 7",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421520",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421520"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421522": {
      "title": "Listing 8",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421522",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421522"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421524": {
      "title": "Listing 9",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421524",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421524"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421526": {
      "title": "Listing 10",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421526",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421526"
    },
    "doc://com.apple.documentation/documentation/accelerate/vdsp/3240880-convertelements": {
      "title": "convertElements(of:to:)",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3240880-convertelements",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/accelerate/vdsp/3240880-convertelements"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421527": {
      "title": "Listing 11",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421527",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421527"
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421528": {
      "title": "Listing 12",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421528",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421528"
    },
    "link-media-3421508": {
      "identifier": "link-media-3421508",
      "type": "link",
      "title": "Figure 1",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform#3421508"
    },
    "media-3421508": {
      "identifier": "media-3421508",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 622,
            "height": 387
          },
          "url": "https://docs-assets.developer.apple.com/published/592b04e527/29b1b19f-8cee-4736-a19a-f01d0c4dce04.png"
        }
      ],
      "alt": "Photographs showing before and after images.",
      "title": "Figure 1"
    },
    "doc://com.apple.documentation/documentation/accelerate/finding_the_component_frequencies_in_a_composite_sine_wave": {
      "title": "Finding the Component Frequencies in a Composite Sine Wave",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/finding_the_component_frequencies_in_a_composite_sine_wave",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/finding_the_component_frequencies_in_a_composite_sine_wave",
      "abstract": [
        {
          "type": "text",
          "text": "Use 1D fast Fourier transform to compute the frequency components of a signal."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/performing_fourier_transforms_on_interleaved-complex_data": {
      "title": "Performing Fourier Transforms on Interleaved-Complex Data",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/performing_fourier_transforms_on_interleaved-complex_data",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/performing_fourier_transforms_on_interleaved-complex_data",
      "abstract": [
        {
          "type": "text",
          "text": "Optimize fast Fourier transform (FFT) performance with vDSP’s fixed-length interleaved FFT routines."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/using_windowing_with_discrete_fourier_transforms": {
      "title": "Using Windowing with Discrete Fourier Transforms",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/using_windowing_with_discrete_fourier_transforms",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/using_windowing_with_discrete_fourier_transforms",
      "abstract": [
        {
          "type": "text",
          "text": "Multiply signal data by window sequence values to reduce spectral leakage."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/signal_extraction_from_noise": {
      "title": "Signal Extraction from Noise",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/signal_extraction_from_noise",
      "kind": "article",
      "role": "sampleCode",
      "url": "/documentation/accelerate/signal_extraction_from_noise",
      "abstract": [
        {
          "type": "text",
          "text": "Use Accelerate’s discrete cosine transform to remove noise from a signal."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/performing_fourier_transforms_on_multiple_signals": {
      "title": "Performing Fourier Transforms on Multiple Signals",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/performing_fourier_transforms_on_multiple_signals",
      "kind": "article",
      "role": "article",
      "url": "/documentation/accelerate/performing_fourier_transforms_on_multiple_signals",
      "abstract": [
        {
          "type": "text",
          "text": "Use Accelerate’s multiple-signal fast Fourier transform (FFT) functions to transform multiple signals with a single function call."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform": {
      "title": "Halftone Descreening with 2D Fast Fourier Transform",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform",
      "kind": "article",
      "role": "sampleCode",
      "url": "/documentation/accelerate/halftone_descreening_with_2d_fast_fourier_transform",
      "abstract": [
        {
          "type": "text",
          "text": "Reduce or remove periodic artifacts from images."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/discrete_fourier_transforms": {
      "title": "Discrete Fourier Transforms",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/discrete_fourier_transforms",
      "kind": "article",
      "role": "collectionGroup",
      "url": "/documentation/accelerate/discrete_fourier_transforms",
      "abstract": [
        {
          "type": "text",
          "text": "Transform vectors of temporal and spatial domain complex values to the frequency domain, and vice versa."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/accelerate/discrete_cosine_transforms": {
      "title": "Discrete Cosine Transforms",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/accelerate/discrete_cosine_transforms",
      "kind": "article",
      "role": "collectionGroup",
      "url": "/documentation/accelerate/discrete_cosine_transforms",
      "abstract": [
        {
          "type": "text",
          "text": "Transform vectors of temporal and spatial domain real values to the frequency domain, and vice versa."
        }
      ]
    },
    "https://docs-assets.developer.apple.com/published/8d3b413ac5/HalftoneDescreeningWith2DFastFourierTransform.zip": {
      "type": "download",
      "identifier": "https://docs-assets.developer.apple.com/published/8d3b413ac5/HalftoneDescreeningWith2DFastFourierTransform.zip",
      "checksum": "14a3618b96b815710d960fbaab64e44e7cc6217ada5e1092627149537f0f2594a7c383827cf40fe5d8bdbe44a2af22002ae004480cea67d53ef39009f1339012",
      "url": "https://docs-assets.developer.apple.com/published/8d3b413ac5/HalftoneDescreeningWith2DFastFourierTransform.zip"
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "sampleCodeDownload": {
    "action": {
      "overridingTitle": "Download",
      "type": "reference",
      "isActive": true,
      "identifier": "https://docs-assets.developer.apple.com/published/8d3b413ac5/HalftoneDescreeningWith2DFastFourierTransform.zip"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/accelerate/finding_the_component_frequencies_in_a_composite_sine_wave",
        "doc://com.apple.documentation/documentation/accelerate/performing_fourier_transforms_on_interleaved-complex_data",
        "doc://com.apple.documentation/documentation/accelerate/using_windowing_with_discrete_fourier_transforms",
        "doc://com.apple.documentation/documentation/accelerate/signal_extraction_from_noise",
        "doc://com.apple.documentation/documentation/accelerate/performing_fourier_transforms_on_multiple_signals",
        "doc://com.apple.documentation/documentation/accelerate/fast_fourier_transforms",
        "doc://com.apple.documentation/documentation/accelerate/discrete_fourier_transforms",
        "doc://com.apple.documentation/documentation/accelerate/discrete_cosine_transforms"
      ],
      "title": "Fourier and Cosine Transforms",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Accelerate’s vDSP module provides functions to perform 2D fast Fourier transforms (FFTs) on matrices of data, such as images. You can exploit the amplitude peaks in the frequency domain of periodic patterns, such as halftone screens, to reduce or remove such artifacts from images. The example below shows an image with halftone artifacts (left) and the same image with the halftone artifacts reduced (right):"
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-3421508",
              "metadata": {
                "anchor": "3421508",
                "title": "Figure 1"
              }
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "This sample walks you through the following steps to implement halftone descreening, using a halftone screen sample that you’ve created programmatically or taken from source material:"
            }
          ]
        },
        {
          "type": "orderedList",
          "items": [
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Convert the image data to a split complex vector."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Prepare the FFT setup."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Perform forward 2D FFT on image data."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Zero the peaks in the halftone sample magnitude."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Descreen the source image."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Perform inverse 2D FFT on the source image frequency domain data."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Generate an image from a split complex vector."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The sample works on a single-channel, monochrome image."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Convert Image Data to a Split Complex Vector",
          "anchor": "3421531"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create a split complex vector—suitable for use with vDSP’s 2D FFT—by copying odd pixels to the real parts and even pixels to the imaginary parts of an array of complex numbers. Use the following code to convert the 8-bit unsigned integer image data to floating-point data with which the 2D FFT routine works:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let pixelCount = Int(image.size.width * image.size.height)",
            "",
            "let pixelData = cgImage.dataProvider?.data",
            "",
            "let pixelsArray = Array(UnsafeBufferPointer(start: CFDataGetBytePtr(pixelData),",
            "                                            count: pixelCount))",
            "",
            "let floatPixels = vDSP.integerToFloatingPoint(pixelsArray,",
            "                                              floatingPointType: Float.self)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421510",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "With the floating-point values populated, create an array of complex numbers, "
            },
            {
              "type": "codeVoice",
              "code": "interleavedPixels"
            },
            {
              "type": "text",
              "text": ", that you pass to "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3240870-convert"
            },
            {
              "type": "text",
              "text": ", which copies the values into a split complex vector:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let interleavedPixels = stride(from: 1, to: floatPixels.count, by: 2).map {",
            "    return DSPComplex(real: floatPixels[$0.advanced(by: -1)],",
            "                      imag: floatPixels[$0])",
            "}",
            "",
            "vDSP.convert(interleavedComplexVector: interleavedPixels,",
            "             toSplitComplexVector: &splitComplexOut)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421511",
            "title": "Listing 2"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Prepare the 2D FFT Setup",
          "anchor": "3421532"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create a setup object that contains all the information required to perform the forward and inverse 2D FFT operations. Creating this setup object can be expensive, so do it only once—for example, when your app is starting—and reuse it."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The following code creates a setup object suitable for performing forward and inverse 2D FFTs on a 1024 x 1024 pixel image:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "static let fftSetUp = vDSP.FFT2D(width: 1024,",
            "                                 height: 1024,",
            "                                 ofType: DSPSplitComplex.self)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421513",
            "title": "Listing 3"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Prepare Arrays for Transformed Image Data",
          "anchor": "3421533"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create arrays to receive the forward transformed source image and halftone sample:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "var sourceImage_floatPixelsReal_frequency = [Float](repeating: 0,",
            "                                                  count: n)",
            "var sourceImage_floatPixelsImag_frequency = [Float](repeating: 0,",
            "                                                    count: n)",
            "",
            "var halftoneSample_floatPixelsReal_frequency = [Float](repeating: 0,",
            "                                                       count: n)",
            "var halftoneSample_floatPixelsImag_frequency = [Float](repeating: 0,",
            "                                                       count: n)",
            "var halftoneSampleAmplitude = [Float](repeating: 0,",
            "                                        count: n)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421515",
            "title": "Listing 4"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Perform Forward 2D FFTs on Image Data",
          "anchor": "3421534"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/fft2d/3240742-transform"
            },
            {
              "type": "text",
              "text": " function to perform a forward 2D FFT on the image data, creating the frequency domain representation of the image. Pass "
            },
            {
              "type": "codeVoice",
              "code": "transform(input:output:direction:)"
            },
            {
              "type": "text",
              "text": " a split complex structure as the destination, with the same length as the source structure."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The following example shows the code required to perform the FFT on the source image and halftone sample data. After the forward FFT of the halftone sample is is complete, use "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3241114-squaremagnitudes"
            },
            {
              "type": "text",
              "text": " function to compute the magnitudes of the complex values representing the halftone sample:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "sourceImage_floatPixelsReal_frequency.withUnsafeMutableBufferPointer { sourceRealPtr in",
            "    sourceImage_floatPixelsImag_frequency.withUnsafeMutableBufferPointer { sourceImagPtr in",
            "        halftoneSample_floatPixelsReal_frequency.withUnsafeMutableBufferPointer { halftoneRealPtr in",
            "            halftoneSample_floatPixelsImag_frequency.withUnsafeMutableBufferPointer { halftoneImagPtr in",
            "                ",
            "                var sourceImage_floatPixels_frequency = DSPSplitComplex(",
            "                    realp: sourceRealPtr.baseAddress!,",
            "                    imagp: sourceImagPtr.baseAddress!)",
            "                ",
            "                fftSetUp?.transform(input: sourceImageSplitComplex,",
            "                                    output: &sourceImage_floatPixels_frequency,",
            "                                    direction: .forward)",
            "                                    ",
            "                var halftoneSample_floatPixels_frequency = DSPSplitComplex(",
            "                    realp: halftoneRealPtr.baseAddress!,",
            "                    imagp: halftoneImagPtr.baseAddress!)",
            "                ",
            "                fftSetUp?.transform(input: halftoneSampleSplitComplex,",
            "                                    output: &halftoneSample_floatPixels_frequency,",
            "                                    direction: .forward)",
            "                ",
            "                vDSP.squareMagnitudes(halftoneSample_floatPixels_frequency,",
            "                                      result: &halftoneSampleAmplitude)",
            "            }",
            "        }",
            "    }",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421517",
            "title": "Listing 5"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Zero the Peaks in the Halftone Sample Magnitude",
          "anchor": "3421535"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "You can reduce the halftone screen artifacts by manipulating the magnitude of the frequency domain data for the halftone sample. Zero all the samples above a specified threshold in the magnitudes and clamp the data to 0…1. Then, multiply the frequency domain data of the source image by the manipulated magnitudes."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3241145-threshold"
            },
            {
              "type": "text",
              "text": " function to set all magnitude values that are over the threshold to -1, and all magnitude values that are less than or equal to the threshold to 1:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let outputConstant: Float = -1",
            "",
            "vDSP.threshold(halftoneSampleAmplitude,",
            "               to: threshold,",
            "               with: .signedConstant(outputConstant),",
            "               result: &halftoneSampleAmplitude)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421519",
            "title": "Listing 6"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "You can now clip the magnitude data between 0 and 1. After "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3240865-clip"
            },
            {
              "type": "text",
              "text": " returns, all the high-magnitude values in "
            },
            {
              "type": "codeVoice",
              "code": "halftoneSampleAmplitude"
            },
            {
              "type": "text",
              "text": " are set to 0, and all the low-magnitude values are set to 1:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "vDSP.clip(halftoneSampleAmplitude,",
            "          to: 0 ... 1,",
            "          result: &halftoneSampleAmplitude)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421520",
            "title": "Listing 7"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Descreen the Source Image",
          "anchor": "3421536"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Multiply the frequency domain data of the source image by the values in "
            },
            {
              "type": "codeVoice",
              "code": "halftoneSampleAmplitude"
            },
            {
              "type": "text",
              "text": ", to remove or reduce the halftone screen:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "vDSP.multiply(sourceImage_floatPixels_frequency,",
            "              by: halftoneSampleAmplitude,",
            "              result: &sourceImage_floatPixels_frequency)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421522",
            "title": "Listing 8"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Perform Inverse 2D FFT on Frequency Domain Data",
          "anchor": "3421537"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "You can now perform an inverse 2D FFT to generate a spatial domain version of the image. Use the same "
            },
            {
              "type": "codeVoice",
              "code": "fftSetup"
            },
            {
              "type": "text",
              "text": " pointer as you used for the forward 2D FFT, but specify the inverse direction:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "fftSetUp?.transform(input: sourceImage_floatPixels_frequency,",
            "                    output: &floatPixels_spatial,",
            "                    direction: .inverse)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421524",
            "title": "Listing 9"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Generate an Image from a Split Complex Vector",
          "anchor": "3421538"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Your last step is to create a displayable image from the spatial domain representation of the treated source image. The final image is generated from 8-bit, unsigned integers. Because single-precision values can exceed the range of an 8-bit, unsigned integer, clamp the values before converting them:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "var low: Float = 0",
            "var high: Float = 255",
            "",
            "vDSP_vclip(pixelSource.realp,",
            "           stride,",
            "           &low,",
            "           &high,",
            "           pixelSource.realp,",
            "           stride,",
            "           n)",
            "",
            "vDSP_vclip(pixelSource.imagp,",
            "           stride,",
            "           &low,",
            "           &high,",
            "           pixelSource.imagp,",
            "           stride, n)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421526",
            "title": "Listing 10"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Use "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/accelerate/vdsp/3240880-convertelements"
            },
            {
              "type": "text",
              "text": " to convert the floating-point values back to 8-bit unsigned integers that are suitable for generating an image:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "var uIntPixels = [UInt8](repeating: 0,",
            "                         count: pixelCount)",
            "",
            "let floatPixels = [Float](fromSplitComplex: pixelSource,",
            "                          scale: 1,",
            "                          count: pixelCount)",
            "",
            "vDSP.convertElements(of: floatPixels,",
            "                     to: &uIntPixels,",
            "                     rounding: .towardZero)"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421527",
            "title": "Listing 11"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Now that "
            },
            {
              "type": "codeVoice",
              "code": "uIntPixels"
            },
            {
              "type": "text",
              "text": " is populated with the pixel values, generate a "
            },
            {
              "type": "codeVoice",
              "code": "CGImage"
            },
            {
              "type": "text",
              "text": " instance from those values:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "",
            "let result: UIImage? = uIntPixels.withUnsafeMutableBufferPointer { uIntPixelsPtr in",
            "    ",
            "    let buffer = vImage_Buffer(data: uIntPixelsPtr.baseAddress!,",
            "                               height: vImagePixelCount(height),",
            "                               width: vImagePixelCount(width),",
            "                               rowBytes: width)",
            "    ",
            "    if",
            "        let format = vImage_CGImageFormat(bitsPerComponent: 8,",
            "                                          bitsPerPixel: 8,",
            "                                          colorSpace: CGColorSpaceCreateDeviceGray(),",
            "                                          bitmapInfo: bitmapInfo),",
            "        let cgImage = try? buffer.createCGImage(format: format) {",
            "        ",
            "        return UIImage(cgImage: cgImage)",
            "    } else {",
            "        print(\"Unable to create `CGImage`.\")",
            "        return nil",
            "    }",
            "}",
            ""
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "3421528",
            "title": "Listing 12"
          }
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2020 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}