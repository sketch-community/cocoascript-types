{
  "abstract": [
    {
      "type": "text",
      "text": "Runs an executable tool with root privileges."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/security",
        "doc://com.apple.documentation/documentation/security/authorization_services"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/security/1540038-authorizationexecutewithprivileg",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 1540038,
  "kind": "symbol",
  "metadata": {
    "title": "AuthorizationExecuteWithPrivileges",
    "role": "symbol",
    "roleHeading": "Function",
    "modules": [
      {
        "name": "Security"
      }
    ],
    "platforms": [
      {
        "name": "macOS",
        "introducedAt": "10.1",
        "deprecatedAt": "10.7",
        "current": "11.1",
        "deprecated": true
      }
    ],
    "externalID": "c:@F@AuthorizationExecuteWithPrivileges",
    "symbolKind": "func"
  },
  "schemaVersion": {
    "major": 1,
    "minor": 0,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/security/1540038-authorizationexecutewithprivileg"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/security": {
      "title": "Security",
      "identifier": "doc://com.apple.documentation/documentation/security",
      "url": "/documentation/security",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/security/authorization_services": {
      "title": "Authorization Services",
      "identifier": "doc://com.apple.documentation/documentation/security/authorization_services",
      "url": "/documentation/security/authorization_services",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/security/authorizationflags/kauthorizationflagdefaults": {
      "title": "kAuthorizationFlagDefaults",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/authorizationflags/kauthorizationflagdefaults",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/authorizationflags/kauthorizationflagdefaults"
    },
    "doc://com.apple.documentation/documentation/security/1540021-authorizationcopyprivilegedrefer": {
      "title": "AuthorizationCopyPrivilegedReference",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1540021-authorizationcopyprivilegedrefer",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1540021-authorizationcopyprivilegedrefer",
      "abstract": [
        {
          "type": "text",
          "text": "Retrieves the authorization reference passed by the "
        },
        {
          "type": "reference",
          "isActive": false,
          "identifier": "doc://com.apple.documentation/documentation/security/1540038-authorizationexecutewithprivileg"
        },
        {
          "type": "text",
          "text": " function."
        }
      ],
      "deprecated": true
    },
    "doc://com.apple.documentation/documentation/security/authorizationitem": {
      "title": "AuthorizationItem",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/authorizationitem",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/authorizationitem"
    },
    "doc://com.apple.documentation/documentation/security/1540004-authorization_services_result_co": {
      "title": "Authorization Services Result Codes",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1540004-authorization_services_result_co",
      "kind": "symbol",
      "role": "containerSymbol",
      "url": "/documentation/security/1540004-authorization_services_result_co"
    },
    "doc://com.apple.documentation/documentation/security/1540038-authorizationexecutewithprivileg": {
      "title": "AuthorizationExecuteWithPrivileges",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1540038-authorizationexecutewithprivileg",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1540038-authorizationexecutewithprivileg",
      "abstract": [
        {
          "type": "text",
          "text": "Runs an executable tool with root privileges."
        }
      ],
      "deprecated": true
    },
    "doc://com.apple.documentation/documentation/security/authorizationref": {
      "title": "AuthorizationRef",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/authorizationref",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/authorizationref"
    },
    "doc://com.apple.documentation/documentation/security/authorizationflags": {
      "title": "AuthorizationFlags",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/authorizationflags",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/authorizationflags"
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "deprecationSummary": [
    {
      "type": "paragraph",
      "inlineContent": [
        {
          "type": "text",
          "text": "Use a launchd-launched helper tool and/or the Service Management framework for this functionality."
        }
      ]
    }
  ],
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/security/1540021-authorizationcopyprivilegedrefer"
      ],
      "title": "Executing with Root Privileges",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "declarations",
      "declarations": [
        {
          "languages": [
            "occ"
          ],
          "tokens": [
            {
              "kind": "typeIdentifier",
              "preciseIdentifier": "c:@T@OSStatus",
              "identifier": "symbol-1480124",
              "text": "OSStatus"
            },
            {
              "kind": "text",
              "text": " "
            },
            {
              "kind": "identifier",
              "text": "AuthorizationExecuteWithPrivileges"
            },
            {
              "kind": "text",
              "text": "("
            },
            {
              "kind": "typeIdentifier",
              "preciseIdentifier": "c:@T@AuthorizationRef",
              "identifier": "doc://com.apple.documentation/documentation/security/authorizationref",
              "text": "AuthorizationRef"
            },
            {
              "kind": "text",
              "text": " authorization, "
            },
            {
              "kind": "keyword",
              "text": "const"
            },
            {
              "kind": "text",
              "text": " "
            },
            {
              "kind": "keyword",
              "text": "char"
            },
            {
              "kind": "text",
              "text": " *pathToTool, "
            },
            {
              "kind": "typeIdentifier",
              "preciseIdentifier": "c:@T@AuthorizationFlags",
              "identifier": "doc://com.apple.documentation/documentation/security/authorizationflags",
              "text": "AuthorizationFlags"
            },
            {
              "kind": "text",
              "text": " options, "
            },
            {
              "kind": "keyword",
              "text": "char"
            },
            {
              "kind": "text",
              "text": " *"
            },
            {
              "kind": "keyword",
              "text": "const"
            },
            {
              "kind": "text",
              "text": "  "
            },
            {
              "kind": "keyword",
              "text": "_Nonnull"
            },
            {
              "kind": "text",
              "text": " *arguments, "
            },
            {
              "kind": "typeIdentifier",
              "text": "FILE"
            },
            {
              "kind": "text",
              "text": " * "
            },
            {
              "kind": "keyword",
              "text": "_Nullable"
            },
            {
              "kind": "text",
              "text": " *communicationsPipe);"
            }
          ],
          "platforms": [
            "macOS"
          ]
        }
      ]
    },
    {
      "kind": "parameters",
      "languages": [
        "occ"
      ],
      "parameters": [
        {
          "name": "authorization",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "An authorization reference referring to the authorization session."
                }
              ]
            }
          ]
        },
        {
          "name": "pathToTool",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "The full POSIX pathname of the tool to execute."
                }
              ]
            }
          ]
        },
        {
          "name": "options",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "Reserved options. Pass the "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/security/authorizationflags/kauthorizationflagdefaults"
                },
                {
                  "type": "text",
                  "text": " constant."
                }
              ]
            }
          ]
        },
        {
          "name": "arguments",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "An argv-style vector of strings (array of null-terminated "
                },
                {
                  "type": "codeVoice",
                  "code": "char *"
                },
                {
                  "type": "text",
                  "text": " pointers ending with a NULL pointer) to send to the tool. (You do not need to pass the name of the command as the first argument.)"
                }
              ]
            }
          ]
        },
        {
          "name": "communicationsPipe",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "A pointer to a file structure. The Security Server creates the file, opens it for reading and writing, and connects it to the tool’s standard input and output. On return, you must close and dispose of this file using "
                },
                {
                  "type": "codeVoice",
                  "code": "fclose"
                },
                {
                  "type": "text",
                  "text": " when your communication is complete. Pass "
                },
                {
                  "type": "codeVoice",
                  "code": "NULL"
                },
                {
                  "type": "text",
                  "text": " if you do not need a communications channel."
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "kind": "content",
      "content": [
        {
          "anchor": "return_value",
          "level": 2,
          "text": "Return Value",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "A result code. See "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1540004-authorization_services_result_co"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        }
      ]
    },
    {
      "kind": "content",
      "content": [
        {
          "anchor": "discussion",
          "level": 2,
          "text": "Discussion",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "This function enables you to execute the tool you specify in the "
            },
            {
              "type": "codeVoice",
              "code": "pathToTool"
            },
            {
              "type": "text",
              "text": " parameter as a separate, privileged process. The new process will run with root privileges regardless of the privileges of the invoking process. The new process can retrieve the authorization reference by calling the function "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1540021-authorizationcopyprivilegedrefer"
            },
            {
              "type": "text",
              "text": ". The arguments you pass in the "
            },
            {
              "type": "codeVoice",
              "code": "arguments"
            },
            {
              "type": "text",
              "text": " parameter are relayed to the new process’s "
            },
            {
              "type": "codeVoice",
              "code": "argv"
            },
            {
              "type": "text",
              "text": " parameter. A set of file descriptors is linked to the new process’s standard input and output so that your process may communicate with the new process."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To check if the user is authorized to perform this operation, you should preauthorize the "
            },
            {
              "type": "codeVoice",
              "code": "kAuthorizationRightExecute"
            },
            {
              "type": "text",
              "text": " right. See "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/authorizationitem"
            },
            {
              "type": "text",
              "text": " for a description of what information is included in the authorization item for this right."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Special Considerations",
          "anchor": "1678182"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "You should use this function only to allow installers to run as root and to allow a "
            },
            {
              "type": "codeVoice",
              "code": "setuid"
            },
            {
              "type": "text",
              "text": " tool to repair its "
            },
            {
              "type": "codeVoice",
              "code": "setuid"
            },
            {
              "type": "text",
              "text": " bit if lost. This function works only if the Security Server establishes proper authorization."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "This function poses a security concern because it will indiscriminately run any tool or application, severely increasing the security risk. You should avoid the use of this function if possible. One alternative is to split your code into two parts—the application and a setuid tool. The application invokes the setuid tool using standard methods. The setuid tool can then perform the privileged operations. If the tool loses its setuid bit, use the "
            },
            {
              "type": "codeVoice",
              "code": "AuthorizationExecuteWithPrivileges"
            },
            {
              "type": "text",
              "text": " function to repair it. Factoring your program minimizes the use of this function and reduces the risk of harm. Read "
            },
            {
              "type": "emphasis",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "Inside macOS: Performing Privileged Operations With Authorization Services"
                }
              ]
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Note that this function respects the setuid bit, if it is set. That is, if the tool you are executing has its setuid bit set and its owner set to foo, the tool will be executed with the user foo’s privileges, not root privileges. To ensure that your call to the "
            },
            {
              "type": "codeVoice",
              "code": "AuthorizationExecuteWithPrivileges"
            },
            {
              "type": "text",
              "text": " function works as intended, make sure the setuid bit of the tool you wish to execute is cleared before calling "
            },
            {
              "type": "codeVoice",
              "code": "AuthorizationExecuteWithPrivileges"
            },
            {
              "type": "text",
              "text": " to execute the tool."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2020 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}