{
  "abstract": [
    {
      "type": "text",
      "text": "Add network credentials to the keychain on behalf of the user."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/security",
        "doc://com.apple.documentation/documentation/security/keychain_services",
        "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items"
      ],
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/security",
        "doc://com.apple.documentation/documentation/security/keychain_services",
        "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items",
        "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/using_the_keychain_to_manage_user_secrets"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2922055,
  "kind": "article",
  "metadata": {
    "title": "Adding a Password to the Keychain",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "Security"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain",
        "documentation/security/keychain_services/keychain_items/using_the_keychain_to_manage_user_secrets/adding_a_password_to_the_keychain"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain",
        "documentation/security/keychain_services/keychain_items/using_the_keychain_to_manage_user_secrets/adding_a_password_to_the_keychain"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/security": {
      "title": "Security",
      "identifier": "doc://com.apple.documentation/documentation/security",
      "url": "/documentation/security",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services": {
      "title": "Keychain Services",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services",
      "url": "/documentation/security/keychain_services",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items": {
      "title": "Keychain Items",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items",
      "url": "/documentation/security/keychain_services/keychain_items",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/using_the_keychain_to_manage_user_secrets": {
      "title": "Using the Keychain to Manage User Secrets",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/using_the_keychain_to_manage_user_secrets",
      "url": "/documentation/security/keychain_services/keychain_items/using_the_keychain_to_manage_user_secrets",
      "type": "topic",
      "kind": "article",
      "role": "article"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922579": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922579",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922579"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922580": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922580",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922580"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922581": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922581",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922581"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922060": {
      "title": "Listing 4",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922060",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922060"
    },
    "doc://com.apple.documentation/documentation/security/ksecclassgenericpassword": {
      "title": "kSecClassGenericPassword",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/ksecclassgenericpassword",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/ksecclassgenericpassword"
    },
    "doc://com.apple.documentation/documentation/security/ksecattrserver": {
      "title": "kSecAttrServer",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/ksecattrserver",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/ksecattrserver"
    },
    "doc://com.apple.documentation/documentation/security/ksecattrprotocol": {
      "title": "kSecAttrProtocol",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/ksecattrprotocol",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/ksecattrprotocol"
    },
    "doc://com.apple.documentation/documentation/foundation/data": {
      "title": "Data",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/data",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/data"
    },
    "doc://com.apple.documentation/documentation/security/1401659-secitemadd": {
      "title": "SecItemAdd",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1401659-secitemadd",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1401659-secitemadd",
      "abstract": [
        {
          "type": "text",
          "text": "Adds one or more items to a keychain."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922061": {
      "title": "Listing 5",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922061",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain#2922061"
    },
    "doc://com.apple.documentation/documentation/security/1398306-secitemcopymatching": {
      "title": "SecItemCopyMatching",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1398306-secitemcopymatching",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1398306-secitemcopymatching"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/searching_for_keychain_items": {
      "title": "Searching for Keychain Items",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/searching_for_keychain_items",
      "kind": "article",
      "role": "article",
      "url": "/documentation/security/keychain_services/keychain_items/searching_for_keychain_items"
    },
    "doc://com.apple.documentation/documentation/security/ksecattrlabel": {
      "title": "kSecAttrLabel",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/ksecattrlabel",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/ksecattrlabel"
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain": {
      "title": "Adding a Password to the Keychain",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain",
      "kind": "article",
      "role": "article",
      "url": "/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain",
      "abstract": [
        {
          "type": "text",
          "text": "Add network credentials to the keychain on behalf of the user."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/item_class_keys_and_values": {
      "title": "Item Class Keys and Values",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/item_class_keys_and_values",
      "kind": "article",
      "role": "collectionGroup",
      "url": "/documentation/security/keychain_services/keychain_items/item_class_keys_and_values",
      "abstract": [
        {
          "type": "text",
          "text": "Specify the class of a keychain item. "
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/item_attribute_keys_and_values": {
      "title": "Item Attribute Keys and Values",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/item_attribute_keys_and_values",
      "kind": "article",
      "role": "collectionGroup",
      "url": "/documentation/security/keychain_services/keychain_items/item_attribute_keys_and_values",
      "abstract": [
        {
          "type": "text",
          "text": "Specify the attributes of keychain items."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/security/1401659-secitemadd",
        "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/item_class_keys_and_values",
        "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/item_attribute_keys_and_values"
      ],
      "title": "Adding Keychain Items",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Use keychain services to enable simple, secure storage for users’ passwords. In this way you avoid repeatedly asking the user for a password, and you don’t have to implement your own encryption, which can be error prone."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Get Set Up",
          "anchor": "2922578"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To get started, define a structure to hold the credentials as they move around your app in memory:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "struct Credentials {",
            "    var username: String",
            "    var password: String",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2922579",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Next, define an error enumeration that you can use to communicate keychain access outcomes:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "enum KeychainError: Error {",
            "    case noPassword",
            "    case unexpectedPasswordData",
            "    case unhandledError(status: OSStatus)",
            "}"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2922580",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Then, identify the server that your app is working with:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "static let server = \"www.example.com\""
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2922581",
            "title": "Listing 3"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Create an Add Query",
          "anchor": "2922058"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Using an instance of the credentials structure and the server constant, you can create an add query:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let account = credentials.username",
            "let password = credentials.password.data(using: String.Encoding.utf8)!",
            "var query: [String: Any] = [kSecClass as String: kSecClassInternetPassword,",
            "                            kSecAttrAccount as String: account,",
            "                            kSecAttrServer as String: server,",
            "                            kSecValueData as String: password]"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2922060",
            "title": "Listing 4"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The query dictionary’s first key-value pair indicates that the item is an Internet password, from which keychain services infers that the data is secret and requires encryption. This also ensures that the item has attributes that distinguish it from other Internet passwords, such as the server and account to which it applies. Indeed, the next two key-value pairs in the query provide this information, attaching the user name acquired from the user as the account, along with a domain name appropriate to this password as the server."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "Keychain services also offers the related "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/security/ksecclassgenericpassword"
                },
                {
                  "type": "text",
                  "text": " item class. Generic passwords are similar in most respects to Internet passwords, but they lack certain attributes specific to remote access (for example, they don’t have a "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/security/ksecattrserver"
                },
                {
                  "type": "text",
                  "text": " attribute). When you don’t need these extra attributes, use a generic password instead."
                }
              ]
            }
          ],
          "style": "note",
          "name": "Note"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Although not necessary in this case, you could further characterize the password by specifying additional attributes, such as the port number or the network protocol. For example, if you needed to store distinct FTP and HTTP credentials for the same user working on the same server, you could add the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/ksecattrprotocol"
            },
            {
              "type": "text",
              "text": " attribute to distinguish between them."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Finally, the query contains the password from the user, encoded as a "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/data"
            },
            {
              "type": "text",
              "text": " instance."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Add the Item",
          "anchor": "2922059"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "With the query complete, you simply feed it to the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1401659-secitemadd"
            },
            {
              "type": "text",
              "text": " function:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "let status = SecItemAdd(query as CFDictionary, nil)",
            "guard status == errSecSuccess else { throw KeychainError.unhandledError(status: status) }"
          ],
          "syntax": "swift",
          "metadata": {
            "anchor": "2922061",
            "title": "Listing 5"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Although you typically ignore the return data supplied by reference in the second argument on an add operation (as demonstrated here), always check the function’s return status to ensure that the operation succeeds. The operation might fail, for example, if an item with the given attributes already exists."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "If you do want the return data, keep in mind that the "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/security/1401659-secitemadd"
                },
                {
                  "type": "text",
                  "text": " function behaves much like the "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/security/1398306-secitemcopymatching"
                },
                {
                  "type": "text",
                  "text": " function in this regard. See "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/security/keychain_services/keychain_items/searching_for_keychain_items"
                },
                {
                  "type": "text",
                  "text": " for details."
                }
              ]
            }
          ],
          "style": "note",
          "name": "Note"
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Ensure Searchability",
          "anchor": "2922062"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To be able to find the item later, you’re going to use your knowledge of its attributes. In this example, the server and the account are the item’s distinguishing characteristics. For constant attributes (here, the server), use the same value during lookup. In contrast, the account attribute is dynamic, because it holds a value provided by the user at runtime. As long as your app never adds similar items with varying attributes (such as passwords for different accounts on the same server), you can omit these dynamic attributes as search parameters and instead retrieve them along with the item. As a result, when you look up the password, you also get the corresponding username."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If your app does add items with varying dynamic attributes, you’ll need a way to choose among them during retrieval. One option is to record information about the items in another way. For example, if you keep records of users in a Core Data model, you store the username there after using keychain services to store the password field. Later, you use the user name pulled from your data model to condition the search for the password."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "In other cases, it may make sense to further characterize the item by adding more attributes. For example, you might include the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/ksecattrlabel"
            },
            {
              "type": "text",
              "text": " attribute in the original add query, providing a string that marks the item for the particular purpose. Then you’ll be able to use this attribute to narrow your search later."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}