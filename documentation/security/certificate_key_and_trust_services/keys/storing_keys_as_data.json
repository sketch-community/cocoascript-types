{
  "abstract": [
    {
      "type": "text",
      "text": "Create an external representation of a key for transmission."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/security",
        "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services",
        "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2863861,
  "kind": "article",
  "metadata": {
    "title": "Storing Keys as Data",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "Security"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/security": {
      "title": "Security",
      "identifier": "doc://com.apple.documentation/documentation/security",
      "url": "/documentation/security",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services": {
      "title": "Certificate, Key, and Trust Services",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services",
      "url": "/documentation/security/certificate_key_and_trust_services",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys": {
      "title": "Keys",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys",
      "url": "/documentation/security/certificate_key_and_trust_services/keys",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/security/1643698-seckeycopyexternalrepresentation": {
      "title": "SecKeyCopyExternalRepresentation",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1643698-seckeycopyexternalrepresentation",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1643698-seckeycopyexternalrepresentation",
      "abstract": [
        {
          "type": "text",
          "text": "Returns an external representation of the given key suitable for the key's type."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data#2933726": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data#2933726",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data#2933726"
    },
    "doc://com.apple.documentation/documentation/security/1495743-keychain_item_attribute_constant/kseckeyextractable": {
      "title": "kSecKeyExtractable",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1495743-keychain_item_attribute_constant/kseckeyextractable",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1495743-keychain_item_attribute_constant/kseckeyextractable"
    },
    "doc://com.apple.documentation/documentation/foundation/1587932-cfbridgingrelease": {
      "title": "CFBridgingRelease",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/foundation/1587932-cfbridgingrelease",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/foundation/1587932-cfbridgingrelease"
    },
    "doc://com.apple.documentation/documentation/corefoundation/cferrorref": {
      "title": "CFErrorRef",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/corefoundation/cferrorref",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/corefoundation/cferrorref"
    },
    "doc://com.apple.documentation/documentation/swift/error": {
      "title": "Error",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/swift/error",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/swift/error"
    },
    "doc://com.apple.documentation/documentation/swift/unmanaged/1539754-takeretainedvalue": {
      "title": "takeRetainedValue()",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/swift/unmanaged/1539754-takeretainedvalue",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/swift/unmanaged/1539754-takeretainedvalue"
    },
    "doc://com.apple.documentation/documentation/security/1643701-seckeycreatewithdata": {
      "title": "SecKeyCreateWithData",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1643701-seckeycreatewithdata",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1643701-seckeycreatewithdata",
      "abstract": [
        {
          "type": "text",
          "text": "Restores a key from an external representation of that key."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data#2933725": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data#2933725",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data#2933725"
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data": {
      "title": "Storing Keys as Data",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data",
      "kind": "article",
      "role": "article",
      "url": "/documentation/security/certificate_key_and_trust_services/keys/storing_keys_as_data",
      "abstract": [
        {
          "type": "text",
          "text": "Create an external representation of a key for transmission."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/security/1643698-seckeycopyexternalrepresentation",
        "doc://com.apple.documentation/documentation/security/1643701-seckeycreatewithdata"
      ],
      "title": "Import and Export",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If you have a key that you want to send somewhere, you package it in a form that’s suitable for transmission."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Export the Key as a Data Instance",
          "anchor": "2933723"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Create a data instance representing a key using the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1643698-seckeycopyexternalrepresentation"
            },
            {
              "type": "text",
              "text": " function:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "SecKeyRef key = <# a key #>;",
            "CFErrorRef error = NULL;",
            "NSData* keyData = (NSData*)CFBridgingRelease(  // ARC takes ownership",
            "                       SecKeyCopyExternalRepresentation(key, &error)",
            "                   );",
            "if (!keyData) {",
            "    NSError *err = CFBridgingRelease(error);  // ARC takes ownership",
            "    // Handle the error. . .",
            "}",
            ""
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "2933726",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The data instance returned from this function can then be sent across a network, through the file system, or by any other means, so long as the data’s content is preserved exactly."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "This method works for both public and private keys. However, it doesn’t work for all keys. For example, if a key is bound to a smart card or to the Secure Enclave, you can’t export it this way. Also, in macOS, a key that has the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1495743-keychain_item_attribute_constant/kseckeyextractable"
            },
            {
              "type": "text",
              "text": " attribute set to false is ineligible for export. In these cases, or if any other error occurs, the returned data is "
            },
            {
              "type": "codeVoice",
              "code": "nil"
            },
            {
              "type": "text",
              "text": " and the error object indicates the reason for failure."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When an error does occur, you become responsible for the error object’s memory. In Objective-C, you transfer ownership to Automatic Reference Counting (ARC) using a call to "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/foundation/1587932-cfbridgingrelease"
            },
            {
              "type": "text",
              "text": ". In Swift, you convert the unmanaged "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/corefoundation/cferrorref"
            },
            {
              "type": "text",
              "text": " object to a managed "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/swift/error"
            },
            {
              "type": "text",
              "text": " using "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/swift/unmanaged/1539754-takeretainedvalue"
            },
            {
              "type": "text",
              "text": " and a cast."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The format of the returned data depends on the kind of key you are exporting:"
            }
          ]
        },
        {
          "type": "unorderedList",
          "items": [
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "For an RSA key, the function returns data in the PKCS #1 format."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "For an elliptic curve public key, the format follows the ANSI X9.63 standard using a byte string of "
                    },
                    {
                      "type": "codeVoice",
                      "code": "04 || X || Y"
                    },
                    {
                      "type": "text",
                      "text": "."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "For an elliptic curve private key, the output is formatted as the public key concatenated with the big endian encoding of the secret scalar, or "
                    },
                    {
                      "type": "codeVoice",
                      "code": "04 || X || Y || K"
                    },
                    {
                      "type": "text",
                      "text": "."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": " All of these representations use constant size integers, including leading zeros as needed."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Avoid insecure distribution of cryptographic keys, and pay special attention to private keys. You can distribute a public key freely, although you do need to ensure trust—can the receiver be sure this is the public key that you sent? Trust is typically established with a signed certificate, but if you are working in a closed system, or enforce trust in some other way, you can export and send public keys as data. Use extra caution, however, when exporting private keys, because they must remain absolutely secret to be of value."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "If there’s even a possibility that an untrusted entity has gained access to your private key, it is compromised and you should stop using it."
                }
              ]
            }
          ],
          "style": "important"
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Restore a Key from a Data Instance",
          "anchor": "2933724"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When you’re ready to restore the data instance back into a key, use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1643701-seckeycreatewithdata"
            },
            {
              "type": "text",
              "text": " function:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "// The key is assumed to be public, 2048-bit RSA",
            "NSDictionary* options = @{(id)kSecAttrKeyType: (id)kSecAttrKeyTypeRSA,",
            "                          (id)kSecAttrKeyClass: (id)kSecAttrKeyClassPublic,",
            "                          (id)kSecAttrKeySizeInBits: @2048,",
            "                         };",
            "CFErrorRef error = NULL;",
            "SecKeyRef key = SecKeyCreateWithData((__bridge CFDataRef)data,",
            "                                     (__bridge CFDictionaryRef)options,",
            "                                     &error);",
            "if (!key) {",
            "    NSError *err = CFBridgingRelease(error);  // ARC takes ownership",
            "    // Handle the error. . .",
            "} else { <# Use key #> }",
            " ",
            "if (key) { CFRelease(key); }  // After you are done with it"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "2933725",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "In this case, you use an options dictionary to inform the function about certain characteristics of the key. At a minimum, you indicate the key’s type, class, and size, which means you need to communicate this information along with the key data or establish it ahead of time. If the function returns an empty key reference, check the error object for indications of failure."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "In Objective-C, you release the key object’s memory after you’re done using it. You also transfer ownership of the error object, if it exists, to ARC. In Swift, the key object’s memory is already managed by the system, but you transfer ownership of the unmanaged "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/corefoundation/cferrorref"
            },
            {
              "type": "text",
              "text": " to the system with "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/swift/unmanaged/1539754-takeretainedvalue"
            },
            {
              "type": "text",
              "text": " and recast it as an "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/swift/error"
            },
            {
              "type": "text",
              "text": " before throwing it."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}