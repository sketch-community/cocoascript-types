{
  "abstract": [
    {
      "type": "text",
      "text": "Work around a recoverable trust failure."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/security",
        "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services",
        "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2874970,
  "kind": "article",
  "metadata": {
    "title": "Configuring a Trust",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "Security"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/security": {
      "title": "Security",
      "identifier": "doc://com.apple.documentation/documentation/security",
      "url": "/documentation/security",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services": {
      "title": "Certificate, Key, and Trust Services",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services",
      "url": "/documentation/security/certificate_key_and_trust_services",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust": {
      "title": "Trust",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust",
      "url": "/documentation/security/certificate_key_and_trust_services/trust",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/evaluating_a_trust_and_parsing_the_result": {
      "title": "Evaluating a Trust and Parsing the Result",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/evaluating_a_trust_and_parsing_the_result",
      "kind": "article",
      "role": "article",
      "url": "/documentation/security/certificate_key_and_trust_services/trust/evaluating_a_trust_and_parsing_the_result"
    },
    "doc://com.apple.documentation/documentation/security/1397216-sectrustsetverifydate": {
      "title": "SecTrustSetVerifyDate",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1397216-sectrustsetverifydate",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1397216-sectrustsetverifydate",
      "abstract": [
        {
          "type": "text",
          "text": "Sets the date and time against which the certificates in a trust management object are verified."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust#2874975": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust#2874975",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust#2874975"
    },
    "link-2874972": {
      "title": "iOS",
      "type": "topic",
      "identifier": "link-2874972",
      "kind": "article",
      "role": "link",
      "url": "https://support.apple.com/en-us/HT204132"
    },
    "link-2874973": {
      "title": "macOS",
      "type": "topic",
      "identifier": "link-2874973",
      "kind": "article",
      "role": "link",
      "url": "https://support.apple.com/en-us/HT202858"
    },
    "doc://com.apple.documentation/documentation/security/1396098-sectrustsetanchorcertificates": {
      "title": "SecTrustSetAnchorCertificates",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1396098-sectrustsetanchorcertificates",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1396098-sectrustsetanchorcertificates",
      "abstract": [
        {
          "type": "text",
          "text": "Sets the anchor certificates used when evaluating a trust management object."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust#2874974": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust#2874974",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust#2874974"
    },
    "doc://com.apple.documentation/documentation/security/1399071-sectrustsetanchorcertificatesonl": {
      "title": "SecTrustSetAnchorCertificatesOnly",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1399071-sectrustsetanchorcertificatesonl",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1399071-sectrustsetanchorcertificatesonl",
      "abstract": [
        {
          "type": "text",
          "text": "Reenables trusting built-in anchor certificates."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1401555-sectrustcreatewithcertificates": {
      "title": "SecTrustCreateWithCertificates",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1401555-sectrustcreatewithcertificates",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1401555-sectrustcreatewithcertificates"
    },
    "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust": {
      "title": "Configuring a Trust",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust",
      "kind": "article",
      "role": "article",
      "url": "/documentation/security/certificate_key_and_trust_services/trust/configuring_a_trust",
      "abstract": [
        {
          "type": "text",
          "text": "Work around a recoverable trust failure."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1395676-sectrustsetexceptions": {
      "title": "SecTrustSetExceptions",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1395676-sectrustsetexceptions",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1395676-sectrustsetexceptions",
      "abstract": [
        {
          "type": "text",
          "text": "Sets a list of exceptions that should be ignored when the certificate is evaluated."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1398399-sectrustsetpolicies": {
      "title": "SecTrustSetPolicies",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1398399-sectrustsetpolicies",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1398399-sectrustsetpolicies",
      "abstract": [
        {
          "type": "text",
          "text": "Sets the policies to use in an evaluation."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1392875-sectrustsetoptions": {
      "title": "SecTrustSetOptions",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1392875-sectrustsetoptions",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1392875-sectrustsetoptions",
      "abstract": [
        {
          "type": "text",
          "text": "Sets option flags for customizing evaluation of a trust object."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/sectrustoptionflags": {
      "title": "SecTrustOptionFlags",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/sectrustoptionflags",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/sectrustoptionflags",
      "abstract": [
        {
          "type": "text",
          "text": "The option flags used to condition a trust evaluation."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1400259-sectrustgetnetworkfetchallowed": {
      "title": "SecTrustGetNetworkFetchAllowed",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1400259-sectrustgetnetworkfetchallowed",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1400259-sectrustgetnetworkfetchallowed",
      "abstract": [
        {
          "type": "text",
          "text": "Indicates whether a trust evaluation is permitted to fetch missing intermediate certificates from the network."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1395083-sectrustsetnetworkfetchallowed": {
      "title": "SecTrustSetNetworkFetchAllowed",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1395083-sectrustsetnetworkfetchallowed",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1395083-sectrustsetnetworkfetchallowed",
      "abstract": [
        {
          "type": "text",
          "text": "Specifies whether a trust evaluation is permitted to fetch missing intermediate certificates from the network."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1400880-sectrustsetocspresponse": {
      "title": "SecTrustSetOCSPResponse",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1400880-sectrustsetocspresponse",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1400880-sectrustsetocspresponse",
      "abstract": [
        {
          "type": "text",
          "text": "Attaches Online Certificate Status Protocol (OSCP) response data to a trust object."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/3081274-sectrustsetsignedcertificatetime": {
      "title": "SecTrustSetSignedCertificateTimestamps",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/3081274-sectrustsetsignedcertificatetime",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/3081274-sectrustsetsignedcertificatetime",
      "abstract": [
        {
          "type": "text",
          "text": "Attaches signed certificate timestamp data to a trust object."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "seeAlsoSections": [
    {
      "identifiers": [
        "doc://com.apple.documentation/documentation/security/1397216-sectrustsetverifydate",
        "doc://com.apple.documentation/documentation/security/1396098-sectrustsetanchorcertificates",
        "doc://com.apple.documentation/documentation/security/1399071-sectrustsetanchorcertificatesonl",
        "doc://com.apple.documentation/documentation/security/1395676-sectrustsetexceptions",
        "doc://com.apple.documentation/documentation/security/1398399-sectrustsetpolicies",
        "doc://com.apple.documentation/documentation/security/1392875-sectrustsetoptions",
        "doc://com.apple.documentation/documentation/security/sectrustoptionflags",
        "doc://com.apple.documentation/documentation/security/1400259-sectrustgetnetworkfetchallowed",
        "doc://com.apple.documentation/documentation/security/1395083-sectrustsetnetworkfetchallowed",
        "doc://com.apple.documentation/documentation/security/1400880-sectrustsetocspresponse",
        "doc://com.apple.documentation/documentation/security/3081274-sectrustsetsignedcertificatetime"
      ],
      "title": "Advanced Trust Configuation",
      "generated": true
    }
  ],
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The default procedure described in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/certificate_key_and_trust_services/trust/evaluating_a_trust_and_parsing_the_result"
            },
            {
              "type": "text",
              "text": " is often sufficient for evaluating trust, but sometimes you need finer-grained control. Whether in response to a recoverable trust failure or based on prior knowledge of the situation, the certificate, key, and trust services API allows you to customize trust evaluation to deal with certain common scenarios."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "For example, by default, trust evaluation compares the validity dates of a certificate against the current date to see whether a certificate is operative. If a certificate used to sign a document is currently expired, trust fails. But if the same certificate was valid at the time the document was signed, you might want to consider the certificate valid for this purpose. If you know the signing date, you can use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1397216-sectrustsetverifydate"
            },
            {
              "type": "text",
              "text": " function to change the evaluation date to match. Do this after creating the trust but before running the evaluation (or rerunning it after a recoverable failure). For example, if the document is exactly one year old:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "NSDate* newDate = [NSDate dateWithTimeIntervalSinceNow:-60*60*24*365];SecTrustSetVerifyDate(trust, (__bridge CFDateRef)newDate);"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "2874975",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Running the evaluation now may succeed if the evaluation date is within the window of the certificate’s validity period. Or it may fail for some other reason that you need to investigate."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Besides the problem of expiration dates, another common trust evaluation problem arises from using a custom, self-signed root certificate as an anchor. By default, the system trusts as an anchor only the root certificates packaged with the operating system (see the lists for "
            },
            {
              "type": "link",
              "title": "iOS",
              "destination": "https://support.apple.com/en-us/HT204132"
            },
            {
              "type": "text",
              "text": " and "
            },
            {
              "type": "link",
              "title": "macOS",
              "destination": "https://support.apple.com/en-us/HT202858"
            },
            {
              "type": "text",
              "text": "), but you can supplement this list. If you bundle a self-signed certificate with your app, you can indicate to the system that you trust it for use as an anchor by making a call to the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1396098-sectrustsetanchorcertificates"
            },
            {
              "type": "text",
              "text": " function:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "SecCertificateRef anchorCert = <# a certificate #>;",
            "NSArray* anchors = @[ (__bridge id)anchorCert ];",
            "SecTrustSetAnchorCertificates(trust,(__bridge CFTypeRef)anchors);"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "2874974",
            "title": "Listing 2"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When you make this call, you tell the system to consider only the named certificate or certificates as potential anchors for this trust. If you want to enable the usual set of anchors as well, you use an additional call to the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1399071-sectrustsetanchorcertificatesonl"
            },
            {
              "type": "text",
              "text": " function, with a value of false for the second argument. Note that these calls affect only the referenced trust. Other trust evaluations, both in your app and elsewhere on the device, are unaffected."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When you approve an anchor certificate for a trust using the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1396098-sectrustsetanchorcertificates"
            },
            {
              "type": "text",
              "text": " function, you don’t need to name it explicitly in the certificate array passed to the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1401555-sectrustcreatewithcertificates"
            },
            {
              "type": "text",
              "text": " function, because the system automatically adds it to the certificate chain."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}