{
  "abstract": [
    {
      "type": "text",
      "text": "Use shared web credentials to create a seamless experience for the user."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/security",
        "doc://com.apple.documentation/documentation/security/shared_web_credentials"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 2868473,
  "kind": "article",
  "metadata": {
    "title": "Managing Shared Credentials",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "Security"
      }
    ]
  },
  "schemaVersion": {
    "major": 0,
    "minor": 1,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/security/shared_web_credentials/managing_shared_credentials"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/security/shared_web_credentials/managing_shared_credentials"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/security": {
      "title": "Security",
      "identifier": "doc://com.apple.documentation/documentation/security",
      "url": "/documentation/security",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/security/shared_web_credentials": {
      "title": "Shared Web Credentials",
      "identifier": "doc://com.apple.documentation/documentation/security/shared_web_credentials",
      "url": "/documentation/security/shared_web_credentials",
      "type": "topic",
      "kind": "article",
      "role": "collectionGroup"
    },
    "link-media-1965823": {
      "identifier": "link-media-1965823",
      "type": "link",
      "title": "Figure 1",
      "url": "/documentation/security/shared_web_credentials/managing_shared_credentials#1965823"
    },
    "media-1965823": {
      "identifier": "media-1965823",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 480,
            "height": 448
          },
          "url": "https://docs-assets.developer.apple.com/published/3839cd4b26/Basic_Login_Workflow_2_2x_db1a735f-04ed-4c96-9159-1acaff1d8a24.png"
        }
      ],
      "title": "Figure 1",
      "abstract": [
        {
          "type": "text",
          "text": "Basic login workflow"
        }
      ]
    },
    "link-media-1965824": {
      "identifier": "link-media-1965824",
      "type": "link",
      "title": "Figure 2",
      "url": "/documentation/security/shared_web_credentials/managing_shared_credentials#1965824"
    },
    "media-1965824": {
      "identifier": "media-1965824",
      "type": "image",
      "variants": [
        {
          "traits": [
            "2x"
          ],
          "size": {
            "width": 494,
            "height": 510
          },
          "url": "https://docs-assets.developer.apple.com/published/3839cd4b26/Shared_Credential_Login_Workflow_2_2x_d1c86554-9b8b-44e6-b228-dbac954975a5.png"
        }
      ],
      "title": "Figure 2",
      "abstract": [
        {
          "type": "text",
          "text": "Login workflow with shared web credentials"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1617896-secrequestsharedwebcredential": {
      "title": "SecRequestSharedWebCredential",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1617896-secrequestsharedwebcredential",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1617896-secrequestsharedwebcredential"
    },
    "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials#1943517": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials#1943517",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/shared_web_credentials/managing_shared_credentials#1943517",
      "abstract": [
        {
          "type": "text",
          "text": "Accessing shared web credentials"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/1617986-secaddsharedwebcredential": {
      "title": "SecAddSharedWebCredential",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/1617986-secaddsharedwebcredential",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/security/1617986-secaddsharedwebcredential"
    },
    "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials#1943521": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials#1943521",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/shared_web_credentials/managing_shared_credentials#1943521",
      "abstract": [
        {
          "type": "text",
          "text": "Creating a user account"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials#1943527": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials#1943527",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/shared_web_credentials/managing_shared_credentials#1943527",
      "abstract": [
        {
          "type": "text",
          "text": "Deleting a user account"
        }
      ]
    },
    "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials": {
      "title": "Managing Shared Credentials",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials",
      "kind": "article",
      "role": "article",
      "url": "/documentation/security/shared_web_credentials/managing_shared_credentials",
      "abstract": [
        {
          "type": "text",
          "text": "Use shared web credentials to create a seamless experience for the user."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "There are a wide range of common situations where you may want to use shared web credentials. This article covers four: "
            }
          ]
        },
        {
          "type": "orderedList",
          "items": [
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Logging in to a remote server"
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Creating a user account in the app"
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Changing a user’s password"
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Deleting a user’s account"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": []
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Logging In to a Remote Server",
          "anchor": "1654519"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Typically, when an app needs to log in to a remote service, you start by checking for the user’s credentials in the iOS keychain. If you have current credentials for the user, you can log them in directly. If not, prompt the users for their user name and password, and then try to log them in. You will also want to save their credentials after the login is successful. This workflow is shown in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "link-media-1965823"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-1965823",
              "metadata": {
                "anchor": "1965823",
                "title": "Figure 1",
                "abstract": [
                  {
                    "type": "text",
                    "text": "Basic login workflow"
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When using shared web credentials, you add two steps to this procedure. As before, you start by checking if the user’s credentials are stored in the keychain. If you cannot find the user’s credentials, you check for shared web credentials. If you still cannot find any credentials, or if the user declines to use the shared credentials, you must prompt the user for her name and password. Try to log the user in, and if the login is successful, save the credentials to both the keychain and the shared web credentials. This ensures that the user has access to the credentials in Safari as well as within your app. This workflow is shown in "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "link-media-1965824"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "image",
              "identifier": "media-1965824",
              "metadata": {
                "anchor": "1965824",
                "title": "Figure 2",
                "abstract": [
                  {
                    "type": "text",
                    "text": "Login workflow with shared web credentials"
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "Even if the system finds a match in the shared web credentials, the user can still decline to use those credentials. This will cause the check for shared web credentials to fail. Therefore, you must always have a fallback that prompts the user for their name and password."
                }
              ]
            }
          ],
          "style": "note",
          "name": "Remember"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "Do not use the shared web credentials as your primary storage for secure user credentials. Instead, save the user’s credentials in the keychain, and only use the shared web credentials when you can’t find the login credentials in the keychain."
            }
          ]
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "To read the user’s credentials from the shared web credentials, use the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1617896-secrequestsharedwebcredential"
            },
            {
              "type": "text",
              "text": " function as shown in "
            },
            {
              "type": "reference",
              "isActive": false,
              "identifier": "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials#1943517"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "SecRequestSharedWebCredential(NULL, NULL, ^(CFArrayRef credentials, CFErrorRef error) {",
            " ",
            "    if (error != NULL) {",
            "        // If an error occurs, handle the error here.",
            "        [self handleError:error];",
            "        return;",
            "    }",
            " ",
            "    BOOL success = NO;",
            "    CFStringRef server = NULL;",
            "    CFStringRef userName = NULL;",
            "    CFStringRef password = NULL;",
            " ",
            "    // If credentials are found, use them.",
            "    if (CFArrayGetCount(credentials) > 0) {",
            " ",
            "        // There will only ever be one credential dictionary",
            "        CFDictionaryRef credentialDict =",
            "        CFArrayGetValueAtIndex(credentials, 0);",
            " ",
            "        server = CFDictionaryGetValue(credentialDict, kSecAttrServer);",
            "        userName = CFDictionaryGetValue(credentialDict, kSecAttrAccount);",
            "        password = CFDictionaryGetValue(credentialDict, kSecSharedPassword);",
            " ",
            "        // Attempt to log in",
            "        success = [self logIntoServer:server user:userName password:password];",
            "    }",
            " ",
            "    if (!success) {",
            "        [self promptForUserNameAndPassword];",
            "    } else {",
            "        [self saveCredentialsToKeychainForServer: server user:userName password:password];",
            "    }",
            "});"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "1943517",
            "title": "Listing 1",
            "abstract": [
              {
                "type": "text",
                "text": "Accessing shared web credentials"
              }
            ]
          }
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "The keychain supports saving and loading a wide range of possible credential types. These types can be user name and password pairs, authentication tokens or cookies. Shared web credentials, however, are much more restrictive. You can save only user name and password pairs to the shared web credentials."
                }
              ]
            }
          ],
          "style": "note",
          "name": "Note"
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Creating a User Account in the App",
          "anchor": "1654539"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If the user can create new accounts in your app, you should save the user name and password to the shared web credentials. In this way, the user can easily access the account from Safari, as well as from within your app. You can save the user’s name and password to the shared web credentials using the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1617986-secaddsharedwebcredential"
            },
            {
              "type": "text",
              "text": " function as shown."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "SecAddSharedWebCredential(domain, name, password, ^(CFErrorRef error) {",
            " ",
            "    if (error != NULL) {",
            "        // Handle the error here...",
            "        return;",
            "    }",
            " ",
            "    // The credentials have been successfully saved.",
            " ",
            "});"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "1943521",
            "title": "Listing 2",
            "abstract": [
              {
                "type": "text",
                "text": "Creating a user account"
              }
            ]
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If there are no existing credentials for this user name and domain, this method completes without prompting the user for permission."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Changing a User’s Password",
          "anchor": "1654558"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If the user changes her password in the app, you must update both the credentials stored in the keychain and in the shared web credentials. You can change a password using the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1617986-secaddsharedwebcredential"
            },
            {
              "type": "text",
              "text": " function. This is exactly the same procedure used when creating a new user account (see "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/shared_web_credentials/managing_shared_credentials#1943521"
            },
            {
              "type": "text",
              "text": "). However, if credentials already exist for the given user name and domain, this method prompts the user for permission before making the change. The user can cancel this change."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Deleting a User’s Account",
          "anchor": "1654569"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If the user deletes her account, you should remove the credentials from both the keychain and the shared web credentials. You can remove the credentials for a given domain and user name by calling the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/1617986-secaddsharedwebcredential"
            },
            {
              "type": "text",
              "text": " function and passing "
            },
            {
              "type": "codeVoice",
              "code": "NULL"
            },
            {
              "type": "text",
              "text": " for the password."
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "SecAddSharedWebCredential(domain, name, NULL, ^(CFErrorRef error) {",
            " ",
            "    if (error != NULL) {",
            "        // Handle the error here...",
            "        return;",
            "    }",
            " ",
            "    // The account information has been successfully deleted.",
            " ",
            "});"
          ],
          "syntax": "occ",
          "metadata": {
            "anchor": "1943527",
            "title": "Listing 3",
            "abstract": [
              {
                "type": "text",
                "text": "Deleting a user account"
              }
            ]
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The system prompts the user for permission before deleting their user name and password from the shared web credentials. Users can cancel this change."
            }
          ]
        },
        {
          "type": "aside",
          "content": [
            {
              "type": "paragraph",
              "inlineContent": [
                {
                  "type": "text",
                  "text": "Use "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/security/1617986-secaddsharedwebcredential"
                },
                {
                  "type": "text",
                  "text": " to remove a user’s credentials only when the user deletes her account. Do not use this method when the user simply logs out. Passing a "
                },
                {
                  "type": "codeVoice",
                  "code": "NULL"
                },
                {
                  "type": "text",
                  "text": " password to "
                },
                {
                  "type": "reference",
                  "isActive": true,
                  "identifier": "doc://com.apple.documentation/documentation/security/1617986-secaddsharedwebcredential"
                },
                {
                  "type": "text",
                  "text": " removes the user’s credentials and prevents Safari from autocompleting her login information."
                }
              ]
            }
          ],
          "style": "note",
          "name": "Note"
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2021 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}