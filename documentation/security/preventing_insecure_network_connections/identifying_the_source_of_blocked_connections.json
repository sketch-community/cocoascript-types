{
  "abstract": [
    {
      "type": "text",
      "text": "Figure out why App Transport Security denies a network connection."
    }
  ],
  "documentVersion": 0,
  "hierarchy": {
    "paths": [
      [
        "doc://com.apple.documentation/documentation/technologies",
        "doc://com.apple.documentation/documentation/security",
        "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections"
      ]
    ]
  },
  "identifier": {
    "url": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections",
    "interfaceLanguage": "occ"
  },
  "legacy_identifier": 3138693,
  "kind": "article",
  "metadata": {
    "title": "Identifying the Source of Blocked Connections",
    "role": "article",
    "roleHeading": "Article",
    "modules": [
      {
        "name": "Security"
      }
    ]
  },
  "schemaVersion": {
    "major": 1,
    "minor": 0,
    "patch": 0
  },
  "sections": [],
  "variants": [
    {
      "traits": [
        {
          "interfaceLanguage": "occ"
        }
      ],
      "paths": [
        "documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections"
      ]
    },
    {
      "traits": [
        {
          "interfaceLanguage": "swift"
        }
      ],
      "paths": [
        "documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections"
      ]
    }
  ],
  "references": {
    "doc://com.apple.documentation/documentation/security": {
      "title": "Security",
      "identifier": "doc://com.apple.documentation/documentation/security",
      "url": "/documentation/security",
      "type": "topic",
      "kind": "symbol",
      "role": "collection"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections": {
      "title": "Preventing Insecure Network Connections",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections",
      "kind": "article",
      "role": "article",
      "url": "/documentation/security/preventing_insecure_network_connections"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3138696": {
      "title": "Listing 1",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3138696",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3138696"
    },
    "doc://com.apple.documentation/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsallowsarbitraryloads": {
      "title": "NSAllowsArbitraryLoads",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsallowsarbitraryloads",
      "kind": "symbol",
      "role": "symbol",
      "url": "/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsallowsarbitraryloads"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141615": {
      "title": "NSExceptionMinimumTLSVersion",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141615",
      "kind": "article",
      "role": "subsection",
      "url": "/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141615"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141617": {
      "title": "NSExceptionRequiresForwardSecrecy",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141617",
      "kind": "article",
      "role": "subsection",
      "url": "/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141617"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141618": {
      "title": "NSExceptionAllowsInsecureHTTPLoads",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141618",
      "kind": "article",
      "role": "subsection",
      "url": "/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141618"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3138697": {
      "title": "Listing 2",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3138697",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3138697"
    },
    "doc://com.apple.documentation/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsexceptiondomains": {
      "title": "NSExceptionDomains",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsexceptiondomains",
      "kind": "symbol",
      "role": "dictionarySymbol",
      "url": "/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsexceptiondomains"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3139025": {
      "title": "Listing 3",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3139025",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3139025"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138464": {
      "title": "Ensure the Network Server Meets Minimum Requirements",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138464",
      "kind": "article",
      "role": "subsection",
      "url": "/documentation/security/preventing_insecure_network_connections#3138464"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3139027": {
      "title": "Listing 4",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3139027",
      "kind": "article",
      "role": "codeListing",
      "url": "/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections#3139027"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138482": {
      "title": "Configure Exceptions Only When Needed; Prefer Server Fixes",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138482",
      "kind": "article",
      "role": "subsection",
      "url": "/documentation/security/preventing_insecure_network_connections#3138482"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138037": {
      "title": "Prefer High-Level Frameworks in Your App",
      "type": "section",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138037",
      "kind": "article",
      "role": "subsection",
      "url": "/documentation/security/preventing_insecure_network_connections#3138037"
    },
    "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections": {
      "title": "Identifying the Source of Blocked Connections",
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections",
      "kind": "article",
      "role": "article",
      "url": "/documentation/security/preventing_insecure_network_connections/identifying_the_source_of_blocked_connections",
      "abstract": [
        {
          "type": "text",
          "text": "Figure out why App Transport Security denies a network connection."
        }
      ]
    },
    "doc://com.apple.documentation/documentation/technologies": {
      "type": "topic",
      "identifier": "doc://com.apple.documentation/documentation/technologies",
      "url": "/documentation/technologies",
      "kind": "technologies",
      "title": "Technologies"
    }
  },
  "primaryContentSections": [
    {
      "kind": "content",
      "content": [
        {
          "anchor": "overview",
          "level": 2,
          "text": "Overview",
          "type": "heading"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If your app experiences connectivity problems that you think might be related to App Transport Security (ATS), be sure that:"
            }
          ]
        },
        {
          "type": "unorderedList",
          "items": [
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "You’re using high-level network frameworks and secure URLs, as described in "
                    },
                    {
                      "type": "reference",
                      "isActive": true,
                      "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138037"
                    },
                    {
                      "type": "text",
                      "text": "."
                    }
                  ]
                }
              ]
            },
            {
              "content": [
                {
                  "type": "paragraph",
                  "inlineContent": [
                    {
                      "type": "text",
                      "text": "Your server is properly configured. Use the "
                    },
                    {
                      "type": "codeVoice",
                      "code": "nscurl"
                    },
                    {
                      "type": "text",
                      "text": " command line tool on your Mac to check how the server’s configuration affects ATS behavior."
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Check Combinations of ATS Exceptions",
          "anchor": "3138695"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "The "
            },
            {
              "type": "codeVoice",
              "code": "nscurl"
            },
            {
              "type": "text",
              "text": " command accepts the "
            },
            {
              "type": "codeVoice",
              "code": "--ats-diagnostics"
            },
            {
              "type": "text",
              "text": " flag that asks it to check how a particular server responds to combinations of ATS exceptions. For example, you can test the canonical example web site:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "$ /usr/bin/nscurl --ats-diagnostics --verbose https://example.com"
          ],
          "syntax": "other",
          "metadata": {
            "anchor": "3138696",
            "title": "Listing 1"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "In addition to running with no exceptions at all, the tool tests the global exception key "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsallowsarbitraryloads"
            },
            {
              "type": "text",
              "text": ", as well as a variety of combinations of the exception domain keys "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141615"
            },
            {
              "type": "text",
              "text": ", "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141617"
            },
            {
              "type": "text",
              "text": ", and "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141618"
            },
            {
              "type": "text",
              "text": ". "
            },
            {
              "type": "codeVoice",
              "code": "nscurl"
            },
            {
              "type": "text",
              "text": " outputs the results of all these tests to the terminal:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "Starting ATS Diagnostics",
            "",
            "Configuring ATS Info.plist keys and displaying the result of HTTPS loads to https://example.com.",
            "A test will \"PASS\" if URLSession:task:didCompleteWithError: returns a nil error.",
            "================================================================================",
            "",
            "Default ATS Secure Connection",
            "---",
            "ATS Default Connection",
            "ATS Dictionary:",
            "{",
            "}",
            "Result : PASS",
            "---",
            "",
            "================================================================================",
            "",
            "Allowing Arbitrary Loads",
            "",
            "---",
            "Allow All Loads",
            "ATS Dictionary:",
            "{",
            "    NSAllowsArbitraryLoads = true;",
            "}",
            "Result : PASS",
            "---",
            "",
            "..."
          ],
          "syntax": "other",
          "metadata": {
            "anchor": "3138697",
            "title": "Listing 2"
          }
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Look for Basic Security Failures",
          "anchor": "3138694"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If globally allowing arbitrary loads fails, the problem isn’t related to ATS. For example, if the server’s certificate doesn’t match the DNS name of the server, the connection fails default server trust evaluation before ATS has a chance to impose its extended security checks:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "...",
            "",
            "Allowing Arbitrary Loads",
            "",
            "---",
            "Allow All Loads",
            "ATS Dictionary:",
            "{",
            "    NSAllowsArbitraryLoads = true;",
            "}",
            "Result : FAIL",
            "Error : Error Domain=NSURLErrorDomain Code=-1202 \"The certificate for this server is invalid...",
            "",
            "..."
          ],
          "syntax": "other",
          "metadata": {
            "anchor": "3139025",
            "title": "Listing 3"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "When you see this failure, check that your certificate meets the default server trust evaluation requirements described in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138464"
            },
            {
              "type": "text",
              "text": ". For example, make sure the certificate matches the DNS name of the server and that the certificate isn’t expired."
            }
          ]
        },
        {
          "level": 3,
          "type": "heading",
          "text": "Consider Specific ATS Exceptions",
          "anchor": "3139026"
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If the ATS default test fails but the arbitrary loads test passes, you might need to reconfigure your server. Use the remaining tests to help pinpoint the problem. For example, consider the test with the following exceptions dictionary:"
            }
          ]
        },
        {
          "type": "codeListing",
          "code": [
            "{",
            "    NSExceptionDomains =     {",
            "        \"example.com\" =         {",
            "            NSExceptionRequiresForwardSecrecy = false;",
            "        };",
            "    };",
            "}"
          ],
          "syntax": "other",
          "metadata": {
            "anchor": "3139027",
            "title": "Listing 4"
          }
        },
        {
          "type": "paragraph",
          "inlineContent": [
            {
              "type": "text",
              "text": "If simply disabling forward secrecy results in a passing test, you need to reconfigure your server to support perfect forward secrecy (PFS) through Elliptic Curve Diffie-Hellman Ephemeral (ECDHE) key exchange. If you can’t do that, you might need to add the "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections/nsapptransportsecurity/nsexceptiondomains#3141617"
            },
            {
              "type": "text",
              "text": " exception to your app instead, as described in "
            },
            {
              "type": "reference",
              "isActive": true,
              "identifier": "doc://com.apple.documentation/documentation/security/preventing_insecure_network_connections#3138482"
            },
            {
              "type": "text",
              "text": "."
            }
          ]
        }
      ]
    }
  ],
  "legalNotices": {
    "copyright": "Copyright &copy; 2020 Apple Inc. All rights reserved.",
    "termsOfUse": "https://www.apple.com/legal/internet-services/terms/site.html",
    "privacyPolicy": "https://www.apple.com/privacy/privacy-policy"
  }
}